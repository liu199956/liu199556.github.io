<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="python队列与堆栈12队列:先进先出FIFO堆栈:后进先出LIFO  桶排序12345678910111213141516171819202122232425262728def bucketSort(nums):    # 选择最大的数    max_num &#x3D; max(nums)    # 创建一个元素全是0的列表，当做桶    bucket &#x3D; [0] * (max_num + 1)">
<meta property="og:type" content="article">
<meta property="og:title" content="python">
<meta property="og:url" content="http://example.com/2020/08/23/python/index.html">
<meta property="og:site_name" content="Admin">
<meta property="og:description" content="python队列与堆栈12队列:先进先出FIFO堆栈:后进先出LIFO  桶排序12345678910111213141516171819202122232425262728def bucketSort(nums):    # 选择最大的数    max_num &#x3D; max(nums)    # 创建一个元素全是0的列表，当做桶    bucket &#x3D; [0] * (max_num + 1)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20201121173051673.png">
<meta property="og:image" content="https://images2015.cnblogs.com/blog/1036857/201705/1036857-20170529203214461-666088398.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20210727213002977.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20210804025252408.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20210901222718795.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20210727185036389.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20210727184937598.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20210727195236543.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20210727195521016.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20210727205757190.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20210727205950867.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20210727214600829.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20220616164255678.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/877318-20180523153139864-2049371026.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/877318-20180523150722556-373788290.png">
<meta property="og:image" content="http://example.com/2020/08/23/python/image-20220504163012406.png">
<meta property="article:published_time" content="2020-08-23T09:23:37.000Z">
<meta property="article:modified_time" content="2022-09-23T03:30:53.578Z">
<meta property="article:author" content="Admin">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2020/08/23/python/image-20201121173051673.png">

<link rel="canonical" href="http://example.com/2020/08/23/python/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>python | Admin</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Admin" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
	
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Admin</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/08/23/python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Admin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Admin">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          python
        </h1>

        <div class="post-meta">
		<!-- 设置置顶标志 -->
			
			  <i class="fa fa-thumb-tack"></i>
			  <font color=7D26CD>置顶</font>
			  <span class="post-meta-divider">|</span>
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-23 17:23:37" itemprop="dateCreated datePublished" datetime="2020-08-23T17:23:37+08:00">2020-08-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-09-23 11:30:53" itemprop="dateModified" datetime="2022-09-23T11:30:53+08:00">2022-09-23</time>
              </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="python"><a href="#python" class="headerlink" title="python"></a>python</h1><h2 id="队列与堆栈"><a href="#队列与堆栈" class="headerlink" title="队列与堆栈"></a>队列与堆栈</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">队列:先进先出FIFO</span><br><span class="line">堆栈:后进先出LIFO</span><br></pre></td></tr></table></figure>

<h2 id="桶排序"><a href="#桶排序" class="headerlink" title="桶排序"></a>桶排序</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bucketSort</span>(<span class="params">nums</span>):</span></span><br><span class="line">    <span class="comment"># 选择最大的数</span></span><br><span class="line">    max_num = <span class="built_in">max</span>(nums)</span><br><span class="line">    <span class="comment"># 创建一个元素全是0的列表，当做桶</span></span><br><span class="line">    bucket = [<span class="number">0</span>] * (max_num + <span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 把所有元素的个数放入桶中与其值相等的下标对应的位置</span></span><br><span class="line">    <span class="comment"># 即其值对应位置的元素的值为其在原列表中的个数</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">        bucket[num] += <span class="number">1</span></span><br><span class="line">    <span class="comment"># sort_nums存储排序好的元素</span></span><br><span class="line">    sort_nums = []</span><br><span class="line">    <span class="comment"># 取出桶中的元素</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bucket)):  <span class="comment"># 下标i 其实就是原列表的值</span></span><br><span class="line">        <span class="keyword">if</span> bucket[i] != <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 下标i对应的值不为0的话，说明原列表存在i这个值，bucket[i]就是i在原列表的个数</span></span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(bucket[i]):</span><br><span class="line">                sort_nums.append(i)</span><br><span class="line">    <span class="keyword">return</span> sort_nums</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    res = bucketSort([<span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">5</span>])</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1、桶排序是稳定的</span></span><br><span class="line"><span class="string">2、桶排序是常见排序里最快的一种, 大多数情况下比快排还要快</span></span><br><span class="line"><span class="string">3、但是同时也非常耗空间,基本上是最耗空间的一种排序算法</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="斐波那契数列"><a href="#斐波那契数列" class="headerlink" title="斐波那契数列"></a>斐波那契数列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#非递归</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span>(<span class="params">n</span>):</span></span><br><span class="line">    a,b=<span class="number">0</span>,<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> a &lt; n:</span><br><span class="line">        <span class="built_in">print</span>(a,end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        a,b=b,a+b</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">fib(<span class="number">10</span>)</span><br><span class="line"><span class="comment">#递归</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span>(<span class="params">a,b,stop</span>):</span></span><br><span class="line">    <span class="keyword">if</span>  a &gt; stop:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="built_in">print</span>(a,end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    fib(b,a+b,stop)</span><br><span class="line"></span><br><span class="line">fib(<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>递归法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci_number</span>(<span class="params">n</span>):</span></span><br><span class="line">    a, b = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        a, b = b, b + a</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(fibonacci_number(i), end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">递推法，就是递增法，时间复杂度是 O(n)，呈线性增长，如果数据量巨大，速度会越拖越慢</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> 	</span><br></pre></td></tr></table></figure>

<p>生成器</p>
<p>用for循环调用generator时，发现拿不到generator的return语句的返回值。如果拿不到返回值，那么就会报错，所以为了不让报错，就要进行异常处理，拿到返回值，如果想要拿到返回值，必须捕获StopIteration错误，返回值包含在StopIteration的value中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib_number</span>(<span class="params">n</span>):</span></span><br><span class="line">    a, b = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        a, b = b, a + b</span><br><span class="line">        n -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">yield</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib_number</span>(<span class="params">n</span>):</span></span><br><span class="line">    a, b = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        a, b = b, a+b</span><br><span class="line">        <span class="keyword">yield</span> a</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> fib_number(<span class="number">20</span>):</span><br><span class="line">    <span class="built_in">print</span>(i, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">带有yield的函数都被看成生成器，生成器是可迭代对象，且具备__iter__和 __next__方法， 可以遍历获取元素, python要求迭代器本身也是可迭代的，所以我们还要为迭代器实现__iter__方法，而__iter__方法要返回一个迭代器，迭代器自身正是一个迭代器，所以迭代器的__iter__方法返回自身即可</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>类内部实现魔法方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FibNumber</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        :param n: int 指生成数列的个数</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        self.n = n</span><br><span class="line">        <span class="comment"># 保存当前生成到的数据列的第几个数据，生成器中性质，记录位置，下一个位置的数据</span></span><br><span class="line">        self.current = <span class="number">0</span></span><br><span class="line">        self.a = <span class="number">0</span></span><br><span class="line">        self.b = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;当使用next()函数调用时，就会获取下一个数&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> self.current &lt; self.n:</span><br><span class="line">            self.a, self.b = self.b, self.a + self.b</span><br><span class="line">            self.current += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> self.a</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;迭代器的__iter__ 返回自身即可&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    fib = FibNumber(<span class="number">20</span>)</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> fib:</span><br><span class="line">        <span class="built_in">print</span>(num, end=<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;冒泡排序的思想: 每次比较两个相邻的元素, 如果他们的顺序错误就把他们交换位置&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    # 升序排序，从列表最前面开始进行判断，如果后面一个小于前面一个，则交换位置,依次比较</span></span><br><span class="line"><span class="string">    # 第一次循环就会把最大的值放到列表的最后面</span></span><br><span class="line"><span class="string">    # 第二次循环就会把第二大的值放到最大值的前面，以此类推</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bubble_sort</span>(<span class="params">nums</span>):</span></span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums) - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> num_index <span class="keyword">in</span> <span class="built_in">range</span>(index):</span><br><span class="line">            <span class="keyword">if</span> nums[num_index] &gt; nums[num_index + <span class="number">1</span>]:</span><br><span class="line">                nums[num_index], nums[num_index + <span class="number">1</span>] = nums[num_index + <span class="number">1</span>], nums[num_index]</span><br><span class="line">    <span class="keyword">return</span> nums</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = bubble_sort([<span class="number">29</span>, <span class="number">55</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">99</span>])</span><br><span class="line"><span class="built_in">print</span>(res)	</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[1, 5, 7, 29, 33, 44, 55, 99]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="快排"><a href="#快排" class="headerlink" title="快排"></a>快排</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quick_sort</span>(<span class="params">array</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param array: 列表</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    lower = []</span><br><span class="line">    higher = []</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;递归条件结束&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(array) &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> array</span><br><span class="line">    <span class="comment"># 把最后一个弹出来的值作为中间点</span></span><br><span class="line">    pivot = array.pop()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> array:</span><br><span class="line">        <span class="keyword">if</span> i &gt;= pivot:</span><br><span class="line">            higher.append(i)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            lower.append(i)</span><br><span class="line">    <span class="keyword">return</span> quick_sort(lower) + [pivot] + quick_sort(higher)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = quick_sort([<span class="number">10</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">55</span>, <span class="number">6</span>, <span class="number">88</span>, <span class="number">99</span>, <span class="number">1999</span>])</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;[6, 10, 22, 33, 55, 88, 99, 1999]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="排序算法分析"><a href="#排序算法分析" class="headerlink" title="排序算法分析"></a>排序算法分析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、排序算法的稳定性：如果在对象序列中有两个对象 r[i]和r[j] ,它们的排序码 k[i]==k[j] 。如果排序前后,对象 r[i]和 r[j] 的相对位置不变，则称排序算法是稳定的；否则排序算法是不稳定的。</span><br><span class="line"><span class="number">2</span>、时间开销：排序的时间开销可用算法执行中的数据比较次数与数据移动次数来衡量。</span><br><span class="line">算法运行时间代价的大略估算一般都按平均情况进行估算。对于那些受对象排序码序列初始排列及对象个数影响较大的，需要按最好情况和最坏情况进行估算</span><br><span class="line"><span class="number">3</span>、空间开销：算法执行时所需的附加存储。</span><br></pre></td></tr></table></figure>

<h2 id="三元表达式"><a href="#三元表达式" class="headerlink" title="三元表达式"></a>三元表达式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="built_in">input</span>(<span class="string">&#x27;姓名&gt;&gt;: &#x27;</span>)</span><br><span class="line">res=<span class="string">&#x27;SB&#x27;</span> <span class="keyword">if</span> name == <span class="string">&#x27;xxx&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;NB&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<h2 id="列表推导式"><a href="#列表推导式" class="headerlink" title="列表推导式"></a>列表推导式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">将原列表的值整体+<span class="number">1</span></span><br><span class="line">info = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line">a = [i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> info]</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="生成器表达式"><a href="#生成器表达式" class="headerlink" title="生成器表达式"></a>生成器表达式</h2><p>生成器是一个特殊的程序，可以被用作控制循环的迭代行为，python中生成器是迭代器的一种，使用yield返回值函数，每次调用yield会暂停，而可以使用next()函数和send()函数恢复生成器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">把列表推导式的[]换成()就是生成器表达式</span><br><span class="line">g = (i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(g)) </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;0&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(g)) </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;[1,....,99]&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h2><ul>
<li>迭代器就是一种不依赖于索引的迭代方法称之为迭代器</li>
</ul>
<p>​        优点：<br>​              - 提供一种统一的、不依赖于索引的迭代方式<br>​              - 惰性计算，节省内存<br>​        缺点：<br>​              - 无法获取长度（只有在next完毕才知道到底有几个值）<br>​              - 一次性的，只能往后走，不能往前退往后走，不能往前退</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">迭代器（迭代就是循环）</span><br><span class="line">　　迭代器包含有<span class="built_in">next</span>方法的实现，在正确的范围内返回期待的数据以及超出范围后能够抛出StopIteration的错误停止迭代。</span><br><span class="line"></span><br><span class="line">我们已经知道，可以直接作用于<span class="keyword">for</span>循环的数据类型有以下几种：</span><br><span class="line"></span><br><span class="line">一类是集合数据类型，如<span class="built_in">list</span>,<span class="built_in">tuple</span>,<span class="built_in">dict</span>,<span class="built_in">set</span>,<span class="built_in">str</span>等</span><br><span class="line"></span><br><span class="line">一类是generator，包括生成器和带<span class="keyword">yield</span>的generator function</span><br><span class="line"></span><br><span class="line">这些可以直接作用于<span class="keyword">for</span> 循环的对象统称为可迭代对象：Iterable</span><br><span class="line"></span><br><span class="line">可以使用<span class="built_in">isinstance</span>()判断一个对象是否为可Iterable对象</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Iterable</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>([], Iterable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(&#123;&#125;, Iterable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="string">&#x27;abc&#x27;</span>, Iterable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>((x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)), Iterable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="number">100</span>, Iterable)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>生成器都是<code>Iterator</code>对象，但<code>list</code>、<code>dict</code>、<code>str</code>虽然是<code>Iterable（可迭代对象）</code>，却不是<code>Iterator（迭代器）</code></p>
<p>**把<code>list</code>、<code>dict</code>、<code>str</code>等<code>Iterable</code>变成<code>Iterator</code>**可以使用<code>iter()</code>函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="built_in">iter</span>([]), Iterator)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="built_in">iter</span>(<span class="string">&#x27;abc&#x27;</span>), Iterator)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>**<code>判断下列数据类型是可迭代对象or迭代器</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&#x27;hello&#x27;</span>     <span class="comment">#字符串是可迭代对象，但不是迭代器</span></span><br><span class="line">l=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]     <span class="comment">#列表是可迭代对象，但不是迭代器</span></span><br><span class="line">t=(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)       <span class="comment">#元组是可迭代对象，但不是迭代器</span></span><br><span class="line">d=&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">1</span>&#125;        <span class="comment">#字典是可迭代对象，但不是迭代器</span></span><br><span class="line"><span class="built_in">set</span>=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;     <span class="comment">#集合是可迭代对象，但不是迭代器</span></span><br><span class="line"><span class="comment"># *************************************</span></span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>) <span class="comment">#文件是可迭代对象，是迭代器</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#如何判断是可迭代对象，只有__iter__方法，执行该方法得到的迭代器对象。</span></span><br><span class="line"><span class="comment"># 及可迭代对象通过__iter__转成迭代器对象</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Iterator  <span class="comment">#迭代器</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Iterable  <span class="comment">#可迭代对象</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(s,Iterator))     <span class="comment">#判断是不是迭代器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(s,Iterable))       <span class="comment">#判断是不是可迭代对象</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#把可迭代对象转换为迭代器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(<span class="built_in">iter</span>(s),Iterator))</span><br></pre></td></tr></table></figure>

<p><code>yeild总结</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>带有<span class="keyword">yield</span>的函数不再是一个普通的函数，而是一个生成器generator，可用于迭代</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span><span class="keyword">yield</span>是一个类似<span class="keyword">return</span> 的关键字，迭代一次遇到<span class="keyword">yield</span>的时候就返回<span class="keyword">yield</span>后面或者右面的值。而且下一次迭代的时候，从上一次迭代遇到的<span class="keyword">yield</span>后面的代码开始执行</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span><span class="keyword">yield</span>就是<span class="keyword">return</span>返回的一个值，并且记住这个返回的位置。下一次迭代就从这个位置开始。</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>带有<span class="keyword">yield</span>的函数不仅仅是只用于<span class="keyword">for</span>循环，而且可用于某个函数的参数，只要这个函数的参数也允许迭代参数。</span><br></pre></td></tr></table></figure>

<h2 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">函数的递归调用：就是在调用一个函数的过程中又直接或间接地调用自己</span><br><span class="line">直接调用本身</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;from f1&#x27;</span>)</span><br><span class="line">    f1()</span><br><span class="line">f1()</span><br></pre></td></tr></table></figure>

<p>间接调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">m</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;from f1&#x27;</span>, m)</span><br><span class="line">    f2(m+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;from f2&#x27;</span>, n)</span><br><span class="line">    f1(n + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f1(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">from f1 1</span></span><br><span class="line"><span class="string">from f2 2</span></span><br><span class="line"><span class="string">from f1 3</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>递归总结</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">递归调用应该包含两个明确的阶段：回溯，递推</span><br><span class="line">    回溯就是从外向里一层一层递归调用下去，</span><br><span class="line">        回溯阶段必须要有一个明确地结束条件，每进入下一次递归时，问题的规模都应该有所减少（否则，单纯地重复调用自身是毫无意义的）</span><br><span class="line"></span><br><span class="line">    递推就是从里向外一层一层结束递归</span><br></pre></td></tr></table></figure>

<h2 id="二分法"><a href="#二分法" class="headerlink" title="二分法"></a>二分法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span>(<span class="params">array, find_num</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(array) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;find_num not exist&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        middle_num_index = <span class="built_in">len</span>(array) // <span class="number">2</span></span><br><span class="line">        <span class="built_in">print</span>(middle_num_index)</span><br><span class="line">        <span class="keyword">if</span> find_num &gt; array[middle_num_index]:</span><br><span class="line">            <span class="string">&#x27;&#x27;&#x27;寻找数》中间数，从列表中间值的下一个数到末尾值区间找&#x27;&#x27;&#x27;</span></span><br><span class="line">            binary_search(array[middle_num_index + <span class="number">1</span>:], find_num)</span><br><span class="line">        <span class="keyword">elif</span> find_num &lt; array[middle_num_index]:</span><br><span class="line">            <span class="string">&#x27;&#x27;&#x27;寻找数《中间数,从列表左边到中间值区间找&#x27;&#x27;&#x27;</span></span><br><span class="line">            binary_search(array[:middle_num_index], find_num)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;find it&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">binary_search(array, <span class="number">7</span>)</span><br></pre></td></tr></table></figure>

<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><ul>
<li>匿名函数：与函数有相同的作用域，但是匿名意味着引用计数为0，使用一次就释放</li>
<li>应用：max，min，sorted,map,reduce,filter</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">salaries=&#123;</span><br><span class="line">    <span class="string">&#x27;egon&#x27;</span>:<span class="number">3000</span>,</span><br><span class="line">    <span class="string">&#x27;alex&#x27;</span>:<span class="number">100000000</span>,</span><br><span class="line">    <span class="string">&#x27;wupeiqi&#x27;</span>:<span class="number">10000</span>,</span><br><span class="line">    <span class="string">&#x27;yuanhao&#x27;</span>:<span class="number">2000</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">max</span>(salaries.values()) <span class="comment">#最大薪资，比较的是value</span></span><br><span class="line"><span class="number">100000000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">min</span>(salaries.values()) <span class="comment">#最小薪资，比较的是key</span></span><br><span class="line"><span class="number">2000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">max</span>(salaries.keys())   <span class="comment">#最大薪资人名，比较是key中字符串的ASCII码</span></span><br><span class="line"><span class="string">&#x27;yuanhao&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">min</span>(salaries.keys())   <span class="comment">#最小薪资人名，比较是key中字符串的ASCII码</span></span><br><span class="line"><span class="string">&#x27;alex&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">max</span>(salaries,key=<span class="keyword">lambda</span> k:salaries[k]) <span class="comment"># 最大薪资，比较的是salaries的值，得到的是键</span></span><br><span class="line"><span class="string">&#x27;alex&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">min</span>(salaries,key=<span class="keyword">lambda</span> k:salaries[k]) <span class="comment"># 最小薪资，比较的是salaries的值，得到的是键</span></span><br><span class="line"><span class="string">&#x27;yuanhao&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>zip</p>
<ul>
<li>解压（元祖的形式）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">先比较值，值相同则比较键</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>zip_obj = <span class="built_in">zip</span>(salaries.values(),salaries.keys())</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">max</span>(zip_obj)</span><br><span class="line">(<span class="number">100000000</span>, <span class="string">&#x27;alex&#x27;</span>)</span><br><span class="line"></span><br><span class="line">zip_obj是迭代器，因而只能访问一次</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">min</span>(zip_obj)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: <span class="built_in">min</span>() arg <span class="keyword">is</span> an empty sequence</span><br></pre></td></tr></table></figure>

<p>map</p>
<ul>
<li><p>映射</p>
</li>
<li><p>Python 2.x 返回列表</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">square</span>(<span class="params">x</span>) :</span>            <span class="comment"># 计算平方数</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x ** <span class="number">2</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">map</span>(square, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])   <span class="comment"># 计算列表各个元素的平方</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">map</span>(<span class="keyword">lambda</span> x: x ** <span class="number">2</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])  <span class="comment"># 使用 lambda 匿名函数</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提供了两个列表，对相同位置的列表数据进行相加</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">map</span>(<span class="keyword">lambda</span> x, y: x + y, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>], [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>])</span><br><span class="line">[<span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">19</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>Python 3.x 返回迭代器</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">square</span>(<span class="params">x</span>) :</span>         <span class="comment"># 计算平方数</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x ** <span class="number">2</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">map</span>(square, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])    <span class="comment"># 计算列表各个元素的平方</span></span><br><span class="line">&lt;<span class="built_in">map</span> <span class="built_in">object</span> at <span class="number">0x100d3d550</span>&gt;     <span class="comment"># 返回迭代器</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">map</span>(square, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]))   <span class="comment"># 使用 list() 转换为列表</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x ** <span class="number">2</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]))   <span class="comment"># 使用 lambda 匿名函数</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>]</span><br></pre></td></tr></table></figure>

<p>map映射一个新列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dic_list = [&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;alex&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;male&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="string">&#x27;38&#x27;</span>, <span class="string">&#x27;salary&#x27;</span>: <span class="string">&#x27;30000&#x27;</span>&#125;]</span><br><span class="line">new_dic_list = <span class="built_in">map</span>(<span class="keyword">lambda</span> dic: &#123;<span class="string">&#x27;name&#x27;</span>: dic[<span class="string">&#x27;name&#x27;</span>].upper(),</span><br><span class="line">                                <span class="string">&#x27;&#x27;&#x27;title()首字母变大写&#x27;&#x27;&#x27;</span></span><br><span class="line">                                <span class="string">&#x27;gender&#x27;</span>: dic[<span class="string">&#x27;gender&#x27;</span>].title(),</span><br><span class="line">                                <span class="string">&#x27;age&#x27;</span>: dic[<span class="string">&#x27;age&#x27;</span>].title(),</span><br><span class="line">                                <span class="string">&#x27;salary&#x27;</span>: dic[<span class="string">&#x27;salary&#x27;</span>]</span><br><span class="line">                                &#125;, dic_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(new_dic_list))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;[&#123;&#x27;name&#x27;: &#x27;ALEX&#x27;, &#x27;gender&#x27;: &#x27;Male&#x27;, &#x27;age&#x27;: &#x27;38&#x27;, &#x27;salary&#x27;: &#x27;30000&#x27;&#125;]&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>filter</p>
<ul>
<li>过滤</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dic_list = [&#123;&#x27;name&#x27;: &#x27;alex&#x27;, &#x27;gender&#x27;: &#x27;male&#x27;, &#x27;age&#x27;: &#x27;38&#x27;, &#x27;salary&#x27;: &#x27;30000&#x27;&#125;,</span><br><span class="line">            &#123;&#x27;name&#x27;: &#x27;blex&#x27;, &#x27;gender&#x27;: &#x27;male&#x27;, &#x27;age&#x27;: &#x27;38&#x27;, &#x27;salary&#x27;: &#x27;30000&#x27;&#125;]</span><br><span class="line"></span><br><span class="line">g = filter(lambda dic: dic[&#x27;name&#x27;].startswith(&#x27;a&#x27;), dic_list)</span><br><span class="line">print(list(g))</span><br><span class="line">&#x27;&#x27;&#x27;[&#123;&#x27;name&#x27;: &#x27;ALEX&#x27;, &#x27;gender&#x27;: &#x27;Male&#x27;, &#x27;age&#x27;: &#x27;38&#x27;, &#x27;salary&#x27;: &#x27;30000&#x27;&#125;]&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><ul>
<li>内部函数引用了外层函数的参数和临时变量</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">在内函数中，如果想改变外部函数的临时变量</span></span><br><span class="line"><span class="string">方法1 nonlocal关键字声明</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">方法2，把闭包变量修改成可变数据类型 比如列表</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 方法1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">counter</span>():</span></span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">incr</span>():</span></span><br><span class="line">        <span class="keyword">nonlocal</span> n</span><br><span class="line">        x = n</span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> incr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = counter()</span><br><span class="line">c()  <span class="comment"># 0</span></span><br><span class="line">c()  <span class="comment"># 1</span></span><br><span class="line">c()  <span class="comment"># 2</span></span><br><span class="line">c()  <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">counter</span>():</span></span><br><span class="line">    n = [<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">incr</span>():</span></span><br><span class="line"></span><br><span class="line">        n[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(n[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> incr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = counter()</span><br><span class="line">c()  <span class="comment"># 0</span></span><br><span class="line">c()  <span class="comment"># 1</span></span><br><span class="line">c()  <span class="comment"># 2</span></span><br><span class="line">c()  <span class="comment"># 3</span></span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<h2 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h2><p><img src="/2020/08/23/python/image-20201121173051673.png" alt="python"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">f</span>):</span></span><br><span class="line">    <span class="comment"># 2. f = func</span></span><br><span class="line"><span class="meta">    @wraps(<span class="params">f</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="number">111</span>)  <span class="comment"># 5. 打印111</span></span><br><span class="line">        ret = f(*args, **kwargs)  <span class="comment"># 6 func(*args, **kwargs) 执行func函数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="number">222</span>)  <span class="comment"># 8 打印222</span></span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner  <span class="comment"># 3. 返回inner的内存地址</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@wrapper  </span><span class="comment"># 1. func = wrapper(func)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;in func&#x27;</span>)  <span class="comment"># 7.打印 in func</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func()  <span class="comment"># 4. func() 相当于 inner()</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(func, func.__name__)  <span class="comment"># (不加装饰器wraps) &lt;function wrapper.&lt;locals&gt;.inner at 0x0000028AD703E8B8&gt; inner</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;打印结果</span></span><br><span class="line"><span class="string">111</span></span><br><span class="line"><span class="string">in func</span></span><br><span class="line"><span class="string">222</span></span><br><span class="line"><span class="string">&lt;function func at 0x000002D120EAE8B8&gt; func (加了装饰器wraps)</span></span><br></pre></td></tr></table></figure>

<h2 id="计时器使用之装饰器"><a href="#计时器使用之装饰器" class="headerlink" title="计时器使用之装饰器"></a>计时器使用之装饰器</h2><ul>
<li>装饰器遵循开放封闭的原则，再不改变原代码的基础上，为函数新增功能</li>
<li>应用场景：统计时间，登录</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trace</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">    @functools.wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        v = func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, cost: &#123;&#125; seconds&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">                func.__name__, args, kwargs, v, (end - start)))</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@trace</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    it = <span class="built_in">iter</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">next</span>(it))</span><br><span class="line">        <span class="keyword">except</span> StopIteration:</span><br><span class="line">            <span class="comment"># 遇到StopIteration就跳出循环, 且自动频闭StopIteration异常</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">test()</span><br></pre></td></tr></table></figure>

<h2 id="有参装饰器"><a href="#有参装饰器" class="headerlink" title="有参装饰器"></a>有参装饰器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outter</span>(<span class="params">engine</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deco2</span>(<span class="params">func2</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper2</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">            inp_name = <span class="built_in">input</span>(<span class="string">&#x27;username&gt;&gt;&gt;: &#x27;</span>).strip()</span><br><span class="line">            inp_pwd = <span class="built_in">input</span>(<span class="string">&#x27;password&gt;&gt;&gt;: &#x27;</span>).strip()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> engine == <span class="string">&quot;file&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;基于file的认证&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> inp_name == <span class="string">&quot;egon&quot;</span> <span class="keyword">and</span> inp_pwd == <span class="string">&quot;123&quot;</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;login successful&#x27;</span>)</span><br><span class="line">                    res = func2(*args, **kwargs)</span><br><span class="line">                    <span class="keyword">return</span> res</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;username or password error&#x27;</span>)</span><br><span class="line">            <span class="keyword">elif</span> engine == <span class="string">&#x27;mysql&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;基于mysql的认证&#x27;</span>)</span><br><span class="line">            <span class="keyword">elif</span> engine == <span class="string">&#x27;ldap&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;基于ldap的认证&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;未知的engine&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wrapper2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> deco2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@outter(<span class="params">engine=<span class="string">&#x27;file&#x27;</span></span>)  </span><span class="comment"># @deco2 # index=deco2(index)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;index=&gt;&#x27;</span>, x, y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index(<span class="number">1</span>, <span class="number">2</span>)  <span class="comment"># index=&gt;wrapper2</span></span><br></pre></td></tr></table></figure>

<h2 id="常用模块"><a href="#常用模块" class="headerlink" title="常用模块"></a>常用模块</h2><ul>
<li>time</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.time()  时间戳</span><br><span class="line"><span class="number">1627206013.6049714</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.strftime(<span class="string">&quot;%Y-%m-%d %X&quot;</span>) 格式化时间字符串</span><br><span class="line"><span class="string">&#x27;2021-07-25 17:40:25&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.strftime(<span class="string">&quot;%Y-%m-%d %X&quot;</span>)</span><br><span class="line"><span class="string">&#x27;2021-07-25 17:40:37&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.gmtime()</span><br><span class="line">time.struct_time(tm_year=<span class="number">2021</span>, tm_mon=<span class="number">7</span>, tm_mday=<span class="number">25</span>, tm_hour=<span class="number">9</span>, tm_min=<span class="number">40</span>, tm_sec=<span class="number">43</span>, tm_wday=<span class="number">6</span>, tm_yday=<span class="number">206</span>, tm_isdst=<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.localtime()</span><br><span class="line">time.struct_time(tm_year=<span class="number">2021</span>, tm_mon=<span class="number">7</span>, tm_mday=<span class="number">25</span>, tm_hour=<span class="number">17</span>, tm_min=<span class="number">41</span>, tm_sec=<span class="number">7</span>, tm_wday=<span class="number">6</span>, tm_yday=<span class="number">206</span>, tm_isdst=<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>datetime</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.datetime.now() </span><br><span class="line">datetime.datetime(<span class="number">2021</span>, <span class="number">7</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">44</span>, <span class="number">1</span>, <span class="number">343302</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.date.fromtimestamp(time.time()) <span class="comment"># 日期格式</span></span><br><span class="line">datetime.date(<span class="number">2021</span>, <span class="number">7</span>, <span class="number">25</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.datetime.now() + datetime.timedelta(<span class="number">3</span>) <span class="comment"># 当前时间+3天</span></span><br><span class="line">datetime.datetime(<span class="number">2021</span>, <span class="number">7</span>, <span class="number">28</span>, <span class="number">17</span>, <span class="number">45</span>, <span class="number">21</span>, <span class="number">190108</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>random</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(random.random()) <span class="comment">#0.9452247845902332 大于0且小于1之间的小数</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(random.randint(<span class="number">1</span>,<span class="number">6</span>)) <span class="comment"># 大于等于1且小于等于6之间的整数</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(random.randrange(<span class="number">1</span>,<span class="number">6</span>)) <span class="comment"># 大于等于1且小于6之间的整数</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(random.choice([<span class="number">1</span>,<span class="string">&quot;11&quot;</span>,[<span class="number">4</span>,<span class="number">5</span>]])) <span class="comment">#1或者11或者[4,5]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(random.sample([<span class="number">1</span>,<span class="string">&quot;11&quot;</span>,[<span class="number">4</span>,<span class="number">5</span>]],<span class="number">2</span>)) <span class="comment">#列表元素任意2个组合 [&#x27;11&#x27;, 1]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(random.uniform(<span class="number">1</span>,<span class="number">3</span>)) <span class="comment">#大于1小于3的小数，如1.927109612082716</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0.17907399398718404</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">2</span></span><br><span class="line"><span class="string">[4, 5]</span></span><br><span class="line"><span class="string">[1, [4, 5]]</span></span><br><span class="line"><span class="string">2.5553886836999373</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">item = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]</span><br><span class="line">random.shuffle(item) <span class="comment">##打乱item的顺序,相当于&quot;洗牌&quot;</span></span><br><span class="line"><span class="built_in">print</span>(item)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;[1, 7, 5, 9, 3]&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">code</span>(<span class="params">n</span>):</span>  <span class="comment">#随机验证码</span></span><br><span class="line">    res = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        s1 = <span class="built_in">str</span>(random.randint(<span class="number">1</span>, <span class="number">10</span>))</span><br><span class="line">        s2 = <span class="built_in">chr</span>(random.randint(<span class="number">65</span>, <span class="number">90</span>))</span><br><span class="line">        res += random.choice([s1, s2])</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(code(<span class="number">5</span>))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;BDG6D&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>json</li>
<li>序列化:把python的对象编码转换为json格式的字符串，用以保存在文件中或通过网络传输，称之为序列化过程, 在序列化时，中文汉字总是被转换为unicode码，在dumps函数中添加参数ensure_ascii=False即可解决。</li>
<li>反序列化:把json格式字符串解码为python数据对象，转换成内存中原来的数据类型，称之为反序列化过程</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、序列化与反序列化</span></span><br><span class="line"><span class="comment"># json</span></span><br><span class="line"><span class="comment"># 优点：跨平台交互数据</span></span><br><span class="line"><span class="comment"># 缺点：无法识别所有的python数据类型</span></span><br><span class="line"><span class="comment"># 注意：json格式的字符串里不能包含单引号</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#序列化方式一</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">t =&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;c&#x27;</span>:<span class="number">3</span>&#125;</span><br><span class="line">res = json.dumps(t)</span><br><span class="line"><span class="built_in">print</span>(res,<span class="built_in">type</span>(res))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;db.txx&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf_8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(res)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: 2, &quot;c&quot;: 3&#125; &lt;class &#x27;str&#x27;&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 反序列化方式一</span></span><br><span class="line">t =&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;c&#x27;</span>:<span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;db.txx&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">   res = json.loads(f.read())</span><br><span class="line">   <span class="built_in">print</span>(res)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;&#123;&#x27;a&#x27;: 1, &#x27;b&#x27;: 2, &#x27;c&#x27;: 3&#125;&#x27;&#x27;&#x27;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#序列化方式二</span></span><br><span class="line">t =&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;c&#x27;</span>:<span class="number">3</span>&#125;   <span class="comment"># 字典=======》json格式的字符串：&quot;&#123;&#x27;a&#x27;:1,&#x27;b&#x27;:2,&#x27;c&#x27;:3&#125; &quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;.db.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(t,f)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;文件：&#123;&quot;a&quot;: 1, &quot;b&quot;: 2, &quot;c&quot;: 3&#125;&#x27;&#x27;&#x27;</span> </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 反序列化方式二</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;.db.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    res = json.load(f)</span><br><span class="line">    <span class="built_in">print</span>(res,<span class="built_in">type</span>(res))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;&#123;&#x27;a&#x27;: 1, &#x27;b&#x27;: 2, &#x27;c&#x27;: 3&#125; &lt;class &#x27;dict&#x27;&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 序列化与反序列化其它数据类型</span></span><br><span class="line"><span class="comment"># 序列化</span></span><br><span class="line">s = json.dumps((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line"><span class="built_in">print</span>(s) <span class="comment"># [1, 2, 3] 元组序列化后转成列表</span></span><br><span class="line"></span><br><span class="line">s = json.dumps((<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(s,<span class="built_in">type</span>(s)) <span class="comment"># 1 &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line">s = json.dumps(&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lhj&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(s,<span class="built_in">type</span>(s)) <span class="comment"># 字典序列化后成字符串&#123;&quot;name&quot;: &quot;lhj&quot;, &quot;age&quot;: 18&#125; &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line">s = json.dumps(<span class="built_in">set</span>(<span class="string">&#x27;aaabbc&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(s) <span class="comment"># 报错 集合不可以被序列化</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;s = json.dumps(set(&#x27;aaabbc&#x27;))</span></span><br><span class="line"><span class="string">print(s) # 报错 集合不可以被序列化&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 反序列化</span></span><br><span class="line">s = json.dumps([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">ls = json.loads(s)</span><br><span class="line"><span class="built_in">print</span>(ls,<span class="built_in">type</span>(ls))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;[1, 2, 3] &lt;class &#x27;list&#x27;&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">s = json.dumps(<span class="string">&#x27;abcd&#x27;</span>)</span><br><span class="line">ls = json.loads(s)</span><br><span class="line"><span class="built_in">print</span>(ls,<span class="built_in">type</span>(ls))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;abcd &lt;class &#x27;str&#x27;&gt;&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>os</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">os模块是与操作系统交互的一个接口</span><br><span class="line">os.getcwd() 获取当前工作目录，即当前python脚本工作的目录路径</span><br><span class="line">os.chdir(<span class="string">&quot;dirname&quot;</span>)  改变当前脚本工作目录；相当于shell下cd</span><br><span class="line">os.curdir  返回当前目录: (<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">os.pardir  获取当前目录的父目录字符串名：(<span class="string">&#x27;..&#x27;</span>)</span><br><span class="line">os.makedirs(<span class="string">&#x27;dirname1/dirname2&#x27;</span>)    可生成多层递归目录</span><br><span class="line">os.removedirs(<span class="string">&#x27;dirname1&#x27;</span>)    若目录为空，则删除，并递归到上一级目录，如若也为空，则删除，依此类推</span><br><span class="line">os.mkdir(<span class="string">&#x27;dirname&#x27;</span>)    生成单级目录；相当于shell中mkdir dirname</span><br><span class="line">os.rmdir(<span class="string">&#x27;dirname&#x27;</span>)    删除单级空目录，若目录不为空则无法删除，报错；相当于shell中rmdir dirname</span><br><span class="line">os.listdir(<span class="string">&#x27;dirname&#x27;</span>)    列出指定目录下的所有文件和子目录，包括隐藏文件，并以列表方式打印</span><br><span class="line">os.remove()  删除一个文件</span><br><span class="line">os.rename(<span class="string">&quot;oldname&quot;</span>,<span class="string">&quot;newname&quot;</span>)  重命名文件/目录</span><br><span class="line">os.stat(<span class="string">&#x27;path/filename&#x27;</span>)  获取文件/目录信息</span><br><span class="line">os.sep    输出操作系统特定的路径分隔符，win下为<span class="string">&quot;\\&quot;</span>,Linux下为<span class="string">&quot;/&quot;</span></span><br><span class="line">os.linesep    输出当前平台使用的行终止符，win下为<span class="string">&quot;\t\n&quot;</span>,Linux下为<span class="string">&quot;\n&quot;</span></span><br><span class="line">os.pathsep    输出用于分割文件路径的字符串 win下为;,Linux下为:</span><br><span class="line">os.name    输出字符串指示当前使用平台。win-&gt;<span class="string">&#x27;nt&#x27;</span>; Linux-&gt;<span class="string">&#x27;posix&#x27;</span></span><br><span class="line">os.system(<span class="string">&quot;bash command&quot;</span>)  运行shell命令，直接显示</span><br><span class="line">os.environ  获取系统环境变量</span><br><span class="line">os.path.abspath(path)  返回path规范化的绝对路径</span><br><span class="line">os.path.split(path)  将path分割成目录和文件名二元组返回</span><br><span class="line">os.path.dirname(path)  返回path的目录。其实就是os.path.split(path)的第一个元素</span><br><span class="line">os.path.basename(path)  返回path最后的文件名。如何path以／或\结尾，那么就会返回空值。即os.path.split(path)的第二个元素</span><br><span class="line">os.path.exists(path)  如果path存在，返回<span class="literal">True</span>；如果path不存在，返回<span class="literal">False</span></span><br><span class="line">os.path.isabs(path)  如果path是绝对路径，返回<span class="literal">True</span></span><br><span class="line">os.path.isfile(path)  如果path是一个存在的文件，返回<span class="literal">True</span>。否则返回<span class="literal">False</span></span><br><span class="line">os.path.isdir(path)  如果path是一个存在的目录，则返回<span class="literal">True</span>。否则返回<span class="literal">False</span></span><br><span class="line">os.path.join(path1[, path2[, ...]])  将多个路径组合后返回，第一个绝对路径之前的参数将被忽略</span><br><span class="line">os.path.getatime(path)  返回path所指向的文件或者目录的最后存取时间</span><br><span class="line">os.path.getmtime(path)  返回path所指向的文件或者目录的最后修改时间</span><br><span class="line">os.path.getsize(path) 返回path的大小</span><br></pre></td></tr></table></figure>

<ul>
<li>sys</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">python解释器相关的操作</span><br><span class="line"><span class="comment"># 获取命令行方式运行脚本的后面参数</span></span><br><span class="line"><span class="number">1</span> sys.argv[<span class="number">0</span>]        命令行参数<span class="type">List</span>，第一个元素是程序本身路径</span><br><span class="line"><span class="number">2</span> sys.exit(n)        退出程序，正常退出时exit(<span class="number">0</span>)</span><br><span class="line"><span class="number">3</span> sys.version        获取Python解释程序的版本信息</span><br><span class="line"><span class="number">4</span> sys.maxint         最大的Int值</span><br><span class="line"><span class="number">5</span> sys.path           返回模块的搜索路径，初始化时使用PYTHONPATH环境变量的值</span><br><span class="line"><span class="number">6</span> sys.platform       返回操作系统平台名称</span><br></pre></td></tr></table></figure>



<ul>
<li>configpaser</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cofig.cfg配置文件</span><br><span class="line"><span class="comment"># 注释1</span></span><br><span class="line">; 注释<span class="number">2</span></span><br><span class="line"></span><br><span class="line">[section1]</span><br><span class="line">k1 = v1</span><br><span class="line">k2:v2</span><br><span class="line">user=egon</span><br><span class="line">age=<span class="number">18</span></span><br><span class="line">is_admin=true</span><br><span class="line">salary=<span class="number">31</span></span><br><span class="line"></span><br><span class="line">[section2]</span><br><span class="line">k1 = v1</span><br></pre></td></tr></table></figure>

<ul>
<li>读取</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line">config=configparser.ConfigParser()</span><br><span class="line">config.read(<span class="string">&#x27;a.cfg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看所有的标题</span></span><br><span class="line">res=config.sections() <span class="comment">#[&#x27;section1&#x27;, &#x27;section2&#x27;]</span></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看标题section1下所有key=value的key</span></span><br><span class="line">options=config.options(<span class="string">&#x27;section1&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(options) <span class="comment">#[&#x27;k1&#x27;, &#x27;k2&#x27;, &#x27;user&#x27;, &#x27;age&#x27;, &#x27;is_admin&#x27;, &#x27;salary&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看标题section1下所有key=value的(key,value)格式</span></span><br><span class="line">item_list=config.items(<span class="string">&#x27;section1&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(item_list) <span class="comment">#[(&#x27;k1&#x27;, &#x27;v1&#x27;), (&#x27;k2&#x27;, &#x27;v2&#x27;), (&#x27;user&#x27;, &#x27;egon&#x27;), (&#x27;age&#x27;, &#x27;18&#x27;), (&#x27;is_admin&#x27;, &#x27;true&#x27;), (&#x27;salary&#x27;, &#x27;31&#x27;)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看标题section1下user的值=&gt;字符串格式</span></span><br><span class="line">val=config.get(<span class="string">&#x27;section1&#x27;</span>,<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(val) <span class="comment">#egon</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看标题section1下age的值=&gt;整数格式</span></span><br><span class="line">val1=config.getint(<span class="string">&#x27;section1&#x27;</span>,<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(val1) <span class="comment">#18</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看标题section1下is_admin的值=&gt;布尔值格式</span></span><br><span class="line">val2=config.getboolean(<span class="string">&#x27;section1&#x27;</span>,<span class="string">&#x27;is_admin&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(val2) <span class="comment">#True</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看标题section1下salary的值=&gt;浮点型格式</span></span><br><span class="line">val3=config.getfloat(<span class="string">&#x27;section1&#x27;</span>,<span class="string">&#x27;salary&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(val3) <span class="comment">#31.0</span></span><br></pre></td></tr></table></figure>

<ul>
<li>改写</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line">config=configparser.ConfigParser()</span><br><span class="line">config.read(<span class="string">&#x27;a.cfg&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除整个标题section2</span></span><br><span class="line">config.remove_section(<span class="string">&#x27;section2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除标题section1下的某个k1和k2</span></span><br><span class="line">config.remove_option(<span class="string">&#x27;section1&#x27;</span>,<span class="string">&#x27;k1&#x27;</span>)</span><br><span class="line">config.remove_option(<span class="string">&#x27;section1&#x27;</span>,<span class="string">&#x27;k2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#判断是否存在某个标题</span></span><br><span class="line"><span class="built_in">print</span>(config.has_section(<span class="string">&#x27;section1&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#判断标题section1下是否有user</span></span><br><span class="line"><span class="built_in">print</span>(config.has_option(<span class="string">&#x27;section1&#x27;</span>,<span class="string">&#x27;&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加一个标题</span></span><br><span class="line">config.add_section(<span class="string">&#x27;egon&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#在标题egon下添加name=egon,age=18的配置</span></span><br><span class="line">config.<span class="built_in">set</span>(<span class="string">&#x27;egon&#x27;</span>,<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;egon&#x27;</span>)</span><br><span class="line">config.<span class="built_in">set</span>(<span class="string">&#x27;egon&#x27;</span>,<span class="string">&#x27;age&#x27;</span>,<span class="number">18</span>) <span class="comment">#报错,必须是字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#最后将修改的内容写入文件,完成最终的修改</span></span><br><span class="line">config.write(<span class="built_in">open</span>(<span class="string">&#x27;a.cfg&#x27;</span>,<span class="string">&#x27;w&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>hashlib</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">m=hashlib.md5()<span class="comment"># m=hashlib.sha256()</span></span><br><span class="line"></span><br><span class="line">m.update(<span class="string">&#x27;hello&#x27;</span>.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(m.hexdigest())  <span class="comment">#5d41402abc4b2a76b9719d911017c592</span></span><br><span class="line"></span><br><span class="line">m.update(<span class="string">&#x27;alvin&#x27;</span>.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(m.hexdigest())  <span class="comment">#92a7e713c30abbb0319fa07da2a5c4af</span></span><br><span class="line"></span><br><span class="line">m2=hashlib.md5()</span><br><span class="line">m2.update(<span class="string">&#x27;helloalvin&#x27;</span>.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(m2.hexdigest()) <span class="comment">#92a7e713c30abbb0319fa07da2a5c4af</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意：把一段很长的数据update多次，与一次update这段长数据，得到的结果一样</span></span><br><span class="line"><span class="string">但是update多次为校验大文件提供了可能。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>hamc</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#要想保证hmac最终结果一致，必须保证：</span></span><br><span class="line"><span class="comment">#1:hmac.new括号内指定的初始key一样</span></span><br><span class="line"><span class="comment">#2:无论update多少次，校验的内容累加到一起是一样的内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 操作一</span></span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line">h1=hmac.new(<span class="string">&#x27;hello&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>),digestmod=<span class="string">&#x27;md5&#x27;</span>)</span><br><span class="line">h1.update(<span class="string">&#x27;world&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(h1.hexdigest()) <span class="comment"># 0e2564b7e100f034341ea477c23f283b</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 操作二</span></span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line">h2=hmac.new(<span class="string">&#x27;hello&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>),digestmod=<span class="string">&#x27;md5&#x27;</span>)</span><br><span class="line">h2.update(<span class="string">&#x27;w&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">h2.update(<span class="string">&#x27;orld&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(h1.hexdigest()) <span class="comment"># 0e2564b7e100f034341ea477c23f283b</span></span><br></pre></td></tr></table></figure>

<ul>
<li>re</li>
<li><img src="https://images2015.cnblogs.com/blog/1036857/201705/1036857-20170529203214461-666088398.png" alt="img"></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>subprocess</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> check_output</span><br><span class="line"></span><br><span class="line">all_list = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MoFileInfo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, path</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.path = path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取磁盘中jar启动包</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_file_bypath</span>(<span class="params">strDir</span>):</span></span><br><span class="line">    filelist = os.listdir(strDir)</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> filelist:</span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(strDir + <span class="string">&quot;/&quot;</span> + file):</span><br><span class="line">            find_file_bypath(strDir + <span class="string">&quot;/&quot;</span> + file)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> (file.find(<span class="string">&quot;.jar&quot;</span>) &gt;= <span class="number">0</span>):</span><br><span class="line">                fileInfo = MoFileInfo(file, strDir + <span class="string">&quot;/&quot;</span> + file)</span><br><span class="line">                all_list.append(fileInfo)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_list_file</span>():</span></span><br><span class="line">    <span class="keyword">for</span> index, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(all_list):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;. &#123;&#125;&quot;</span>.<span class="built_in">format</span>(index, x.name))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取pid</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pid</span>(<span class="params">name</span>):</span></span><br><span class="line">    child = subprocess.Popen([<span class="string">&#x27;pgrep&#x27;</span>, <span class="string">&#x27;-f&#x27;</span>, name], stdout=subprocess.PIPE, shell=<span class="literal">False</span>)</span><br><span class="line">    response = child.communicate()[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(response)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行命令</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exec_file</span>(<span class="params">index</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">int</span>(index) &lt;= -<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            fileInfo = all_list[<span class="built_in">int</span>(index)]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;你选择的是：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(fileInfo.path))</span><br><span class="line">            strcmd = <span class="built_in">input</span>(<span class="string">&quot;请输入执行命令(nr:nohup启动java r:java启动 k:kill d:删除java包   kd:kill+删除jar包)：\r\n&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> (strcmd == <span class="string">&quot;nr&quot;</span>):</span><br><span class="line">                os.system(<span class="string">&quot;nohup java -jar &#123;&#125; 2&gt;&amp;1 &amp; &quot;</span>.<span class="built_in">format</span>(fileInfo.path))</span><br><span class="line">            <span class="keyword">elif</span> (strcmd == <span class="string">&quot;r&quot;</span>):</span><br><span class="line">                os.system(<span class="string">&quot;java -jar &#123;&#125;&quot;</span>.<span class="built_in">format</span>(fileInfo.path))</span><br><span class="line">            <span class="keyword">elif</span> (strcmd == <span class="string">&quot;k&quot;</span>):</span><br><span class="line">                pid = get_pid(fileInfo.name)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;pid:&quot;</span> + pid.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                strcmd_1 = <span class="string">&quot;kill -9 &#123;&#125;&quot;</span>.<span class="built_in">format</span>(pid)</span><br><span class="line">                exec_cmd(strcmd_1)</span><br><span class="line">            <span class="keyword">elif</span> (strcmd == <span class="string">&quot;d&quot;</span>):</span><br><span class="line">                strcmd_1 = <span class="string">&quot;rm -rf &#123;&#125;&quot;</span>.<span class="built_in">format</span>(fileInfo.path)</span><br><span class="line">                exec_cmd(strcmd_1)</span><br><span class="line">            <span class="keyword">elif</span> (strcmd == <span class="string">&quot;kd&quot;</span>):</span><br><span class="line">                pid = get_pid(fileInfo.name)</span><br><span class="line">                strcmd_1 = <span class="string">&quot;kill -9 &#123;&#125;&quot;</span>.<span class="built_in">format</span>(pid)</span><br><span class="line">                exec_cmd(strcmd_1)</span><br><span class="line"></span><br><span class="line">                strcmd_1 = <span class="string">&quot;rm -rf &#123;&#125;&quot;</span>.<span class="built_in">format</span>(fileInfo.path)</span><br><span class="line">                exec_cmd(strcmd_1)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;无任何操作&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;操作失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exec_cmd</span>(<span class="params">strcmd</span>):</span></span><br><span class="line">    <span class="built_in">str</span> = <span class="built_in">input</span>(<span class="string">&quot;是否执行命令(y/n)：&quot;</span> + strcmd + <span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">str</span> == <span class="string">&quot;y&quot;</span>):</span><br><span class="line">        os.system(strcmd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">strDir = <span class="built_in">input</span>(<span class="string">&quot;请输入jar所在磁盘路径(默认：/root/job):\r\n&quot;</span>)</span><br><span class="line">strDir = strDir <span class="keyword">if</span> (<span class="built_in">len</span>(strDir) &gt; <span class="number">0</span>) <span class="keyword">else</span> <span class="string">&quot;/root/job&quot;</span></span><br><span class="line"><span class="comment"># 获取运行包</span></span><br><span class="line">find_file_bypath(strDir)</span><br><span class="line"><span class="comment"># 展示运行包</span></span><br><span class="line">show_list_file()</span><br><span class="line"><span class="comment"># 选择运行包</span></span><br><span class="line">strIndex = <span class="built_in">input</span>(<span class="string">&quot;请选择要运行的编号:\r\n&quot;</span>)</span><br><span class="line"><span class="comment"># 执行命令</span></span><br><span class="line">exec_file(strIndex)</span><br></pre></td></tr></table></figure>

<h2 id="猴子补丁"><a href="#猴子补丁" class="headerlink" title="猴子补丁"></a>猴子补丁</h2><ul>
<li>属性运行时被动态的替换叫做猴子补丁</li>
<li>应用场景如下</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">如果我们的程序中已经基于json模块编写了大量代码了，发现有一个模块ujson比它性能更高，</span><br><span class="line">但用法一样，我们肯定不会想所有的代码都换成ujson.dumps或者ujson.loads,那我们可能</span><br><span class="line">会想到这么做</span><br><span class="line"><span class="keyword">import</span> ujson <span class="keyword">as</span> json，但是这么做的需要每个文件都重新导入一下，维护成本依然很高</span><br><span class="line">此时我们就可以用到猴子补丁了</span><br><span class="line">只需要在入口处加上</span><br><span class="line">, 只需要在入口加上:</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> ujson</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">monkey_patch_json</span>():</span></span><br><span class="line">    json.__name__ = <span class="string">&#x27;ujson&#x27;</span></span><br><span class="line">    json.dumps = ujson.dumps</span><br><span class="line">    json.loads = ujson.loads</span><br><span class="line"></span><br><span class="line">monkey_patch_json() <span class="comment"># 之所以在入口处加，是因为模块在导入一次后，后续的导入便直接引用第一次的成果</span></span><br></pre></td></tr></table></figure>

<h2 id="实现单例的几种方式"><a href="#实现单例的几种方式" class="headerlink" title="实现单例的几种方式"></a><strong>实现单例的几种方式</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>使用模块</span><br><span class="line">其实，Python 的模块就是天然的单例模式，因为模块在第一次导入时，会生成 .pyc 文件，当第二次导入时，就会直接加载 .pyc 文件，而不会再次执行模块代码。因此，我们只需把相关的函数和数据定义在一个模块中，就可以获得一个单例对象了。如果我们真的想要一个单例类，可以考虑这样做：</span><br><span class="line"></span><br><span class="line">mysingleton.py</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">singleton = Singleton()</span><br><span class="line">将上面的代码保存在文件 mysingleton.py 中，要使用时，直接在其他文件中导入此文件中的对象，这个对象即是单例模式的对象</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> mysingleton.py <span class="keyword">import</span> singleton</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>使用装饰器</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Singleton</span>(<span class="params">cls</span>):</span></span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_singleton</span>(<span class="params">*args, **kargs</span>):</span></span><br><span class="line">        <span class="keyword">nonlocal</span> instance</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> instance:</span><br><span class="line">            instance = cls(*args, **kargs)</span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _singleton</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x=<span class="number">0</span></span>):</span></span><br><span class="line">        self.x = x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a1 = A(<span class="number">2</span>)</span><br><span class="line">a2 = A(<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(a1.x)</span><br><span class="line"><span class="built_in">print</span>(a2.x)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a1 <span class="keyword">is</span> a2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>使用类方法</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    _instance=<span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">instance</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls._instance:</span><br><span class="line">            cls._instance=cls(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"></span><br><span class="line">a1=Singleton.instance()</span><br><span class="line">a2=Singleton().instance()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a1 <span class="keyword">is</span> a2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>基于new方法实现</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    _instance=<span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls._instance:</span><br><span class="line">            cls._instance = <span class="built_in">object</span>.__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"></span><br><span class="line">obj1 = Singleton()</span><br><span class="line">obj2 = Singleton()</span><br><span class="line"><span class="built_in">print</span>(obj1 <span class="keyword">is</span> obj2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>基于metaclass方式实现</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonType</span>(<span class="params"><span class="built_in">type</span></span>):</span></span><br><span class="line">    _instance=<span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls._instance:</span><br><span class="line">            <span class="comment"># cls._instance = super().__call__(*args, **kwargs)</span></span><br><span class="line">            cls._instance = <span class="built_in">object</span>.__new__(cls)</span><br><span class="line">            cls._instance.__init__(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>(<span class="params">metaclass=SingletonType</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj1 = Foo(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">obj2 = Foo(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(obj1.name)</span><br><span class="line"><span class="built_in">print</span>(obj1 <span class="keyword">is</span> obj2)</span><br></pre></td></tr></table></figure>



<h2 id="同步异步阻塞非阻塞"><a href="#同步异步阻塞非阻塞" class="headerlink" title="同步异步阻塞非阻塞"></a>同步异步阻塞非阻塞</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">同步/异步关注的是消息通信机制 (synchronous communication/ asynchronous communication) 。</span><br><span class="line">所谓同步，就是在发出一个调用时，在没有得到结果之前， 该调用就不返回。</span><br><span class="line">异步则是相反，调用在发出之后，这个调用就直接返回了，所以没有返回结果</span><br><span class="line"></span><br><span class="line">阻塞非阻塞关注的是程序在等待调用结果（消息，返回值）时的状态.</span><br><span class="line"></span><br><span class="line">阻塞调用是指调用结果返回之前，当前线程会被挂起。调用线程只有在得到结果之后才会返回。非阻塞调用指在不能立刻得到结果之前，该调用不会阻塞当前线程。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">三、悲观锁（悲观并发控制）</span><br><span class="line">悲观锁（Pessimistic Concurrency Control，缩写”PCC”），顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。（共享资源每次只给一个线程使用，其它线程阻塞，用完后再把资源转让给其它线程，和Python中GIL锁一样）</span><br><span class="line">悲观锁：假定会发生并发冲突，屏蔽一切可能违反数据完整性的操作。</span><br><span class="line">悲观锁：主要用于数据争用激烈的环境，以及发生并发冲突时使用锁保护数据的成本要低于回滚事务的成本的环境中。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">四、乐观锁（乐观并发控制）</span><br><span class="line">乐观锁（Optimistic Concurrency Control，缩写”OCC”），顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在提交更新的时候会判断一下在此期间别人有没有去更新这个数据。乐观锁适用于读多写少的应用场景，这样可以提高吞吐量。</span><br><span class="line">乐观锁：假设不会发生并发冲突，只在提交操作时检查是否违反数据完整性。</span><br><span class="line">乐观锁：多数用于数据争用不大、冲突较少的环境中，这种环境中，偶尔回滚事务的成本会低于读取数据时锁定数据的成本，因此可以获得比其他并发控制方法更高的吞吐量。</span><br><span class="line">相对于悲观锁，在对数据库进行处理的时候，乐观锁并不会使用数据库提供的锁机制。一般的实现乐观锁的方式就是记录数据版本</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GIL：又叫全局解释器锁，每个线程在执行的过程中都需要先获取GIL，保证同一时刻只有一个线程在运行，目的是解决多线程同时竞争程序中的全局变量而出现的线程安全问题</span><br><span class="line"></span><br><span class="line">GIL面试题参考答案：</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> Python语言和GIL没有什么关系。仅仅是由于历史原因在Cpython虚拟机(解释器)，难以移除GIL。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> GIL：全局解释器锁。每个线程在执行的过程都需要先获取GIL，保证同一时刻只有一个线程可以执行代码。</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 线程释放GIL锁的情况： 在IO操作等可能会引起阻塞的system call之前,可以暂时释放GIL,但在执行完毕后,必须重新获取GIL Python <span class="number">3.</span>x使用计时器（执行时间</span><br><span class="line">达到阈值后，当前线程释放GIL）或Python <span class="number">2.</span>x，tickets计数达到<span class="number">100</span>。</span><br><span class="line"></span><br><span class="line"><span class="number">4</span> Python使用多进程是可以利用多核的CPU资源的。</span><br><span class="line"></span><br><span class="line"><span class="number">5</span> 多线程爬取比单线程性能有提升，因为遇到IO阻塞会自动释放GIL锁</span><br></pre></td></tr></table></figure>

<h2 id="requests模块模拟下发form-data数据"><a href="#requests模块模拟下发form-data数据" class="headerlink" title="requests模块模拟下发form/data数据"></a>requests模块模拟下发form/data数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    url = <span class="string">&quot;http://127.0.0.1:5000/api/v1/algorithm_manage/alarm&quot;</span></span><br><span class="line">    body = &#123;</span><br><span class="line">        <span class="string">&quot;applicationType&quot;</span>: applicationType,</span><br><span class="line">        <span class="string">&quot;eventAddrType&quot;</span>: eventAddrType,</span><br><span class="line">        <span class="string">&quot;eventStarted&quot;</span>: eventStarted,</span><br><span class="line">        <span class="string">&quot;eventMsgType&quot;</span>: eventMsgType,</span><br><span class="line">        <span class="string">&quot;eventType&quot;</span>: eventType,</span><br><span class="line">        <span class="comment"># &quot;eventMessage&quot;: base_file_path,</span></span><br><span class="line">    &#125;</span><br><span class="line">    file = &#123;<span class="string">&quot;file&quot;</span>: <span class="built_in">open</span>(filepath, <span class="string">&quot;rb&quot;</span>)&#125;</span><br><span class="line">    response = requests.post(url=url, data=body, files=file)</span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">        result = response.json()</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>

<p><code>代理</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">  <span class="string">&quot;http&quot;</span>: <span class="string">&quot;http://192.168.31.1:3128&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https&quot;</span>: <span class="string">&quot;http://10.10.1.10:1080&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requests.get(<span class="string">&quot;http://xlzd.me&quot;</span>, proxies=proxies)</span><br></pre></td></tr></table></figure>

<p><code>会话对象</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">session = requests.Session()</span><br><span class="line">session.post(<span class="string">&#x27;http://xlzd.me/login&#x27;</span>, data=&#123;<span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;xlzd&#x27;</span>, <span class="string">&#x27;pass&#x27;</span>: <span class="string">&#x27;mypassword&#x27;</span>&#125;)</span><br><span class="line"><span class="comment"># 登录成功则可以发布文章了</span></span><br><span class="line">session.put(<span class="string">&#x27;http://xlzd.me/new&#x27;</span>, data=&#123;<span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;title of article&#x27;</span>, <span class="string">&#x27;data&#x27;</span>: <span class="string">&#x27;content&#x27;</span>&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h2><p><img src="/2020/08/23/python/image-20210727213002977.png" alt="python"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 创建虚拟环境</span><br><span class="line">使用 venv 创建虚拟环境的命令为 python -m venv &lt;env_name&gt;，例：</span><br><span class="line">cd your_project_root_directory</span><br><span class="line">python -m venv .venv 或 mkvirtualenv ENV</span><br><span class="line"><span class="number">2.</span>激活虚拟环境</span><br><span class="line"><span class="comment"># linux</span></span><br><span class="line">source .venv/<span class="built_in">bin</span>/activate</span><br><span class="line"><span class="comment"># windows</span></span><br><span class="line">.venv\Scripts\activate.bat</span><br><span class="line"><span class="number">3.</span>退出虚拟环境</span><br><span class="line">deactivate</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>进入项目，安装需要依赖的包</span><br><span class="line">requirements.txt可以通过pip命令自动生成和安装</span><br><span class="line"></span><br><span class="line">生成requirements.txt文件</span><br><span class="line">pip freeze &gt; requirements.txt</span><br><span class="line"></span><br><span class="line">安装requirements.txt依赖</span><br><span class="line">pip install -r requirements.txt</span><br><span class="line"></span><br><span class="line"><span class="number">5</span> 升级虚拟环境的pip</span><br><span class="line">easy_install -U pip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建议使用pip3安装到python3环境下</span></span><br><span class="line">pip3 install virtualenv</span><br><span class="line">pip3 install virtualenvwrapper-win</span><br><span class="line">配置虚拟环境管理器工作目录</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置环境变量：</span></span><br><span class="line"><span class="comment"># 控制面板 =&gt; 系统和安全 =&gt; 系统 =&gt; 高级系统设置 =&gt; 环境变量 =&gt; 系统变量 =&gt; 点击新建 =&gt; 填入变量名与值</span></span><br><span class="line">变量名：WORKON_HOME  变量值：自定义存放虚拟环境的绝对路径</span><br><span class="line">eg: WORKON_HOME: D:\Virtualenvs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步配置信息：</span></span><br><span class="line"><span class="comment"># 去向Python3的安装目录 =&gt; Scripts文件夹 =&gt; virtualenvwrapper.bat =&gt; 双击</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="comment"># 在终端工作的命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1、创建虚拟环境到配置的WORKON_HOME路径下</span></span><br><span class="line"><span class="comment"># 选取默认Python环境创建虚拟环境：</span></span><br><span class="line">	-- mkvirtualenv 虚拟环境名称</span><br><span class="line"><span class="comment"># 基于某Python环境创建虚拟环境：</span></span><br><span class="line">	-- mkvirtualenv -p python2<span class="number">.7</span> 虚拟环境名称</span><br><span class="line">	-- mkvirtualenv -p python3<span class="number">.6</span> 虚拟环境名称</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、查看已有的虚拟环境</span></span><br><span class="line">	-- workon</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、使用某个虚拟环境</span></span><br><span class="line">	-- workon 虚拟环境名称</span><br><span class="line">	</span><br><span class="line"><span class="comment"># 4、进入|退出 该虚拟环境的Python环境</span></span><br><span class="line">	-- python | exit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、为虚拟环境安装模块</span></span><br><span class="line">	-- pip或pip3 install 模块名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、退出当前虚拟环境</span></span><br><span class="line">	-- deactivate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7、删除虚拟环境(删除当前虚拟环境要先退出)</span></span><br><span class="line">	-- rmvirtualenv 虚拟环境名称</span><br></pre></td></tr></table></figure>

<p>项目使用命令创建的虚拟环境</p>
<p><img src="/2020/08/23/python/image-20210804025252408.png" alt="python"></p>
<h2 id="linux安装虚拟环境"><a href="#linux安装虚拟环境" class="headerlink" title="linux安装虚拟环境"></a>linux安装虚拟环境</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pip3 install virtualenvwrapper</span><br><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="comment"># 增加配置</span></span><br><span class="line">export PATH=/usr/local/python3/<span class="built_in">bin</span>:$PATH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">VIRTUALENVWRAPPER_PYTHON=/usr/local/python3/<span class="built_in">bin</span>/python3    <span class="comment"># 指定virtualenvwrapper执行的python版本</span></span><br><span class="line">export WORKON_HOME=/root/lhj/virtualenv    <span class="comment"># 指定虚拟环境存放目录，.virtualenvs目录名可自拟</span></span><br><span class="line">source /usr/local/python3/<span class="built_in">bin</span>/virtualenvwrapper.sh    <span class="comment"># virtualenvwrapper.sh所在目录</span></span><br><span class="line">source ~/.bashrc <span class="comment"># 激活配置</span></span><br><span class="line"></span><br><span class="line">mkvirtualenv test</span><br><span class="line"></span><br><span class="line">workon test</span><br><span class="line"></span><br><span class="line">deactivate</span><br><span class="line"></span><br><span class="line">rmvirtualenv test</span><br></pre></td></tr></table></figure>

<h2 id="mq使用json传输二进制的方案"><a href="#mq使用json传输二进制的方案" class="headerlink" title="mq使用json传输二进制的方案"></a>mq使用json传输二进制的方案</h2><ul>
<li>producter</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对数组的图片格式进行编码</span></span><br><span class="line">success, encoded_image = cv2.imencode(<span class="string">&quot;.jpg&quot;</span>, frame)</span><br><span class="line"><span class="comment"># 将数组转为bytes</span></span><br><span class="line">img_bytes = encoded_image.tostring()</span><br><span class="line"><span class="comment"># b64编码，生成新的可字符化的二进制序列</span></span><br><span class="line">bast64_data = base64.b64encode(img_bytes)</span><br><span class="line"><span class="comment"># 字符串化，使用utf-8的方式解析二进制</span></span><br><span class="line">bast64_str = <span class="built_in">str</span>(bast64_data, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">message = json.dumps(&#123;<span class="string">&quot;imgname&quot;</span>: imgname, <span class="string">&quot;img&quot;</span>: bast64_str&#125;)</span><br><span class="line">mq(message)</span><br></pre></td></tr></table></figure>

<ul>
<li>consumer</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span>(<span class="params">channel, method_frame, header_frame, body</span>):</span></span><br><span class="line">    <span class="comment"># print(method_frame.delivery_tag)</span></span><br><span class="line">    <span class="comment"># print(body)</span></span><br><span class="line">    channel.basic_ack(delivery_tag=method_frame.delivery_tag)</span><br><span class="line">    message = json.loads(body.decode())</span><br><span class="line">    imgname = message[<span class="string">&#x27;imgname&#x27;</span>]</span><br><span class="line">    img = message[<span class="string">&#x27;img&#x27;</span>]</span><br><span class="line">    <span class="comment"># 将字符串重新编码为utf-8的二进制序列（该序列被b64编码过）</span></span><br><span class="line">    bast64_data = img.encode(encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># b64解码,获得原二进制序列</span></span><br><span class="line">    data = base64.b64decode(bast64_data)</span><br></pre></td></tr></table></figure>

<h2 id="python格式化字符串之-s"><a href="#python格式化字符串之-s" class="headerlink" title="python格式化字符串之%()s"></a>python格式化字符串之%()s</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>demo = <span class="string">&#x27;%(name)s&#x27;</span>%&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lhj&quot;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>demo</span><br><span class="line"><span class="string">&#x27;lhj&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>demo = <span class="string">&#x27;%(num)d&#x27;</span>%&#123;<span class="string">&quot;num&quot;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]&#125;</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: %d <span class="built_in">format</span>: a number <span class="keyword">is</span> required, <span class="keyword">not</span> <span class="built_in">list</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>demo = <span class="string">&#x27;%(num)d&#x27;</span>%&#123;<span class="string">&quot;num&quot;</span>:<span class="number">26</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>demo</span><br><span class="line"><span class="string">&#x27;26&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="解决Linux-pip报错"><a href="#解决Linux-pip报错" class="headerlink" title="解决Linux pip报错"></a>解决Linux pip报错</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/larack/p/12196850.html">https://www.cnblogs.com/larack/p/12196850.html</a></p>
<p><img src="/2020/08/23/python/image-20210901222718795.png" alt="python"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1.安装相关依赖</span><br><span class="line">yum install gcc libffi-devel zlib* openssl-devel</span><br><span class="line">2.安装openssl</span><br><span class="line">wget https://github.com/openssl/openssl/archive/OpenSSL_1_1_1d.tar.gz</span><br><span class="line">tar -zxvf OpenSSL_1_1_1d.tar.gz</span><br><span class="line">mkdir openssl</span><br><span class="line">cd OpenSSL_1_1_1d</span><br><span class="line">3.编译安装</span><br><span class="line">./config --prefix=/usr/local/openssl</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">4.替换当前系统旧版本openssl</span><br><span class="line">mv /usr/bin/openssl /usr/bin/openssl.old</span><br><span class="line">mv /usr/lib64/openssl /usr/lib64/openssl.old</span><br><span class="line">mv /usr/lib64/libssl.so /usr/lib64/libssl.so.old</span><br><span class="line">ln -s /usr/local/openssl/bin/openssl /usr/bin/openssl</span><br><span class="line">ln -s /usr/local/openssl/include/openssl /usr/include/openssl</span><br><span class="line">ln -s /usr/local/openssl/lib/libssl.so /usr/lib64/libssl.so</span><br><span class="line">echo &quot;/usr/local/openssl/lib&quot; &gt;&gt; /etc/ld.so.conf</span><br><span class="line">ldconfig -v </span><br><span class="line">5.查看版本</span><br><span class="line">openssl version</span><br><span class="line">6.重新安装python</span><br><span class="line">mkdir python3</span><br><span class="line">cd Python-3.8.5</span><br><span class="line">cd Python-3.8.5</span><br><span class="line">./configure --prefix=/usr/local/python3 --with-openssl=/usr/local/openssl</span><br><span class="line">make &amp;&amp; sudo make install</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果出现pip警告</span></span><br><span class="line">echo &#x27;export PATH=/usr/local/python3/bin:$PATH&#x27; &gt;&gt;~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br><span class="line"><span class="meta">#</span><span class="bash"> 建立软连接</span></span><br><span class="line">ln -s /usr/local/python3/bin/python3 /usr/bin/python3</span><br><span class="line">ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证</span></span><br><span class="line">python3 -v</span><br><span class="line">pip3 -v</span><br></pre></td></tr></table></figure>

<h2 id="windows-终止某进程"><a href="#windows-终止某进程" class="headerlink" title="windows 终止某进程"></a>windows 终止某进程</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; netstat -aon|findstr <span class="string">&quot;8888&quot;</span></span><br><span class="line">  TCP    <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8888</span>           <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">0</span>              LISTENING       <span class="number">7036</span></span><br><span class="line">  TCP    [::]:<span class="number">8888</span>              [::]:<span class="number">0</span>                 LISTENING       <span class="number">7036</span></span><br><span class="line"></span><br><span class="line">&gt; taskkill /pid <span class="number">7036</span> /f</span><br><span class="line">成功: 已终止 PID 为 <span class="number">7036</span> 的进程。</span><br></pre></td></tr></table></figure>

<h2 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h2><h3 id="http协议"><a href="#http协议" class="headerlink" title="http协议"></a><strong>http协议</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> HTTP协议是Hyper Text Transfer Protocol（超文本传输协议）的缩写,是用于万维网服务器与本地浏览器之间传输超文本的传送协议</span><br><span class="line"><span class="number">2</span> 应用层的协议</span><br><span class="line"><span class="number">3</span> http协议特性（记一下） 数据传输是明文</span><br><span class="line">	-<span class="number">1</span> 基于tcp/ip之上的应用层协议</span><br><span class="line">    -<span class="number">2</span> 基于请求－响应模式</span><br><span class="line">    -<span class="number">3</span> 无状态保存</span><br><span class="line">    -<span class="number">4</span> 无连接</span><br><span class="line"></span><br><span class="line">  https协议</span><br><span class="line">	数据传输是秘文 采用http+ssl</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>  请求协议(浏览器发出来的)（记住）</span><br><span class="line">三部分：请求首行，请求头，请求体</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># 请求首行（以第一个\r\n区分的），</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 请求方式：GET  请求地址：/lqz/handsome   协议：http   版本：1.1版本</span></span><br><span class="line"><span class="string">GET /lqz/handsome HTTP/1.1\r\n</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 请求头（key:value形式）</span></span><br><span class="line"><span class="string">Host: 192.168.11.211:8080\r\n</span></span><br><span class="line"><span class="string">Connection: keep-alive\r\n</span></span><br><span class="line"><span class="string">Cache-Control: max-age=0\r\n</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1\r\n</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36\r\n</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\r\n</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate\r\n</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9\r\n\r\n&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># \r\n\r\n  下面的是请求体的内容</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">.....</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> 响应协议</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># 响应首行  响应协议和版本：HTTP/1.1  响应的状态码和标志：200 ok  </span></span><br><span class="line"><span class="string">HTTP/1.1 200 ok \r\</span></span><br><span class="line"><span class="string"># 响应头（key:value形式）</span></span><br><span class="line"><span class="string">key:value</span></span><br><span class="line"><span class="string">key:valu</span></span><br><span class="line"><span class="string">\r\n\r\n</span></span><br><span class="line"><span class="string"># 响应体：在浏览器里看到的东西(浏览器能把下面的html渲染成好看的样子)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;h1&gt;hello&lt;/h1&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">6</span> 响应状态码</span><br><span class="line">	-1xx：请求正在处理（用户一般看不到）        </span><br><span class="line">    -2xx：请求成功（<span class="number">200</span>）</span><br><span class="line">    -3xx：重定向（<span class="number">301</span>  <span class="number">302</span>）访问一个地址，转到另一个地址</span><br><span class="line">    -4xx：客户端错误（<span class="number">404</span>，<span class="number">403</span>）</span><br><span class="line">    -5xx：服务端错误（<span class="number">502</span>）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="number">7</span> url:统一资源定位符</span><br><span class="line">	<span class="comment"># 格式</span></span><br><span class="line">    http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8080</span>/order.html</span><br><span class="line">    ftp://xxx</span><br><span class="line">    协议：//IP:端口(<span class="number">80</span>)/路径?name=lqz&amp;age=<span class="number">18</span></span><br><span class="line">    统一资源定位符是可以从互联网上访问资源的一种方式，协议就是资源的地址</span><br></pre></td></tr></table></figure>

<h3 id="基于wsgiref写一个web框架"><a href="#基于wsgiref写一个web框架" class="headerlink" title="基于wsgiref写一个web框架"></a><strong>基于wsgiref写一个web框架</strong></h3><p><img src="/2020/08/23/python/image-20210727185036389.png" alt="python"></p>
<p><img src="/2020/08/23/python/image-20210727184937598.png" alt="python"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;index&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;login&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">order</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;order&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">error</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;error&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urls = [</span><br><span class="line">    (<span class="string">&#x27;/index&#x27;</span>, index),</span><br><span class="line">    (<span class="string">&#x27;/login&#x27;</span>, login),</span><br><span class="line">    (<span class="string">&#x27;/order&#x27;</span>, order),</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server</span>(<span class="params">environ, start_response</span>):</span>  <span class="comment"># 必须传两个参数</span></span><br><span class="line">    <span class="comment"># environ：是字典，http请求拆成字典,请求方式，请求地址，请求头。。。</span></span><br><span class="line">    <span class="comment"># start_response：响应对象，响应状态码，响应头放到里面</span></span><br><span class="line"></span><br><span class="line">    start_response(<span class="string">&#x27;200 OK&#x27;</span>, [])</span><br><span class="line">    current_path = environ.get(<span class="string">&#x27;PATH_INFO&#x27;</span>)</span><br><span class="line">    func = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">        <span class="keyword">if</span> current_path == url[<span class="number">0</span>]:  <span class="comment"># (),()</span></span><br><span class="line">            func = url[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">break</span>  <span class="comment"># 匹配到第一个结束循环</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断func是否有值</span></span><br><span class="line">    <span class="keyword">if</span> func:</span><br><span class="line">        res = func()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res = error()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [res.encode(<span class="string">&#x27;utf-8&#x27;</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># app是可调用对象，可以加括号执行的(函数内存地址)</span></span><br><span class="line">    myserver = make_server(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8081</span>, server)  <span class="comment"># 只要客户端发送一次请求，就会调用server()</span></span><br><span class="line">    myserver.serve_forever()  <span class="comment"># 服务就起来了，相当于之前写的socket一直监听8081端口</span></span><br></pre></td></tr></table></figure>

<p><strong>动静态网页</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">静态网页：静态的html，内容不会改变，每次访问看到的数据都一样</span><br><span class="line">动态网页：页面的数据会发生变化，每次访问看到的可能都不一样（数据来源可能是数据库）</span><br></pre></td></tr></table></figure>

<p><strong>模板语法之Jinjia2模块</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"><span class="string">&quot;&quot;&quot;模板语法是在后端起作用的&quot;&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_user</span>():</span></span><br><span class="line">    user_dic = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;lhj&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="string">&#x27;21&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;user.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    template = Template(data)</span><br><span class="line">    res = template.render(user=user_dic)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;用户页面&lt;/h1&gt;</span><br><span class="line">&#123;&#123;user.get(<span class="string">&#x27;name&#x27;</span>)&#125;&#125;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&#123;&#123;user.age&#125;&#125;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&#123;&#123;user[<span class="string">&#x27;name&#x27;</span>]&#125;&#125;</span><br><span class="line">&lt;br&gt;</span><br></pre></td></tr></table></figure>

<h3 id="模板语法之for循环"><a href="#模板语法之for循环" class="headerlink" title="模板语法之for循环"></a><strong>模板语法之for循环</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_user</span>():</span></span><br><span class="line">    <span class="comment"># 连接数据库 传递给html页面借助模板语法</span></span><br><span class="line">    conn = pymysql.connect(</span><br><span class="line">        host=<span class="string">&#x27;127.0.0.1&#x27;</span>, user=<span class="string">&#x27;root&#x27;</span>, password=<span class="string">&quot;1018&quot;</span>,</span><br><span class="line">        db=<span class="string">&#x27;django&#x27;</span>, port=<span class="number">3306</span>,</span><br><span class="line">        charset=<span class="string">&#x27;utf8&#x27;</span>, autocommit=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line">    cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line">    sql = <span class="string">&#x27;select * from user&#x27;</span></span><br><span class="line">    affect_rows = cursor.execute(sql)</span><br><span class="line">    data_list = cursor.fetchall()</span><br><span class="line">    <span class="comment"># 将获取的数据传递给HTml页面</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;user.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">        tem = Template(data)</span><br><span class="line">        res = tem.render(data_list=data_list)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>

<p><strong>user.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-8 col-md-offset-2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;text-center&quot;</span>&gt;</span>用户数据<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-hover table-striped&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Hobby<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--           数据库拿出的是列表套字典         [&#123;&#125;,&#123;&#125;]--&gt;</span></span><br><span class="line">                &#123;% for data in data_list %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;data.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;data.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;data.password&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;data.hobby&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="python三大主流框架"><a href="#python三大主流框架" class="headerlink" title="python三大主流框架"></a><strong>python三大主流框架</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>Django </span><br><span class="line">	特点:大而全,自带的功能特别多</span><br><span class="line">    缺点：过于笨重</span><br><span class="line"><span class="number">2.</span>Flask</span><br><span class="line">	特点：小而精，自带的功能特别少，第三方的模块特别多</span><br><span class="line">    缺点：比较依赖第三方的开发者</span><br><span class="line"><span class="number">3.</span>Tornado</span><br><span class="line">	特点：异步非阻塞，支持高并发</span><br><span class="line"></span><br><span class="line">A socket部分</span><br><span class="line">B 路由与视图函数对应关系</span><br><span class="line">C 模板语法</span><br><span class="line"></span><br><span class="line">django</span><br><span class="line">	 A 用的别人的 wsgiref</span><br><span class="line">     B 自己</span><br><span class="line">     C 用的自己写得，没有Jinja2好用</span><br><span class="line">flask</span><br><span class="line">	 A 用的别人的 werkzeug</span><br><span class="line">     B 自己</span><br><span class="line">     C 别人的（Jinja2）</span><br><span class="line">tornado</span><br><span class="line">	A，B，C都是自己写得</span><br></pre></td></tr></table></figure>

<h3 id="django目录介绍"><a href="#django目录介绍" class="headerlink" title="django目录介绍"></a><strong>django目录介绍</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-day60   项目名</span><br><span class="line">	-app01   app的名字</span><br><span class="line">    	-migrations   数据库变更相关记录（你不要删，也不要改）</span><br><span class="line">        -admin.py     后台管理（创建项目如果没有选，就没有）</span><br><span class="line">        -apps.py      app的相关配置，不用管</span><br><span class="line">        -models.py    数据库相关（重点）</span><br><span class="line">        -tests.py     测试相关（不用管）</span><br><span class="line">        -views.py     视图函数（重点）</span><br><span class="line">    -day60  跟项目名同名目录（项目总体配置相关，配置文件，路由）</span><br><span class="line">    	-settings.py   很重要，整个项目的启动，由配置文件决定</span><br><span class="line">		-urls.py       路由（总路由）</span><br><span class="line">        -wsgi.py       wsgi服务器的配置，不需要管（后期上线会改一点点）</span><br><span class="line">    -templates         模板文件（一个一个的html），pycharm创建出来才有这个文件夹</span><br><span class="line">    -manage.py         启动项目，创建app，各种命令的操作</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 重点的是   </span></span><br><span class="line">    -views.py</span><br><span class="line">    -models.py</span><br><span class="line">    -urls.py</span><br><span class="line">    -templagtes文件夹</span><br></pre></td></tr></table></figure>

<h3 id="MTV与MVC"><a href="#MTV与MVC" class="headerlink" title="MTV与MVC"></a><strong>MTV与MVC</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> django 是MTV架构，本质也是mvc</span><br><span class="line">	-M：model，数据库相关操作</span><br><span class="line">    -T：template，模板文件（就是mvc的v层）</span><br><span class="line">    -V：view，视图（路由+V=MVC的控制器）</span><br><span class="line"><span class="number">2</span> MVC架构：主流的web框架都是mvc</span><br><span class="line">	-Web应用分为模型(M)，控制器(C)和视图(V)</span><br><span class="line">    -M：model，数据库相关操作</span><br><span class="line">    -C：controler控制器，逻辑相关，逻辑代码</span><br><span class="line">    -V：视图，模板文件</span><br></pre></td></tr></table></figure>

<h3 id="django中orm的使用"><a href="#django中orm的使用" class="headerlink" title="django中orm的使用"></a><strong>django中orm的使用</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> sqlite：也是要给数据库，文件数据库，一个库就是要给文件，不需要单独安装</span><br><span class="line">	-咱们现在在用，也要用到关系型数据库，不想装mysql，就可以使用sqlite</span><br><span class="line">    -移动开发本地存储数据，存在sqlite中</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> 创建个UserInfo表，在models中写一个类</span><br><span class="line"><span class="number">2</span> 表中有字段（类属性），字段有属性，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一步在models中写要给类</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">        <span class="comment"># 字段属性--》后面那个对象决定的,</span></span><br><span class="line">        <span class="comment"># 改字段自增，并且是主键</span></span><br><span class="line">        <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 改字段是varchar类型，长度为32(唯一约束，是否是索引，默认值是，是否可以为空)</span></span><br><span class="line">        name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">        <span class="comment"># 密码字段</span></span><br><span class="line">        password =models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 数字类型</span></span><br><span class="line">   	 	gender = models.IntegerField(default=<span class="number">0</span>)  <span class="comment"># 默认值为0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 省份</span></span><br><span class="line">        province = models.CharField(max_length=<span class="number">32</span>,null=<span class="literal">True</span>)  <span class="comment"># 可以为空</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 第二步，把表创建出来(执行两个命令)</span></span><br><span class="line">	-python3 manage.py makemigrations  <span class="comment"># 这条命令会在migrations创建一条记录，数据库变更记录</span></span><br><span class="line">    -python3 manage.py migrate         <span class="comment"># 把更改同步到数据库</span></span><br></pre></td></tr></table></figure>

<h3 id="diango连接mysql"><a href="#diango连接mysql" class="headerlink" title="diango连接mysql"></a><strong>diango连接mysql</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-<span class="number">1</span> 配置文件中配置：settings.py</span><br><span class="line">    	DATABASES = &#123;</span><br><span class="line">        <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;day62&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;PORT&#x27;</span>: <span class="number">3306</span>,</span><br><span class="line">            <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;PASSWORD&#x27;</span>:<span class="string">&#x27;123&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    -<span class="number">2</span> 需要在 app的__init__.py 中写</span><br><span class="line">        <span class="keyword">import</span> pymysql</span><br><span class="line">    	pymysql.install_as_MySQLdb()</span><br><span class="line">        </span><br><span class="line">    -<span class="number">3</span> 后续操作完全一样，在models中建立类，写字段</span><br><span class="line">    -<span class="number">4</span> 视图函数中插入，查询</span><br><span class="line">    -<span class="number">5</span> pycharm的--》tools---》run manage.py Task</span><br></pre></td></tr></table></figure>

<h3 id="Django请求生命周期流程图"><a href="#Django请求生命周期流程图" class="headerlink" title="Django请求生命周期流程图"></a><strong>Django请求生命周期流程图</strong></h3><p><img src="/2020/08/23/python/image-20210727195236543.png" alt="python"></p>
<p><img src="/2020/08/23/python/image-20210727195521016.png" alt="python"></p>
<h3 id="路由匹配注意事项"><a href="#路由匹配注意事项" class="headerlink" title="路由匹配注意事项"></a><strong>路由匹配注意事项</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 路由参数  </span><br><span class="line">    <span class="comment"># 第一个参数是正则表达式</span></span><br><span class="line">    <span class="comment"># 第二个参数是视图函数内存地址</span></span><br><span class="line">    <span class="comment"># 第三个参数是个字典 &#123;&#x27;name&#x27;:lqz,&#x27;age&#x27;:18&#125;,给视图函数传递默认值</span></span><br><span class="line">    <span class="comment"># 第四个参数name，当前路由的别名，用作反向解析</span></span><br><span class="line">    url(<span class="string">r&#x27;^home2/&#x27;</span>, views.home,&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lqz&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">19</span>&#125;,name=<span class="string">&#x27;home&#x27;</span>),</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> 访问根路径，触发视图函数执行（路由怎么配）</span><br><span class="line">	-url(<span class="string">r&#x27;^$&#x27;</span>, admin.site.urls),</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 在路由中配置多个相同路由会怎么样？</span><br><span class="line">	只会执行第一个</span><br><span class="line"></span><br><span class="line"><span class="number">4</span> 如下路由会怎么样？永远不会匹配到第二个</span><br><span class="line">    url(<span class="string">r&#x27;^login&#x27;</span>, views.home),</span><br><span class="line">    url(<span class="string">r&#x27;^login2&#x27;</span>, views.home),</span><br><span class="line">    </span><br><span class="line"><span class="number">5</span> 需要改成</span><br><span class="line">    url(<span class="string">r&#x27;^login/&#x27;</span>, views.home),</span><br><span class="line">    url(<span class="string">r&#x27;^login2/&#x27;</span>, views.home),</span><br><span class="line">    </span><br><span class="line"><span class="number">6</span> 取消自动加斜杠 settings.py</span><br><span class="line">APPEND_SLASH=<span class="literal">False</span>  <span class="comment"># 一般不加</span></span><br><span class="line"></span><br><span class="line"><span class="number">7</span>  限制路由以login开头结尾</span><br><span class="line">    url(<span class="string">r&#x27;^login$&#x27;</span>, views.home),</span><br><span class="line">    url(<span class="string">r&#x27;^login2$&#x27;</span>, views.home)</span><br><span class="line">    </span><br><span class="line"><span class="number">8</span>  首页</span><br><span class="line">	url(<span class="string">r&#x27;^$&#x27;</span>, views.home)</span><br><span class="line">    </span><br><span class="line"><span class="number">9</span> 尾页</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<h3 id="有名分组-无名分组"><a href="#有名分组-无名分组" class="headerlink" title="有名分组 无名分组"></a><strong>有名分组 无名分组</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 无名分组</span></span><br><span class="line">    - 路由层</span><br><span class="line">    url(<span class="string">r&#x27;^login/(\d+)/([a-z]&#123;2&#125;)&#x27;</span>, views.login), <span class="comment"># 无名分组，会把括号内正则表达式匹配的值当做位置参数传给后面的视图函数</span></span><br><span class="line">     - 视图层</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request, x,y</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line">    <span class="built_in">print</span>(y)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 有名分组</span></span><br><span class="line">    - 路由层</span><br><span class="line">    url(<span class="string">r&#x27;^login/(?P&lt;year&gt;\d+)/(?P&lt;month&gt;[a-z]&#123;2&#125;)&#x27;</span>, views.login), <span class="comment"># 有名分组，会把括号内正则表达式匹配的值当做关键字参数传给后面的视图函数</span></span><br><span class="line">    - 视图层</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request, year,month</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(year)</span><br><span class="line">    <span class="built_in">print</span>(month)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;无名有名分组不能混用&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="反向解析"><a href="#反向解析" class="headerlink" title="反向解析"></a><strong>反向解析</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r&#x27;login/&#x27;</span>, views2.login, name=<span class="string">&#x27;login&#x27;</span>),</span><br><span class="line">url(<span class="string">r&#x27;index/&#x27;</span>, views2.index, name=<span class="string">&#x27;index&#x27;</span>),</span><br><span class="line"><span class="comment"># 后端反向解析</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse, redirect, reverse</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(reverse(<span class="string">&#x27;login&#x27;</span>))  <span class="comment"># /login/</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;index2.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前端反向解析</span></span><br><span class="line">&lt;a href=<span class="string">&quot;&#123;% url &#x27;login&#x27; %&#125;&quot;</span>&gt;<span class="number">111</span>&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<h3 id="无名有名反向解析"><a href="#无名有名反向解析" class="headerlink" title="无名有名反向解析"></a><strong>无名有名反向解析</strong></h3><p><img src="/2020/08/23/python/image-20210727205757190.png" alt="python"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r&#x27;index/(\d+)&#x27;</span>, views2.index, name=<span class="string">&#x27;index&#x27;</span>),</span><br><span class="line"><span class="comment"># 后端反向解析</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(reverse(<span class="string">&#x27;login&#x27;</span>),args=(<span class="number">1</span>,))  <span class="comment"># /login/</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;index2.html&#x27;</span>)</span><br><span class="line"><span class="comment"># 前端反向解析</span></span><br><span class="line">&lt;a href=<span class="string">&quot;&#123;% url &#x27;login&#x27; 1 %&#125;&quot;</span>&gt;<span class="number">111</span>&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;这个分组后面的数字一般放的都是数据的主键值，数据的编辑和删减&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">request,edit_id</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(reverse(<span class="string">&#x27;反向解析路由的名字&#x27;</span>),args=(edit_id,))  </span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">for</span> user <span class="keyword">in</span> user_queryset %&#125;</span><br><span class="line">&lt;a herf=<span class="string">&quot;&#123;% url &#x27;反向解析路由的名字&#x27; user.id %&#125;&quot;</span>&gt;编辑 &lt;/a&gt;</span><br><span class="line">&#123;%  endfor  %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="路由分发"><a href="#路由分发" class="headerlink" title="路由分发"></a><strong>路由分发</strong></h3><p><img src="/2020/08/23/python/image-20210727205950867.png" alt="python"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 总路由</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> urls <span class="keyword">as</span> app01_urls</span><br><span class="line"><span class="keyword">from</span> app02 <span class="keyword">import</span> urls <span class="keyword">as</span> app02_urls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 1&quot;&quot;&quot;路由分发&quot;&quot;&quot;</span></span><br><span class="line">    url(<span class="string">r&#x27;app01/&#x27;</span>, include(app01_urls)),</span><br><span class="line">    url(<span class="string">r&#x27;app02/&#x27;</span>, include(app02_urls)),</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2&quot;&quot;&quot;终极写法（注意 总路由里面的url不能加$结尾）&quot;&quot;&quot;</span></span><br><span class="line">    url(<span class="string">r&#x27;^app01/&#x27;</span>, include(<span class="string">&#x27;app01.urls&#x27;</span>)),</span><br><span class="line">    url(<span class="string">r&#x27;^app02/&#x27;</span>, include(<span class="string">&#x27;app02.urls&#x27;</span>)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># app01路由</span></span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line"></span><br><span class="line">    url(<span class="string">r&#x27;login/&#x27;</span>, views.login, name=<span class="string">&#x27;login&#x27;</span>),</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># app02路由</span></span><br><span class="line"><span class="keyword">from</span> app02 <span class="keyword">import</span> views</span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line"></span><br><span class="line">    url(<span class="string">r&#x27;login/&#x27;</span>, views.login, name=<span class="string">&#x27;login&#x27;</span>),</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="render内部原理"><a href="#render内部原理" class="headerlink" title="render内部原理"></a><strong>render内部原理</strong></h3><p><img src="/2020/08/23/python/image-20210727214600829.png" alt="python"></p>
<h3 id="JsonResponse"><a href="#JsonResponse" class="headerlink" title="JsonResponse"></a>JsonResponse</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request</span>):</span></span><br><span class="line">    l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    user_dic = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;刘皓杰&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">19</span>&#125;</span><br><span class="line">    <span class="comment"># return JsonResponse(l, safe=False)  # 列表序列化要加safe参数</span></span><br><span class="line">    <span class="keyword">return</span> JsonResponse(user_dic, json_dumps_params=&#123;<span class="string">&quot;ensure_ascii&quot;</span>: <span class="literal">False</span>&#125;)  <span class="comment"># 列表序列化要加safe参数</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a><strong>文件上传</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.files.uploadedfile <span class="keyword">import</span> InMemoryUploadedFile</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line"><span class="built_in">print</span>(request.FILES)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(request.FILES.get(<span class="string">&#x27;myfile&#x27;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(request.body)</span><br><span class="line"><span class="built_in">print</span>(request.GET)</span><br><span class="line"><span class="built_in">print</span>(request.POST)</span><br><span class="line"></span><br><span class="line">file = request.FILES.get(<span class="string">&#x27;myfile&#x27;</span>)</span><br><span class="line">file_name = request.FILES.get(<span class="string">&#x27;myfile&#x27;</span>).name</span><br><span class="line"><span class="built_in">print</span>(file_name) ==&gt; <span class="built_in">print</span>(file.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存到文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file_name,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file.chunks():</span><br><span class="line">        f.write(line)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> HttpResponse(<span class="string">&#x27;文件上传成功！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># action</span></span><br><span class="line"><span class="comment">#1 不写，默认向当前地址发送请求</span></span><br><span class="line"><span class="comment">#2 /index/，向当前域（http://127.0.0.1:8000/）的/index/发送请求</span></span><br><span class="line"><span class="comment">#3 http://127.0.0.1:8000/index/，向该地址发送请求（可以向第三方服务发送请求）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># method</span></span><br><span class="line"><span class="comment"># 1 post：发送post请求（默认编码情况下：以key=value&amp;key=value的形式拼到请求体中）</span></span><br><span class="line"><span class="comment"># 2 get：发送get请求（以key=value&amp;key=value的形式拼到路径中）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;/index/&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    &lt;p&gt;用户名&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;密码&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;myfile&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;登录&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<h3 id="cbv和fbv"><a href="#cbv和fbv" class="headerlink" title="cbv和fbv"></a><strong>cbv和fbv</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cbv和fbv(CBV基于类的视图(Class base view)和FBV基于函数的视图（Function base view）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;get&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;post&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">urls.py</span><br><span class="line"><span class="comment"># CBV配置路由</span></span><br><span class="line">    <span class="comment"># url(r&#x27;^index/&#x27;, views.Index.as_view()),</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;cbv本质</span></span><br><span class="line"><span class="string"># 1 请来了，路由匹配成功执行 path(&#x27;index/&#x27;, views.Index.as_view()),    执行views.Index.as_view()()# 2 本质是执行as_view()内部有个闭包函数view()# 3 本质是view()---》dispatch()# 4 dispatch内部，根据请求的方法（get,post）----&gt;执行视图类中的def get  def post</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="模板的继承和导入"><a href="#模板的继承和导入" class="headerlink" title="模板的继承和导入"></a><strong>模板的继承和导入</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment"># 模板的继承#&#125;</span></span><br><span class="line">&#123;% extends <span class="string">&#x27;index.html&#x27;</span> %&#125;</span><br><span class="line">    </span><br><span class="line">&#123;<span class="comment"># 模板的导入#&#125;</span></span><br><span class="line">&#123;% include <span class="string">&#x27;test.html&#x27;</span> %&#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;<span class="comment"># 模板的导入#&#125;</span></span><br><span class="line">    &#123;% include <span class="string">&#x27;test.html&#x27;</span> %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a><strong>ORM</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> orm:对象关系映射（跟语言无关）</span><br><span class="line">    	数据库中的表     ----》对应程序的一个类</span><br><span class="line">        数据库中的一行数据----》对应程序中的一个对象</span><br><span class="line"><span class="number">2</span> python中常见orm框架</span><br><span class="line">	-django的orm框架</span><br><span class="line">    -sqlachemy orm框架</span><br><span class="line">    </span><br><span class="line"><span class="number">3</span> java：（扩展），java中写web项目</span><br><span class="line">	ssh框架 ：spring+struts（有漏洞）+hibernate（orm框架） （我的那个年代）</span><br><span class="line">	ssm框架：spring+springmvc+mybatis（orm框架，可以写原生sql）</span><br><span class="line">    springboot：sb框架 ，tomcat内置进去了</span><br><span class="line">    springcloud：微服务</span><br><span class="line"><span class="number">4</span> orm能干的事</span><br><span class="line">	-创建表（不能创建数据库，手动创建数据库）</span><br><span class="line">    -增加删除表内字段</span><br><span class="line">    -增删查改数据</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="number">0</span> sqlite：也是要给数据库，文件数据库，一个库就是要给文件，不需要单独安装</span><br><span class="line">	-咱们现在在用，也要用到关系型数据库，不想装mysql，就可以使用sqlite</span><br><span class="line">    -移动开发本地存储数据，存在sqlite中</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> 创建个UserInfo表，在models中写一个类</span><br><span class="line"><span class="number">2</span> 表中有字段（类属性），字段有属性，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一步在models中写要给类</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">        <span class="comment"># 字段属性--》后面那个对象决定的,</span></span><br><span class="line">        <span class="comment"># 改字段自增，并且是主键</span></span><br><span class="line">        <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 改字段是varchar类型，长度为32(唯一约束，是否是索引，默认值是，是否可以为空)</span></span><br><span class="line">        name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">        <span class="comment"># 密码字段</span></span><br><span class="line">        password =models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 数字类型</span></span><br><span class="line">   	 	gender = models.IntegerField(default=<span class="number">0</span>)  <span class="comment"># 默认值为0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 省份</span></span><br><span class="line">        province = models.CharField(max_length=<span class="number">32</span>,null=<span class="literal">True</span>)  <span class="comment"># 可以为空</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 第二步，把表创建出来(执行两个命令)</span></span><br><span class="line">	-python3 manage.py makemigrations  <span class="comment"># 这条命令会在migrations创建一条记录，数据库变更记录</span></span><br><span class="line">    -python3 manage.py migrate         <span class="comment"># 把更改同步到数据库</span></span><br></pre></td></tr></table></figure>

<h3 id="查询表记录API"><a href="#查询表记录API" class="headerlink" title="查询表记录API"></a><strong>查询表记录API</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="number">1</span>&gt; <span class="built_in">all</span>():                  查询所有结果</span><br><span class="line">&lt;<span class="number">2</span>&gt; <span class="built_in">filter</span>(**kwargs):       它包含了与所给筛选条件相匹配的对象</span><br><span class="line">&lt;<span class="number">3</span>&gt; get(**kwargs):          返回与所给筛选条件相匹配的对象，返回结果有且只有一个，如果符合筛选条件的对象超过一个或者没有都会抛出错误。</span><br><span class="line">&lt;<span class="number">4</span>&gt; exclude(**kwargs):      它包含了与所给筛选条件不匹配的对象</span><br><span class="line">&lt;<span class="number">5</span>&gt; order_by(*field):       对查询结果排序(<span class="string">&#x27;-id&#x27;</span>)</span><br><span class="line">&lt;<span class="number">6</span>&gt; reverse():              对查询结果反向排序</span><br><span class="line">&lt;<span class="number">8</span>&gt; count():                返回数据库中匹配查询(QuerySet)的对象数量。</span><br><span class="line">&lt;<span class="number">9</span>&gt; first():                返回第一条记录</span><br><span class="line">&lt;<span class="number">10</span>&gt; last():                返回最后一条记录</span><br><span class="line">&lt;<span class="number">11</span>&gt; exists():              如果QuerySet包含数据，就返回<span class="literal">True</span>，否则返回<span class="literal">False</span></span><br><span class="line">&lt;<span class="number">12</span>&gt; values(*field):        返回一个ValueQuerySet——一个特殊的QuerySet，运行后得到的并不是一系列                          model的实例化对象，而是一个可迭代的字典序列</span><br><span class="line">&lt;<span class="number">13</span>&gt; values_list(*field):   它与values()非常相似，它返回的是一个元组序列，values返回的是一个字典序列</span><br><span class="line">&lt;<span class="number">14</span>&gt; distinct():            从返回结果中剔除重复纪录</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 必会13条</span></span><br><span class="line">    <span class="comment"># 1.all()       查询所有</span></span><br><span class="line">    <span class="comment"># 2.filter()    带有过滤条件查询</span></span><br><span class="line">    <span class="comment"># 3.get()       直接拿数据对象条件不存在报错</span></span><br><span class="line">    <span class="comment"># 4.first()     拿QuerySet中第一个元素</span></span><br><span class="line">    res = models.UserInfo.objects.<span class="built_in">all</span>().first()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.last()     拿QuerySet中最后一个元素</span></span><br><span class="line">    <span class="comment"># 6. values()  可以指定获取数据的字段--》返回结果列表套字典</span></span><br><span class="line">    res = models.UserInfo.objects.values(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)  <span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;lhj&#x27;&#125;, &#123;&#x27;name&#x27;: &#x27;lxx&#x27;&#125;, &#123;&#x27;name&#x27;: &#x27;lxx&#x27;&#125;]&gt;</span></span><br><span class="line">	<span class="built_in">print</span>(res.query)  <span class="comment"># 查看内部封装的SQL语句，只能用于QuerySet对象</span></span><br><span class="line">    <span class="comment"># 7. values_list()  可以指定获取数据的字段--》返回结果列表套元组</span></span><br><span class="line">    res = models.UserInfo.objects.values_list(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)   <span class="comment"># &lt;QuerySet [(&#x27;lhj&#x27;,), (&#x27;lxx&#x27;,), (&#x27;lxx&#x27;,)]&gt;</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    print(res.query) </span></span><br><span class="line"><span class="string">    查看原生sql语句</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 8.distinct()     去重</span></span><br><span class="line">    <span class="comment"># res = models.UserInfo.objects.values_list(&#x27;name&#x27;,).distinct()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    去重一定是要一模一样的数据</span></span><br><span class="line"><span class="string">    而且不能忽略主键</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 9. order_by() 排序--》 默认升序</span></span><br><span class="line">    res = models.UserInfo.objects.order_by(<span class="string">&#x27;register_time&#x27;</span>) <span class="comment"># 升序</span></span><br><span class="line">    res = models.UserInfo.objects.order_by(<span class="string">&#x27;-register_time&#x27;</span>) <span class="comment"># 降序</span></span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 10.reverse 反转--》  前提是已将排过序</span></span><br><span class="line">    res = models.UserInfo.objects.order_by(<span class="string">&#x27;register_time&#x27;</span>).reverse()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 11.count() 统计个数</span></span><br><span class="line">    res = models.UserInfo.objects.count()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 12.exclude()  排除在外</span></span><br><span class="line">    res = models.UserInfo.objects.exclude(name=<span class="string">&#x27;alex&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 13.exists()  返回布尔值，基本用不到</span></span><br></pre></td></tr></table></figure>

<h3 id="表模型多表查询"><a href="#表模型多表查询" class="headerlink" title="表模型多表查询"></a><strong>表模型多表查询</strong></h3><p>models.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publish</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    addr = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    phone = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    email = models.EmailField()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">6</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    publish_date = models.DateTimeField(auto_now_add=<span class="literal">True</span>.default=datetime.datetime.now)</span><br><span class="line">	<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    auto_now     数据更新时间修改</span></span><br><span class="line"><span class="string">    auto_now_add 创建时间则不会修改</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    publish = models.ForeignKey(to=Publish, on_delete=models.CASCADE)  <span class="comment"># 不写，默认跟主键做关联</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自动创建出第三张表(这句话会自动创建第三章表)</span></span><br><span class="line">    <span class="comment"># authors在数据库中不存在该字段，没有to_field</span></span><br><span class="line">    <span class="comment"># 默认情况：第三张表有id字段，当前Book表的id和Author表的id字段</span></span><br><span class="line">    authors = models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    age = models.SmallIntegerField()</span><br><span class="line">    <span class="comment"># 一对一的本质是  ForeignKey+unique</span></span><br><span class="line">    <span class="comment"># author_detail=models.ForeignKey(to=&#x27;AuthorDetail&#x27;,to_field=&#x27;id&#x27;,unique=True)</span></span><br><span class="line"></span><br><span class="line">    author_detail = models.OneToOneField(to=<span class="string">&#x27;AuthorDetail&#x27;</span>, on_delete=models.CASCADE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorDetail</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    sex = models.SmallIntegerField()</span><br><span class="line">    addr = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    phone = models.BigIntegerField()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>生成表</p>
<p><img src="/2020/08/23/python/image-20220616164255678.png" alt="python"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br><span class="line"><span class="comment"># makemigrations 若报错</span></span><br><span class="line"><span class="comment"># 进入python解释器安装目录：D:\python\Lib\site-packages\django\contrib\admin\migrations删除除了__init__.py里面的所有文件</span></span><br><span class="line"><span class="comment"># 创建表及一些元数据信息</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    <span class="comment"># 表名</span></span><br><span class="line">    db_table = <span class="string">&quot;book&quot;</span></span><br><span class="line">    <span class="comment">#联合索引</span></span><br><span class="line">    index_together = [</span><br><span class="line">        (<span class="string">&quot;name&quot;</span>, <span class="string">&quot;publish&quot;</span>),</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment"># 联合唯一索引</span></span><br><span class="line">    unique_together = ((<span class="string">&quot;name&quot;</span>, <span class="string">&quot;publish&quot;</span>),)</span><br></pre></td></tr></table></figure>

<p>在django测试环境模拟多表操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;django_server.settings&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line">    <span class="comment"># 一对多添加记录</span></span><br><span class="line">    <span class="comment"># 增</span></span><br><span class="line">    publish = models.Publish.objects.create(name=<span class="string">&#x27;南京出版社&#x27;</span>, addr=<span class="string">&#x27;南京&#x27;</span>, email=<span class="string">&#x27;666@qq.com&#x27;</span>)</span><br><span class="line">    models.Book.objects.create(name=<span class="string">&#x27;封神榜&#x27;</span>, price=<span class="number">166.88</span>, publish_id=publish.<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删</span></span><br><span class="line">    res = models.Publish.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).delete()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查</span></span><br><span class="line">    res = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 改</span></span><br><span class="line">    <span class="comment">#1</span></span><br><span class="line">    res = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).update(publish_id=<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    <span class="comment">#2</span></span><br><span class="line">    publish_obj = models.Publish.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>).first()</span><br><span class="line">    models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).update(publish=publish_obj)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 多对多添加记录</span></span><br><span class="line">     author_detail = models.AuthorDetail.objects.create(phone=<span class="number">123456</span>, sex=<span class="number">0</span>, addr=<span class="string">&#x27;北京&#x27;</span>)</span><br><span class="line">     author = models.Author.objects.create(name=<span class="string">&#x27;大冰&#x27;</span>, age=<span class="number">36</span>, author_detail_id=author_detail.<span class="built_in">id</span>)</span><br><span class="line">    book = models.Book.objects.get(name=<span class="string">&#x27;祈祷落幕时&#x27;</span>)</span><br><span class="line">    <span class="comment"># 方式一  添加作者对象</span></span><br><span class="line">    <span class="comment"># author_1 = models.Author.objects.get(id=1)</span></span><br><span class="line">    <span class="comment"># author_2 = models.Author.objects.get(id=2)</span></span><br><span class="line">    <span class="comment"># book.authors.add(author_1, author_2)</span></span><br><span class="line">    <span class="comment"># 方式二  添加ID</span></span><br><span class="line">    book.authors.add(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 白夜行删除一个作者</span></span><br><span class="line">    <span class="comment"># book = models.Book.objects.get(name=&#x27;白夜行&#x27;)</span></span><br><span class="line">    <span class="comment"># book.authors.remove(1)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># clear 清空所有作者</span></span><br><span class="line">    <span class="comment"># book = models.Book.objects.get(name=&#x27;白夜行&#x27;)</span></span><br><span class="line">    <span class="comment"># book.authors.add(2, 3)</span></span><br><span class="line">    <span class="comment"># book.authors.clear()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># set 先清空，再add,前提是不存在的作者</span></span><br><span class="line">    <span class="comment"># book = models.Book.objects.get(name=&#x27;白夜行&#x27;)</span></span><br><span class="line">    <span class="comment"># book.authors.set([1, 3])</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 双下划线的跨表查询</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    外键字段在哪一方就是正向</span></span><br><span class="line"><span class="string">    book --》 publish 正向</span></span><br><span class="line"><span class="string">    publish --》 book 反向</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    正向查询按字段</span></span><br><span class="line"><span class="string">    反向查询按表名小写</span></span><br><span class="line"><span class="string">        _set.all()</span></span><br><span class="line"><span class="string">        查询结果有多个需要加 表名小写_set.all()</span></span><br><span class="line"><span class="string">        如果一个直接表名小写_set</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># 1.查询书籍主键为1的出版社和书的名称</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=1).values(&#x27;publish__name&#x27;,&#x27;name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.filter(book__id=1).values(&#x27;name&#x27;, &#x27;book__name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.查询作者大冰的手机号和书籍名称</span></span><br><span class="line">    res = models.Author.objects.<span class="built_in">filter</span>(name__exact=<span class="string">&quot;大冰&quot;</span>).values(<span class="string">&#x27;author_detail__phone&#x27;</span>, <span class="string">&#x27;book__name&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向</span></span><br><span class="line">    res = models.AuthorDetail.objects.<span class="built_in">filter</span>(author__name=<span class="string">&quot;大冰&quot;</span>).values(<span class="string">&#x27;phone&#x27;</span>, <span class="string">&#x27;author__book__name&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.查询书籍主键为1的价钱和作者地址</span></span><br><span class="line">    res = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>).values(<span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;authors__author_detail__addr&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向</span></span><br><span class="line">    res = models.AuthorDetail.objects.<span class="built_in">filter</span>(author__book__id=<span class="number">2</span>).values(<span class="string">&#x27;author__book__price&#x27;</span>, <span class="string">&#x27;addr&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>



<h3 id="双下划线的模糊查询"><a href="#双下划线的模糊查询" class="headerlink" title="双下划线的模糊查询"></a><strong>双下划线的模糊查询</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># __的使用方法</span></span><br><span class="line">   <span class="comment"># 1 查询年龄大于30</span></span><br><span class="line">   <span class="comment">#  age__gt(大于)</span></span><br><span class="line">   <span class="comment">#  age__gte(大于等于)</span></span><br><span class="line">   <span class="comment"># res = models.UserInfo.objects.filter(age__gt = 30)</span></span><br><span class="line">   <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 2 查询年龄小于30</span></span><br><span class="line">   <span class="comment">#  age__lt(小于)</span></span><br><span class="line">   <span class="comment">#  age__lte(小于等于)</span></span><br><span class="line">   <span class="comment"># res = models.UserInfo.objects.filter(age__lt=30)</span></span><br><span class="line">   <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 3 查询年龄在18或28或38</span></span><br><span class="line">   <span class="comment"># age__in</span></span><br><span class="line">   <span class="comment"># res = models.UserInfo.objects.filter(age__in=[18, 28, 38])</span></span><br><span class="line">   <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">#4 查询年龄在18或48之间</span></span><br><span class="line">   <span class="comment"># age__range</span></span><br><span class="line">   <span class="comment"># res = models.UserInfo.objects.filter(age__range=[18, 48])</span></span><br><span class="line">   <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">#5 模糊查询 默认区分大小写</span></span><br><span class="line">   <span class="comment"># name__contains</span></span><br><span class="line">   <span class="comment"># res = models.UserInfo.objects.filter(name__contains=&#x27;a&#x27;)</span></span><br><span class="line">   <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 忽略大小写</span></span><br><span class="line">   <span class="comment"># name__icontains</span></span><br><span class="line">   <span class="comment"># res = models.UserInfo.objects.filter(name__icontains=&#x27;a&#x27;)</span></span><br><span class="line">   <span class="comment"># print(res)</span></span><br></pre></td></tr></table></figure>

<h3 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a><strong>聚合查询</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Max, Min, Sum, Avg, Count</span><br><span class="line"></span><br><span class="line">res=models.Book.objects.aggregate(Max(<span class="string">&#x27;price&#x27;</span>),Min(<span class="string">&#x27;price&#x27;</span>),Sum(<span class="string">&#x27;price&#x27;</span>),Avg(<span class="string">&#x27;price&#x27;</span>),Count(<span class="string">&#x27;id&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    		<span class="comment"># 起别名</span></span><br><span class="line"><span class="comment"># aggregate(a=Max(&#x27;price&#x27;))</span></span><br></pre></td></tr></table></figure>

<h3 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a><strong>分组查询</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  annotate() 内写聚合函数</span></span><br><span class="line">    <span class="comment">#  values在前表示group by的字段</span></span><br><span class="line">    <span class="comment">#  values在后表示取某几个字段</span></span><br><span class="line">    <span class="comment">#  filter在前表示where</span></span><br><span class="line">    <span class="comment">#  filter在后表示having</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Max, Min, Sum, Avg, Count</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 练习：统计每一本书作者个数</span></span><br><span class="line">    <span class="comment">## 1</span></span><br><span class="line">    <span class="comment"># books = models.Book.objects.annotate(author_num=Count(&#x27;authors&#x27;))</span></span><br><span class="line">    <span class="comment"># for book in books:</span></span><br><span class="line">    <span class="comment">#     print(book.name)</span></span><br><span class="line">    <span class="comment">#     print(book.author_num)</span></span><br><span class="line">    <span class="comment">## 2</span></span><br><span class="line">    <span class="comment"># books = models.Book.objects.annotate(author_num=Count(&#x27;authors&#x27;)).values(&#x27;name&#x27;,&#x27;author_num&#x27;)</span></span><br><span class="line">    <span class="comment"># print(books)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 3</span></span><br><span class="line">    <span class="comment"># author = models.Author.objects.values(&#x27;book&#x27;).annotate(author_num=Count(&#x27;name&#x27;)).values(&#x27;book__name&#x27;,&#x27;author_num&#x27;)</span></span><br><span class="line">    <span class="comment"># print(author)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#  练习：统计每一个出版社的最便宜的书</span></span><br><span class="line">    <span class="comment">## 1</span></span><br><span class="line">    <span class="comment"># publish = models.Publish.objects.annotate(min=Min(&#x27;book__price&#x27;)).values(&#x27;name&#x27;, &#x27;min&#x27;)</span></span><br><span class="line">    <span class="comment"># print(publish)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 2</span></span><br><span class="line">    <span class="comment"># book = models.Book.objects.values(&#x27;publish&#x27;).annotate(min=Min(&#x27;price&#x27;)).values(&#x27;publish__name&#x27;, &#x27;min&#x27;)</span></span><br><span class="line">    <span class="comment"># print(book)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 练习：统计不止一个作者的图书：（作者数量大于一）</span></span><br><span class="line">    <span class="comment">## 1</span></span><br><span class="line">    <span class="comment"># author = models.Author.objects.values(&#x27;book__id&#x27;).annotate(count=Count(&#x27;id&#x27;)).filter(count__gt=1).values(&#x27;book__name&#x27;, &#x27;count&#x27;)</span></span><br><span class="line">    <span class="comment"># print(author)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 2</span></span><br><span class="line">    <span class="comment"># book = models.Book.objects.annotate(count=Count(&#x27;authors__id&#x27;)).filter(count__gt=1).values(&#x27;name&#x27;, &#x27;count&#x27;)</span></span><br><span class="line">    <span class="comment"># print(book)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># #统计价格数大于200元，作者个数大于1的图书</span></span><br><span class="line">    <span class="comment"># book = models.Book.objects.filter(price__gt=200).annotate(count=Count(&#x27;authors__id&#x27;)).filter(count__gt=1).values(&#x27;name&#x27;, &#x27;count&#x27;)</span></span><br><span class="line">    <span class="comment"># print(book)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 练习：根据一本图书作者数量的多少对查询集 QuerySet进行排序:</span></span><br><span class="line">    <span class="comment"># book = models.Book.objects.annotate(count=Count(&#x27;authors&#x27;)).order_by(&#x27;count&#x27;)</span></span><br><span class="line">    <span class="comment"># print(book)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 练习：查询各个作者出的书的总价格:</span></span><br><span class="line">    <span class="comment"># author = models.Author.objects.annotate(sum=Sum(&#x27;book__price&#x27;)).values(&#x27;name&#x27;,&#x27;sum&#x27;)</span></span><br><span class="line">    <span class="comment"># print(author)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 练习：查询每个出版社的名称和书籍个数</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.annotate(count=Count(&#x27;book__id&#x27;)).values(&#x27;name&#x27;, &#x27;count&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br></pre></td></tr></table></figure>

<h3 id="F和Q查询"><a href="#F和Q查询" class="headerlink" title="F和Q查询"></a><strong>F和Q查询</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># F查询：取出数据库的某个字段的值</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 把read_num都加1</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line">    ret=models.Book.objects.<span class="built_in">all</span>().update(read_num=F(<span class="string">&#x27;read_num&#x27;</span>)+<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(ret)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#查询评论数大于阅读数的书籍</span></span><br><span class="line">    ret=models.Book.objects.<span class="built_in">all</span>().<span class="built_in">filter</span>(commit_num__gt=F(<span class="string">&#x27;read_num&#x27;</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ret:</span><br><span class="line">        <span class="built_in">print</span>(i.name)</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 查询评论数大于阅读数2倍的书籍</span></span><br><span class="line">    ret=models.Book.objects.<span class="built_in">filter</span>(commit_num__gt=F(<span class="string">&#x27;read_num&#x27;</span>)*<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(ret)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># Q查询：制造  与或非的条件</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Q查询：制造  与或非的条件</span></span><br><span class="line">    <span class="comment"># 查询名字叫egon或者价格大于100的书</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">    <span class="comment"># ret=models.Book.objects.filter(Q(name=&#x27;egon&#x27;) | Q(price__gt=100))</span></span><br><span class="line">    <span class="comment"># 查询名字叫egon并且价格大于100的书</span></span><br><span class="line">    <span class="comment"># ret=models.Book.objects.filter(Q(name=&#x27;egon&#x27;) &amp; Q(price__gt=100))</span></span><br><span class="line">    <span class="comment"># ret=models.Book.objects.filter(name=&#x27;egon&#x27;,price__gt=100)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询名字不为egon的书</span></span><br><span class="line">    <span class="comment"># ret = models.Book.objects.filter(~Q(name=&#x27;egon&#x27;))</span></span><br><span class="line">    <span class="comment"># print(ret)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Q可以嵌套</span></span><br><span class="line">    ret = models.Book.objects.<span class="built_in">filter</span>((Q(name=<span class="string">&#x27;egon&#x27;</span>) &amp; Q(price__lt=<span class="number">100</span>)) | Q(id__lt=<span class="number">3</span>))</span><br><span class="line">    <span class="built_in">print</span>(ret)</span><br></pre></td></tr></table></figure>

<h3 id="打印原生sql"><a href="#打印原生sql" class="headerlink" title="打印原生sql"></a><strong>打印原生sql</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;disable_existing_loggers&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">&#x27;handlers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;console&#x27;</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;logging.StreamHandler&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;django.db.backends&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Django日志配置"><a href="#Django日志配置" class="headerlink" title="Django日志配置"></a>Django日志配置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;disable_existing_loggers&#x27;</span>: <span class="literal">False</span>, <span class="comment"># 是否禁用已经存在的日志器</span></span><br><span class="line">    <span class="string">&#x27;formatters&#x27;</span>: &#123;  <span class="comment"># 输出日志的格式</span></span><br><span class="line">        <span class="string">&#x27;verbose&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;%(levelname)s %(asctime)s %(module)s %(lineno)d %(message)s&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;simple&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;%(levelname)s %(module)s %(lineno)d %(message)s&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;filters&#x27;</span>: &#123;  <span class="comment"># 对日志进行过滤</span></span><br><span class="line">        <span class="string">&#x27;require_debug_true&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;()&#x27;</span>: <span class="string">&#x27;django.utils.log.RequireDebugTrue&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;handlers&#x27;</span>: &#123; <span class="comment"># 日志的处理方式</span></span><br><span class="line">        <span class="string">&#x27;console&#x27;</span>: &#123;  <span class="comment"># 终端输出日志</span></span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;INFO&#x27;</span>,  <span class="comment"># 大于INFO级别，才输出</span></span><br><span class="line">            <span class="string">&#x27;filters&#x27;</span>: [<span class="string">&#x27;require_debug_true&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;logging.StreamHandler&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;formatter&#x27;</span>: <span class="string">&#x27;simple&#x27;</span> <span class="comment"># 输出简单的样式</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;file&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;INFO&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;logging.handlers.RotatingFileHandler&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;filename&#x27;</span>: os.path.join(BASE_DIR , <span class="string">&quot;logs/log.log&quot;</span>),  <span class="comment"># 日志文件的位置</span></span><br><span class="line">            <span class="string">&#x27;maxBytes&#x27;</span>: <span class="number">300</span> * <span class="number">1024</span> * <span class="number">1024</span>,  <span class="comment"># 文件最多存储 300M 的内存   日志文件满了，他会自动新建meiduo1 meiduo2</span></span><br><span class="line">            <span class="string">&#x27;backupCount&#x27;</span>: <span class="number">10</span>, <span class="comment"># 最多十个文件</span></span><br><span class="line">            <span class="string">&#x27;formatter&#x27;</span>: <span class="string">&#x27;verbose&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;django&#x27;</span>: &#123;  <span class="comment"># 定义了一个名为django的日志器</span></span><br><span class="line">            <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>, <span class="string">&#x27;file&#x27;</span>], <span class="comment"># 可以同时在终端跟文件中输出</span></span><br><span class="line">            <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&#x27;level;&#x27;</span>:<span class="string">&#x27;INFO&#x27;</span> <span class="comment"># 日至输出的最低级别</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a><strong>事务</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 事物：ACID，事物的隔离级别（搜），锁， 行级锁，表级锁</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># djanog orm中使用事物：原子性操作，要么都成功，要么都失败</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 新增一个作者详情，新增一个作者</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 事物的三个粒度</span></span><br><span class="line">    <span class="comment"># 1 局部使用</span></span><br><span class="line">    <span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line">    <span class="keyword">with</span> transaction.atomic(): <span class="comment"># 都在事物中，要么都成功，要么都失败</span></span><br><span class="line">        author_detail=models.AuthorDetail.objects.create(addr=<span class="string">&#x27;xxx&#x27;</span>,phone=<span class="string">&#x27;123&#x27;</span>,sex=<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># raise Exception(&#x27;抛了异常&#x27;)</span></span><br><span class="line">        author=models.Author.objects.create(name=<span class="string">&#x27;llqz&#x27;</span>,age=<span class="number">19</span>,author_detail=author_detail)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 2 视图函数装饰器,这一个视图函数都在一个事物中</span></span><br><span class="line">    <span class="comment"># @transaction.atomic</span></span><br><span class="line">    <span class="comment"># def index(request):</span></span><br><span class="line">    <span class="comment">#     return HttpResponse(&#x27;ok&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3 整个http请求，在事物中，在setting.py中配置</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    DATABASES = &#123;</span></span><br><span class="line"><span class="string">        &#x27;default&#x27;: &#123;</span></span><br><span class="line"><span class="string">            ...</span></span><br><span class="line"><span class="string">            &#x27;PORT&#x27;: 3306,</span></span><br><span class="line"><span class="string">            &#x27;ATOMIC_REQUEST&#x27;: True,</span></span><br><span class="line"><span class="string">       </span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#x27;ATOMIC_REQUEST&#x27;: True,</span></span><br><span class="line"><span class="string">设置为True统一个http请求对应的所有sql都放在一个事务中执行（要么所有都成功，要么所有都失败）。</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="forms组件"><a href="#forms组件" class="headerlink" title="forms组件"></a><strong>forms组件</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> widgets</span><br><span class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> ValidationError</span><br><span class="line"><span class="keyword">from</span> django.core.validators <span class="keyword">import</span> RegexValidator</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reg</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    name = forms.CharField(max_length=<span class="number">32</span>, min_length=<span class="number">3</span>, required=<span class="literal">True</span>, label=<span class="string">&#x27;用户名&#x27;</span>, error_messages=&#123;</span><br><span class="line">        <span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;用户名长度不能超过32位&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;min_length&#x27;</span>: <span class="string">&#x27;用户名长度不能小于3位&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;用户名不能为空&#x27;</span></span><br><span class="line">    &#125;, widget=forms.widgets.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;))</span><br><span class="line"></span><br><span class="line">    password = forms.CharField(max_length=<span class="number">32</span>, min_length=<span class="number">3</span>, label=<span class="string">&#x27;密码&#x27;</span>, error_messages=&#123;</span><br><span class="line">        <span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;密码长度不能超过32位&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;min_length&#x27;</span>: <span class="string">&#x27;密码长度不能小于3位&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;密码不能为空&#x27;</span></span><br><span class="line">    &#125;, widget=forms.widgets.PasswordInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;))</span><br><span class="line"></span><br><span class="line">    re_password = forms.CharField(max_length=<span class="number">32</span>, min_length=<span class="number">3</span>, label=<span class="string">&#x27;确认密码&#x27;</span>, error_messages=&#123;</span><br><span class="line">        <span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;确认密码长度不能超过32位&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;min_length&#x27;</span>: <span class="string">&#x27;确认密码长度不能小于3位&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;确认密码不能为空&#x27;</span></span><br><span class="line">    &#125;, widget=forms.widgets.PasswordInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;))</span><br><span class="line"></span><br><span class="line">    phone = forms.CharField(</span><br><span class="line">        max_length=<span class="number">11</span>,</span><br><span class="line">        error_messages=&#123;</span><br><span class="line">            <span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;手机长度不能超过11位&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;手机号不能为空&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        validators=[</span><br><span class="line">            RegexValidator(<span class="string">r&#x27;^[0-9]+$&#x27;</span>, <span class="string">&#x27;请输入数字&#x27;</span>),</span><br><span class="line">            RegexValidator(<span class="string">r&#x27;^0?(13|14|15|17|18|19)[0-9]&#123;9&#125;$&#x27;</span>, <span class="string">&#x27;手机号码格式不对&#x27;</span>),</span><br><span class="line">        ],</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_password</span>(<span class="params">self</span>):</span></span><br><span class="line">        password = self.cleaned_data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;111&#x27;</span> <span class="keyword">in</span> password:</span><br><span class="line">            self.add_error(<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;错误&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> password</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># self:当前form对象</span></span><br><span class="line">        name = self.cleaned_data.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        user = models.UserInfo.objects.<span class="built_in">filter</span>(username=name)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">            <span class="keyword">return</span> name</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;用户名已存在&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        password = self.cleaned_data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        re_password = self.cleaned_data.get(<span class="string">&#x27;re_password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re_password == password:</span><br><span class="line">            <span class="comment"># raise ValidationError(&#x27;两次密码不一致&#x27;)</span></span><br><span class="line">            self.add_error(<span class="string">&#x27;re_password&#x27;</span>, <span class="string">&#x27;两次密码不一致&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.cleaned_data</span><br></pre></td></tr></table></figure>

<h3 id="django中cookie的使用"><a href="#django中cookie的使用" class="headerlink" title="django中cookie的使用"></a><strong>django中cookie的使用</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0 会话跟踪，会话保持</span></span><br><span class="line"><span class="comment"># 1 cookie规范</span></span><br><span class="line">	-记住：当前网站在浏览器上cookie个数和大小有限制</span><br><span class="line"> 	-Cookie大小上限为4KB； </span><br><span class="line"> 	-一个服务器最多在客户端浏览器上保存<span class="number">20</span>个Cookie； </span><br><span class="line"> 	-一个浏览器最多保存<span class="number">300</span>个Cookie；</span><br><span class="line"><span class="comment"># 2 django中操作cookie</span></span><br><span class="line">	-增：obj.set_cookie(<span class="string">&#x27;key&#x27;</span>,<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">    -删: obj.delete_cookie(<span class="string">&#x27;key&#x27;</span>)  <span class="comment"># 设置过期</span></span><br><span class="line">    -查: request.COOKIES.get(<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line">    -改: obj.set_cookie(<span class="string">&#x27;key&#x27;</span>,<span class="string">&#x27;value1&#x27;</span>)</span><br><span class="line"><span class="comment"># 3 带签名的cookie（加盐，加密）</span></span><br><span class="line">	-增：obj.set_signed_cookie(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;lqz&#x27;</span>,<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">    -删: obj.delete_cookie(<span class="string">&#x27;name&#x27;</span>)  <span class="comment"># 设置过期</span></span><br><span class="line">    -查: request.get_signed_cookie(<span class="string">&#x27;name&#x27;</span>,salt=<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">    -改: obj.set_signed_cookie(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;lqz&#x27;</span>,<span class="string">&#x27;123&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="cookie-session-token"><a href="#cookie-session-token" class="headerlink" title="cookie session token"></a><strong>cookie session token</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cookie：存在客户端的键值对，想服务端发送请求，会携带它过去（不安全）</span><br><span class="line">session：存在服务端的键值对（内存，文件，redis，mysql）</span><br><span class="line">	-缺陷：随着用户的增多，存储需要消耗服务端资源</span><br><span class="line">token：就是个字符串（既安全又存有个人信息），加密字符串，会有个人信息</span><br><span class="line">	-token现在应用广泛，契合了前后端分离</span><br><span class="line">    - JWT json web token</span><br></pre></td></tr></table></figure>



<h3 id="cookie版登陆校验"><a href="#cookie版登陆校验" class="headerlink" title="cookie版登陆校验"></a><strong>cookie版登陆校验</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse, redirect</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>(<span class="params">request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># print(request.get_full_path()) #  可以获取用户上次次要访问的url</span></span><br><span class="line">        <span class="comment"># print(request.path_info)</span></span><br><span class="line">        target_url = request.get_full_path()</span><br><span class="line">        <span class="keyword">if</span> request.COOKIES.get(<span class="string">&#x27;name&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> func(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;/app01/login/?%s&#x27;</span> %target_url)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        name = request.POST.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">&#x27;lxx&#x27;</span> <span class="keyword">and</span> password == <span class="string">&#x27;123&#x27;</span>:</span><br><span class="line">            <span class="comment"># 获取用户上次次要访问的url</span></span><br><span class="line">            target_url = request.GET.get(<span class="string">&#x27;next&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> target_url:</span><br><span class="line">                obj = redirect(target_url)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 保存用户登录状态</span></span><br><span class="line">                obj = redirect(<span class="string">&#x27;/app01/order/&#x27;</span>)</span><br><span class="line">                <span class="comment"># max_age=3 设置超时时间3秒</span></span><br><span class="line">            obj.set_cookie(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, max_age=<span class="number">3</span>)</span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@wrapper</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">order</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;我是order页面&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_cookie</span>(<span class="params">request</span>):</span></span><br><span class="line">    obj = HttpResponse(<span class="string">&#x27;删除name 这个cookie&#x27;</span>)</span><br><span class="line">    obj.delete_cookie(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>login.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container-fluid&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6 col-md-offset-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;text-center&quot;</span>&gt;</span>登陆页面<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>username</span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">id</span>=<span class="string">&quot;inp_name&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>password</span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;inp_password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text-center&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control btn btn-info&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a><strong>中间件</strong></h3><p><strong>process_request和process_response</strong></p>
<p><img src="/2020/08/23/python/877318-20180523153139864-2049371026.png" alt="python"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiddleWares</span>(<span class="params">MiddlewareMixin</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Md1请求&quot;</span>)</span><br><span class="line">        <span class="comment"># return HttpResponse(&#x27;Md1中断&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># process_request方法里面不写返回值，默认也是返回None，如果你自己写了return None，也是一样的效果，不会中断你的请求，但是如果你return 的一个httpresponse对象，那么就会在这个方法中断你的请求，直接返回给用户，这就成了非正常的流程了</span></span><br><span class="line"><span class="comment"># 并且，如果你在这里return了httpresponse对象，那么会从你这个中间件类中的process_response方法开始执行返回操作，所以这个类里面只要有process_response方法，肯定会执行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span>(<span class="params">self, request, response</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Md1返回&quot;</span>)</span><br><span class="line">        <span class="comment">#print(response.__dict__[&#x27;_container&#x27;][0].decode(&#x27;utf-8&#x27;)) #查看响应体里面的内容的方法，或者直接使用response.content也可以看到响应体里面的内容，由于response是个变量，直接点击看源码是看不到的，你打印type(response)发现是HttpResponse对象，查看这个对象的源码就知道有什么方法可以用了。</span></span><br><span class="line">　　　　 <span class="keyword">return</span> response  <span class="comment">#必须有返回值，写return response  ，这个response就像一个接力棒一样</span></span><br><span class="line">        <span class="comment">#return HttpResponse(&#x27;瞎搞&#x27;) ,如果你写了这个，那么你视图返回过来的内容就被它给替代了</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiddleWares1</span>(<span class="params">MiddlewareMixin</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Md2请求&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;Md2中断&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span>(<span class="params">self, request, response</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Md2返回&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    　　　　结果：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Md1请求</span></span><br><span class="line"><span class="string">Md2请求</span></span><br><span class="line"><span class="string">view函数...</span></span><br><span class="line"><span class="string">Md2返回</span></span><br><span class="line"><span class="string">Md1返回</span></span><br><span class="line"><span class="string">　　　　注意：如果当请求到达请求2的时候直接不符合条件返回，即return HttpResponse(&quot;Md2中断&quot;)，程序将把请求直接发给中间件2返回，然后依次返回到请求者，结果如下：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">　　　　返回Md2中断的页面，后台打印如下： </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Md1请求</span></span><br><span class="line"><span class="string">Md2请求</span></span><br><span class="line"><span class="string">Md2返回</span></span><br><span class="line"><span class="string">Md1返回</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<p><strong>process_view</strong></p>
<p><img src="/2020/08/23/python/877318-20180523150722556-373788290.png" alt="python"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">　　　　　　process_view(self, request, view_func, view_args, view_kwargs)</span><br><span class="line"></span><br><span class="line">　　　　　　该方法有四个参数</span><br><span class="line"></span><br><span class="line">　　　　　　request是HttpRequest对象。</span><br><span class="line"></span><br><span class="line">　　　　　　view_func是Django即将使用的视图函数。 （它是实际的函数对象，而不是函数的名称作为字符串。）</span><br><span class="line"></span><br><span class="line">　　　　　　view_args是将传递给视图的位置参数的列表.</span><br><span class="line"></span><br><span class="line">　　　　　　view_kwargs是将传递给视图的关键字参数的字典。 view_args和view_kwargs都不包含第一个视图参数（request）。</span><br><span class="line"></span><br><span class="line">　　　　　　Django会在调用视图函数之前调用process_view方法。</span><br><span class="line"></span><br><span class="line">　　　　　　它应该返回<span class="literal">None</span>或一个HttpResponse对象。 如果返回<span class="literal">None</span>，Django将继续处理这个请求，执行任何其他中间件的process_view方法，然后在执行相应的视图。 如果它返回一个HttpResponse对象，Django不会调用对应的视图函数。 它将执行中间件的process_response方法并将应用到该HttpResponse并返回结果。</span><br><span class="line">        </span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">MD1</span>(<span class="params">MiddlewareMixin</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;MD1里面的 process_request&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span>(<span class="params">self, request, response</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;MD1里面的 process_response&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_view</span>(<span class="params">self, request, view_func, view_args, view_kwargs</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">80</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;MD1 中的process_view&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(view_func, view_func.__name__) <span class="comment">#就是url映射到的那个视图函数，也就是说每个中间件的这个process_view已经提前拿到了要执行的那个视图函数</span></span><br><span class="line">        <span class="comment">#ret = view_func(request) #提前执行视图函数，不用到了上图的视图函数的位置再执行，如果你视图函数有参数的话，可以这么写 view_func(request,view_args,view_kwargs) </span></span><br><span class="line">        <span class="comment">#return ret  #直接就在MD1中间件这里这个类的process_response给返回了，就不会去找到视图函数里面的这个函数去执行了。</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="string">&#x27;&#x27;</span><span class="built_in">print</span>(view_func(request), view_func.__name__)<span class="string">&#x27;直接执行视图函数中的函数</span></span><br><span class="line"><span class="string">        Md1请求</span></span><br><span class="line"><span class="string">Md2请求</span></span><br><span class="line"><span class="string">--------------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">MD1 中的process_view</span></span><br><span class="line"><span class="string">我是order</span></span><br><span class="line"><span class="string">&lt;HttpResponse status_code=200, &quot;text/html; charset=utf-8&quot;&gt; order</span></span><br><span class="line"><span class="string">--------------------------------------------------------------------------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MD2</span>(<span class="params">MiddlewareMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;MD2里面的 process_request&quot;</span>)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span>(<span class="params">self, request, response</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;MD2里面的 process_response&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_view</span>(<span class="params">self, request, view_func, view_args, view_kwargs</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">80</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;MD2 中的process_view&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(view_func, view_func.__name__)</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      Md1请求</span></span><br><span class="line"><span class="string">Md2请求</span></span><br><span class="line"><span class="string">--------------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">MD1 中的process_view</span></span><br><span class="line"><span class="string">&lt;function order at 0x0000018F624699D0&gt; order</span></span><br><span class="line"><span class="string">--------------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">MD2 中的process_view</span></span><br><span class="line"><span class="string">&lt;function order at 0x0000018F624699D0&gt; order</span></span><br><span class="line"><span class="string">我是order</span></span><br><span class="line"><span class="string">Md2返回</span></span><br><span class="line"><span class="string">Md1返回</span></span><br><span class="line"><span class="string">[23/Oct/2020 22:00:17] &quot;GET /order/ HTTP/1.1&quot; 200 459</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        process_view方法是在process_request之后，reprocess_response之前，视图函数之前执行的，执行顺序按照MIDDLEWARE中的注册顺序从前到后顺序执行的</span><br></pre></td></tr></table></figure>

<h3 id="CSRF-TOKEN跨站请求伪造"><a href="#CSRF-TOKEN跨站请求伪造" class="headerlink" title="CSRF_TOKEN跨站请求伪造"></a><strong>CSRF_TOKEN跨站请求伪造</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">django解决了csrf攻击，中间件：django.middleware.csrf.CsrfViewMiddleware</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">4</span> 后期中间件不能注释，每次发送post请求，都需要携带csrf_token随机字符串</span><br><span class="line">	-form表单提交 </span><br><span class="line">    	-在form表单中 &#123;% csrf_token%&#125;</span><br><span class="line">        </span><br><span class="line">    -ajax提交（如何携带）</span><br><span class="line">    方式一：放到data中</span><br><span class="line">     $.ajax(&#123;</span><br><span class="line">            url: <span class="string">&#x27;/csrf_test/&#x27;</span>,</span><br><span class="line">            method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            data: &#123;<span class="string">&#x27;name&#x27;</span>: $(<span class="string">&#x27;[name=&quot;name&quot;]&#x27;</span>).val(),</span><br><span class="line">                <span class="string">&#x27;password&#x27;</span>: $(<span class="string">&#x27;[name=&quot;password&quot;]&#x27;</span>).val(),</span><br><span class="line">                <span class="string">&#x27;csrfmiddlewaretoken&#x27;</span>:$(<span class="string">&#x27;[name=&quot;csrfmiddlewaretoken&quot;]&#x27;</span>).val()</span><br><span class="line">            &#125;,</span><br><span class="line">            success: function (data) &#123;</span><br><span class="line">                console.log(<span class="string">&#x27;成功了&#x27;</span>)</span><br><span class="line">                console.log(data)</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            error: function (data) &#123;</span><br><span class="line">                console.log(<span class="string">&#x27;xxxxx&#x27;</span>)</span><br><span class="line">                console.log(data)</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        方式二：放到data中</span><br><span class="line">        <span class="string">&#x27;csrfmiddlewaretoken&#x27;</span>:<span class="string">&#x27;&#123;&#123; csrf_token &#125;&#125;&#x27;</span></span><br><span class="line">        方式三：放到头中</span><br><span class="line">        	headers:&#123;<span class="string">&#x27;X-CSRFToken&#x27;</span>:<span class="string">&#x27;&#123;&#123;csrf_token&#125;&#125;&#x27;</span>&#125;,</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"> <span class="comment"># jquery.cookie.js</span></span><br><span class="line">	-在浏览器中对cookie进行增，删，查，改</span><br><span class="line">    -前后端分离（js操作cookie）</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 全局使用，局部禁csrf</span></span><br><span class="line">	-在视图函数上加装饰器</span><br><span class="line">    <span class="keyword">from</span> django.views.decorators.csrf <span class="keyword">import</span> csrf_exempt,csrf_protect</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="meta">@csrf_exempt  </span><span class="comment"># 全局启用，局部禁用（中间件不能注释，这个视图函数，已经没有csrf校验了）</span></span><br><span class="line"><span class="meta">@csrf_protect  </span><span class="comment"># 全局禁用，局部使用csrf(中间件要注释，这个视图函数有csrf校验)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">csrf_test</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        name = request.POST.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(name)</span><br><span class="line">        <span class="built_in">print</span>(password)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;登录成功&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 古怪的使用方式，在urls.py中</span></span><br><span class="line">path(<span class="string">&#x27;csrf_test/&#x27;</span>, csrf_exempt(views.csrf_test))</span><br></pre></td></tr></table></figure>

<h3 id="auth-内置属性及方法"><a href="#auth-内置属性及方法" class="headerlink" title="auth 内置属性及方法"></a><strong>auth 内置属性及方法</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect, HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> auth</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models, myforms</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># def register(request):</span></span><br><span class="line"><span class="comment">#     if request.method == &#x27;GET&#x27;:</span></span><br><span class="line"><span class="comment">#         return render(request, &#x27;register.html&#x27;,)</span></span><br><span class="line"><span class="comment">#     else:</span></span><br><span class="line"><span class="comment">#         username = request.POST.get(&#x27;name&#x27;)</span></span><br><span class="line"><span class="comment">#         password = request.POST.get(&#x27;password&#x27;)</span></span><br><span class="line"><span class="comment">#         phone = request.POST.get(&#x27;phone&#x27;)</span></span><br><span class="line"><span class="comment">#         # 操作auth_user表写入数据</span></span><br><span class="line"><span class="comment">#         # User.objects.create(username=username, password=password) # 这种密码在表中没有加密</span></span><br><span class="line"><span class="comment">#         # User.objects.create_user(username=username, password=password)  # 创建普通用户</span></span><br><span class="line"><span class="comment">#         # User.objects.create_user(username=username, password=password)  # 创建普通用户</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         models.UserInfo.objects.create_user(username=username, password=password, phone=123)</span></span><br><span class="line"><span class="comment">#         return redirect(&#x27;/login/&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 加上验证</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        form = myforms.Reg()</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;register.html&#x27;</span>, &#123;<span class="string">&#x27;form&#x27;</span>: form&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = myforms.Reg(request.POST)</span><br><span class="line">        data = &#123;<span class="string">&#x27;status&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            username = form.cleaned_data.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">            password = form.cleaned_data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">            phone = form.cleaned_data.get(<span class="string">&#x27;phone&#x27;</span>)</span><br><span class="line">            models.UserInfo.objects.create_user(username=username, password=password, phone=phone)</span><br><span class="line">            data[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;/login/&quot;</span></span><br><span class="line">            <span class="keyword">return</span> JsonResponse(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># print(form.errors)</span></span><br><span class="line">            <span class="comment"># print(&#x27;=&#x27; * 100)</span></span><br><span class="line">            data[<span class="string">&#x27;status&#x27;</span>] = <span class="number">0</span></span><br><span class="line">            data[<span class="string">&#x27;msg&#x27;</span>] = form.errors</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="comment"># 去用户表校验数据</span></span><br><span class="line">        <span class="comment"># 1 表如何获取</span></span><br><span class="line">        <span class="comment"># 2 密码如何比对</span></span><br><span class="line">        user_obj = auth.authenticate(request, username=username, password=password)</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        1.自动查找auth_user表</span></span><br><span class="line"><span class="string">        2.自动给密码加密再比对</span></span><br><span class="line"><span class="string">        该方法注意事项</span></span><br><span class="line"><span class="string">            括号内必须同时传入用户名和密码</span></span><br><span class="line"><span class="string">            # auth_user 表中用户名字段是username        </span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># print(user_obj)  # 获得用户对象</span></span><br><span class="line">        <span class="comment"># print(user_obj.username)  # 获得用户对象</span></span><br><span class="line">        <span class="comment"># print(user_obj.password)  # 获得用户对象</span></span><br><span class="line">        <span class="comment">## 获取到下次要跳转的页面</span></span><br><span class="line">        url = request.GET.get(<span class="string">&#x27;next&#x27;</span>)</span><br><span class="line">        <span class="comment">## 判断当前用户是否存在</span></span><br><span class="line">        <span class="keyword">if</span> user_obj:</span><br><span class="line">            <span class="keyword">if</span> url:</span><br><span class="line">                <span class="comment"># 保存用户状态</span></span><br><span class="line">                auth.login(request, user_obj)  <span class="comment">## 类似于 request.session[key] = user_obj</span></span><br><span class="line">                <span class="keyword">return</span> redirect(url)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">&#x27;/home/&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;当前用户不存在&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    auth.logout(request)  <span class="comment"># 类似于request.session.flush()</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/login/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="comment">## 修改密码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_password</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        old_password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        new_password = request.POST.get(<span class="string">&#x27;new_password&#x27;</span>)</span><br><span class="line">        re_password = request.POST.get(<span class="string">&#x27;re_password&#x27;</span>)</span><br><span class="line">        <span class="comment"># 先校验两次密码是否一致</span></span><br><span class="line">        <span class="keyword">if</span> new_password == re_password:</span><br><span class="line">            <span class="comment"># 校验老密码对不对</span></span><br><span class="line">            is_right = request.user.check_password(old_password)</span><br><span class="line">            <span class="keyword">if</span> is_right:</span><br><span class="line">                <span class="comment"># 修改密码</span></span><br><span class="line">                request.user.set_password(new_password)  <span class="comment"># 修改对象的属性</span></span><br><span class="line">                request.user.save()  <span class="comment"># 保存到数据库</span></span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login/&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;set_password.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">局部和全局</span></span><br><span class="line"><span class="string">局部 &gt; 全局</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required(<span class="params">login_url=<span class="string">&#x27;/login/&#x27;</span></span>)  </span><span class="comment"># 局部配置，用户没有登录跳转到登陆页面</span></span><br><span class="line"><span class="comment"># @login_required  # 全局</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;用户登录才能看到首页&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(request.user)  <span class="comment"># 获取当前登录对象,自动去django_session表中查找相对应的用户对象给你封装到request.user中</span></span><br><span class="line">    <span class="comment"># print(request.user.is_authenticated())  # 判断用户是否登录</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;home页面&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>models.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User, AbstractUser</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 扩展表，面向对象的继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span>(<span class="params">AbstractUser</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    如果继承了AbstractUser</span></span><br><span class="line"><span class="string">    再执行数据库迁移的时候auth_user就不会创建出来了</span></span><br><span class="line"><span class="string">    而UserInfo表中会出现auth_user中所有的字段外加自己扩展的字段</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    前提</span></span><br><span class="line"><span class="string">        1.再继承之前没有执行过数据库迁移命令</span></span><br><span class="line"><span class="string">        2.继承的类里面不能覆盖AbstractUser里面的字段名</span></span><br><span class="line"><span class="string">        3，需要再配置文件中告诉django你要用UserInfo替代auth_user</span></span><br><span class="line"><span class="string">            AUTH_USER_MODEL = &#x27;app01.UserInfo&#x27;</span></span><br><span class="line"><span class="string">                                &#x27;应用名.表名&#x27;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    phone = models.BigIntegerField()</span><br><span class="line">    create_time = models.DateField(auto_now_add=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Signal-Redis-Websocket"><a href="#Signal-Redis-Websocket" class="headerlink" title="Signal+Redis+Websocket"></a>Signal+Redis+Websocket</h3><p><img src="/2020/08/23/python/image-20220504163012406.png" alt="python"></p>
<p>models.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoengine</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">mongoengine.connect(<span class="string">&quot;fs&quot;</span>, host=<span class="string">&quot;127.0.0.1&quot;</span>, port=<span class="number">27017</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlgorithmSliceModel</span>(<span class="params">mongoengine.Document</span>):</span></span><br><span class="line">    meta = &#123;</span><br><span class="line">        <span class="string">&quot;collection&quot;</span>: <span class="string">&quot;video&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ordering&quot;</span>: [<span class="string">&#x27;-id&#x27;</span>],</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">id</span> = mongoengine.SequenceField(required=<span class="literal">True</span>, primary_key=<span class="literal">True</span>)</span><br><span class="line">    algorithm = mongoengine.StringField(required=<span class="literal">True</span>)</span><br><span class="line">    filename = mongoengine.StringField(max_length=<span class="number">150</span>, required=<span class="literal">True</span>)</span><br><span class="line">    event_started = mongoengine.DateTimeField(default=datetime.datetime.now)</span><br><span class="line">    event_started_addr = mongoengine.StringField(required=<span class="literal">True</span>)</span><br><span class="line">    event_addr_type = mongoengine.StringField(required=<span class="literal">True</span>)</span><br><span class="line">    event_name = mongoengine.StringField(required=<span class="literal">True</span>, max_length=<span class="number">50</span>)</span><br><span class="line">    slice_video = mongoengine.FileField(required=<span class="literal">False</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>signal.py</p>
<ul>
<li>定义信号在数据存入库之后触发该信号，将事件信息发布到redis中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django_redis <span class="keyword">import</span> get_redis_connection</span><br><span class="line"><span class="keyword">from</span> mongoengine <span class="keyword">import</span> signals</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> AlgorithmSliceModel</span><br><span class="line"><span class="keyword">from</span> django.dispatch <span class="keyword">import</span> receiver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@receiver(<span class="params">signals.post_save, sender=AlgorithmSliceModel</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">publish_event</span>(<span class="params">sender, created, **kwargs</span>):</span></span><br><span class="line">    <span class="keyword">if</span> created:</span><br><span class="line">        document = kwargs[<span class="string">&#x27;document&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;New model created!&quot;</span>)</span><br><span class="line">        event = &#123; </span><br><span class="line">            <span class="string">&quot;filename&quot;</span>: <span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(document.filename)</span><br><span class="line">        &#125;</span><br><span class="line">        connection = get_redis_connection(<span class="string">&quot;default&quot;</span>)</span><br><span class="line">        payload = json.dumps(event)</span><br><span class="line">        connection.publish(<span class="string">&quot;events&quot;</span>, payload)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>apps.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.apps <span class="keyword">import</span> AppConfig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServiceConfig</span>(<span class="params">AppConfig</span>):</span></span><br><span class="line">    name = <span class="string">&#x27;service&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ready</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">import</span> service.signals</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>settings.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">&quot;default&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;BACKEND&quot;</span>: <span class="string">&quot;django_redis.cache.RedisCache&quot;</span>,</span><br><span class="line">        <span class="string">&quot;LOCATION&quot;</span>: <span class="string">&quot;redis://192.168.17.6:6379/1&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>websocket</p>
<ul>
<li>开启一个websocket服务端连接，订阅redis中事件消息推送</li>
</ul>
<p>server.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> websockets</span><br><span class="line"><span class="keyword">import</span> aioredis</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;websockets&#x27;</span>)</span><br><span class="line">logging.basicConfig(</span><br><span class="line">    <span class="built_in">format</span>=<span class="string">&quot;%(asctime)s %(message)s&quot;</span>,</span><br><span class="line">    level=logging.DEBUG,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">USERS = <span class="built_in">set</span>()</span><br><span class="line">EVENT = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户数量事件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">users_event</span>():</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps(&#123;<span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;users&#x27;</span>, <span class="string">&#x27;count&#x27;</span>: <span class="built_in">len</span>(USERS)&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">state_event</span>():</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps(&#123;<span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;model_value_event&#x27;</span>, **EVENT&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">handler</span>(<span class="params">websocket</span>):</span></span><br><span class="line">    <span class="keyword">global</span> USERS</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        USERS.add(websocket)</span><br><span class="line">        websockets.broadcast(USERS, users_event())</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">for</span> message <span class="keyword">in</span> websocket:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> websockets.ConnectionClosedOK:</span><br><span class="line">        logger.info(<span class="string">&#x27;websocket client closed!&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> websockets.ConnectionClosedError <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">&#x27;websocket closed error: &#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(e))</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        USERS.remove(websocket)</span><br><span class="line">        websockets.broadcast(USERS, users_event())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">process_events</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Listen to events in Redis and process them.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">global</span> EVENT</span><br><span class="line">    redis = aioredis.from_url(<span class="string">&quot;redis://192.168.17.6:6379/1&quot;</span>)</span><br><span class="line">    pubsub = redis.pubsub()</span><br><span class="line">    <span class="keyword">await</span> pubsub.subscribe(<span class="string">&quot;events&quot;</span>)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">for</span> message <span class="keyword">in</span> pubsub.listen():</span><br><span class="line">        <span class="keyword">if</span> message[<span class="string">&quot;type&quot;</span>] != <span class="string">&quot;message&quot;</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        payload = message[<span class="string">&quot;data&quot;</span>].decode()</span><br><span class="line">        event = json.loads(payload)</span><br><span class="line">        EVENT = event</span><br><span class="line">        websockets.broadcast(USERS, state_event())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> websockets.serve(handler, <span class="string">&quot;localhost&quot;</span>, <span class="number">8888</span>):</span><br><span class="line">        <span class="keyword">await</span> process_events()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    asyncio.run(main())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="DjangoRestFramework"><a href="#DjangoRestFramework" class="headerlink" title="DjangoRestFramework"></a>DjangoRestFramework</h2><p><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/exceptions/">https://www.django-rest-framework.org/api-guide/exceptions/</a></p>
<h3 id="restful规范"><a href="#restful规范" class="headerlink" title="restful规范"></a><strong>restful规范</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> Representational State Transfer:表征性状态转移</span><br><span class="line"><span class="number">2</span> Web API接口的设计风格，尤其适用于前后端分离的应用模式中</span><br><span class="line"><span class="number">3</span> 与语言，平台无关，任何框架都可以写出符合restful规范的api接口</span><br><span class="line"><span class="number">4</span> 规范：<span class="number">10</span>条</span><br><span class="line">	-<span class="number">1</span>  数据的安全保障：url链接一般都采用https协议进行传输</span><br><span class="line">    -<span class="number">2</span>  接口特征表现：api关键字标识</span><br><span class="line">    	-https://api.baidu.com/books/</span><br><span class="line">        -https://www.baidu.com/api/books/</span><br><span class="line">    -<span class="number">3</span> 多版本共存：url链接中标识接口版本</span><br><span class="line">    	-https://api.baidu.com/v1/books/</span><br><span class="line">		-https://api.baidu.com/v2/books/</span><br><span class="line">    -<span class="number">4</span> 数据即是资源，均使用名词（可复数）***********</span><br><span class="line">    	-接口一般都是完成前后台数据的交互，交互的数据我们称之为资源</span><br><span class="line">        -一般提倡用资源的复数形式,不要使用动词</span><br><span class="line">        -查询所有图书</span><br><span class="line">        	-https://api.baidu.com/books/</span><br><span class="line">            -https://api.baidu.com/get_all_books/ <span class="comment"># 错误示范</span></span><br><span class="line">            -https://api.baidu.com/delete-user    <span class="comment"># 错误的示范</span></span><br><span class="line">            -https://api.baidu.com/user           <span class="comment"># 删除用户的示例：疑问：到底是删还是查？</span></span><br><span class="line">                </span><br><span class="line">   -<span class="number">5</span> 资源操作由请求方式决定：</span><br><span class="line">		https://api.baidu.com/books       - get请求：获取所有书</span><br><span class="line">        https://api.baidu.com/books/<span class="number">1</span>     - get请求：获取主键为<span class="number">1</span>的书</span><br><span class="line">        https://api.baidu.com/books       - post请求：新增一本书书</span><br><span class="line">        https://api.baidu.com/books/<span class="number">1</span>     - put请求：整体修改主键为<span class="number">1</span>的书</span><br><span class="line">        https://api.baidu.com/books/<span class="number">1</span>     - patch请求：局部修改主键为<span class="number">1</span>的书</span><br><span class="line">        https://api.baidu.com/books/<span class="number">1</span>     - delete请求：删除主键为<span class="number">1</span>的书</span><br><span class="line">            </span><br><span class="line">   -<span class="number">6</span> 过滤，通过在url上传参的形式传递搜索条件</span><br><span class="line">        https://api.example.com/v1/zoos?limit=<span class="number">10</span>         ：指定返回记录的数量</span><br><span class="line">        https://api.example.com/v1/zoos?offset=<span class="number">10</span>&amp;limit=<span class="number">3</span>：指定返回记录的开始位置</span><br><span class="line">        https://api.example.com/v1/zoos?page=<span class="number">2</span>&amp;per_page=<span class="number">100</span>：指定第几页，以及每页的记录数</span><br><span class="line">        https://api.example.com/v1/zoos?sortby=name&amp;order=asc：指定返回结果按照哪个属性排序，以及排序顺序</span><br><span class="line">        https://api.example.com/v1/zoos?animal_type_id=<span class="number">1</span>：指定筛选条件</span><br><span class="line">            </span><br><span class="line">   -<span class="number">7</span>  响应状态码</span><br><span class="line">		-返回数据中带状态码</span><br><span class="line">		-&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>&#125;</span><br><span class="line">   -<span class="number">8</span> 返回结果中带错误信息</span><br><span class="line">		-&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>,<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;因为xx原因失败&#x27;</span>&#125;</span><br><span class="line">   -<span class="number">9</span> 返回结果，该符合以下规范</span><br><span class="line">		GET /collection：返回资源对象的列表（数组）</span><br><span class="line">        GET /collection/resource：返回单个资源对象（字典）</span><br><span class="line">        POST /collection：返回新生成的资源对象    （新增后的对象字典）</span><br><span class="line">        PUT /collection/resource：返回完整的资源对象 （修改后的对象字典）</span><br><span class="line">        PATCH /collection/resource：返回完整的资源对象 （修改后的对象字典）</span><br><span class="line">        DELETE /collection/resource：返回一个空文档   （）</span><br><span class="line">        </span><br><span class="line">   -<span class="number">10</span> 返回的数据中带链接地址</span><br><span class="line">		-查询<span class="built_in">id</span>为<span class="number">1</span>的图书接口，返回结果示例</span><br><span class="line">    	&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>,</span><br><span class="line">         <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;成功&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;result&#x27;</span>:</span><br><span class="line">             &#123;<span class="string">&#x27;title&#x27;</span>:<span class="string">&#x27;金瓶梅&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;price&#x27;</span>:<span class="number">12.3</span>,</span><br><span class="line">              <span class="string">&#x27;publish&#x27;</span>:<span class="string">&#x27;https://127.0.0.1/api/v1/publish/3&#x27;</span></span><br><span class="line">             &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h3 id="APIView源码分析"><a href="#APIView源码分析" class="headerlink" title="APIView源码分析"></a>APIView源码分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> APIview的as_view</span><br><span class="line">	-内部还是执行了View的闭包函数view</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">as_view</span>(<span class="params">cls, **initkwargs</span>):</span></span><br><span class="line">        view = <span class="built_in">super</span>().as_view(**initkwargs)</span><br><span class="line">        view.cls = cls</span><br><span class="line">        view.initkwargs = initkwargs</span><br><span class="line">        <span class="keyword">return</span> csrf_exempt(view)  -禁用掉了csrf</span><br><span class="line"><span class="number">2</span> 原生View类中过的as_view中的闭包函数view</span><br><span class="line">	-本质执行了self.dispatch(request, *args, **kwargs)，执行的是APIView的dispatch</span><br><span class="line"><span class="number">3</span> APIView的dispatch</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># DRF的Request类的对象，内部有request._request,是原生request</span></span><br><span class="line">        request = self.initialize_request(request, *args, **kwargs)</span><br><span class="line">        self.request = request</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 三大认证模块(APIView下的initial)</span></span><br><span class="line">            self.initial(request, *args, **kwargs)</span><br><span class="line">            <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            #认证，权限，频率</span></span><br><span class="line"><span class="string">            self.perform_authentication(request)</span></span><br><span class="line"><span class="string">        	self.check_permissions(request)</span></span><br><span class="line"><span class="string">        	self.check_throttles(request)</span></span><br><span class="line"><span class="string">            &#x27;&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> request.method.lower() <span class="keyword">in</span> self.http_method_names:</span><br><span class="line">                handler = <span class="built_in">getattr</span>(self, request.method.lower(),</span><br><span class="line">                                  self.http_method_not_allowed)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                handler = self.http_method_not_allowed</span><br><span class="line"></span><br><span class="line">            response = handler(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> exc:</span><br><span class="line">            <span class="comment"># 全局的异常捕获</span></span><br><span class="line">            response = self.handle_exception(exc)</span><br><span class="line">		<span class="comment"># 把视图函数(类)返回的response，又包装了一下</span></span><br><span class="line">        self.response = self.finalize_response(request, response, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> self.response</span><br></pre></td></tr></table></figure>




    </div>

    
    
    
	  
	  
		   <div>
			 <div>
    
        <div style="text-align:center;color: #ccc;font-size:20px;">-------------End-------------</div>
    
</div>
		   </div>
	   

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/python/" rel="tag"># python</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/08/20/MySQL/" rel="prev" title="Mysql">
      <i class="fa fa-chevron-left"></i> Mysql
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/09/17/HTML/" rel="next" title="">
       <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#python"><span class="nav-number">1.</span> <span class="nav-text">python</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%98%9F%E5%88%97%E4%B8%8E%E5%A0%86%E6%A0%88"><span class="nav-number">1.1.</span> <span class="nav-text">队列与堆栈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%B6%E6%8E%92%E5%BA%8F"><span class="nav-number">1.2.</span> <span class="nav-text">桶排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97"><span class="nav-number">1.3.</span> <span class="nav-text">斐波那契数列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F"><span class="nav-number">1.4.</span> <span class="nav-text">冒泡排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E6%8E%92"><span class="nav-number">1.5.</span> <span class="nav-text">快排</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90"><span class="nav-number">1.6.</span> <span class="nav-text">排序算法分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E5%85%83%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">1.7.</span> <span class="nav-text">三元表达式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%97%E8%A1%A8%E6%8E%A8%E5%AF%BC%E5%BC%8F"><span class="nav-number">1.8.</span> <span class="nav-text">列表推导式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">1.9.</span> <span class="nav-text">生成器表达式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">1.10.</span> <span class="nav-text">迭代器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%92%E5%BD%92"><span class="nav-number">1.11.</span> <span class="nav-text">递归</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E5%88%86%E6%B3%95"><span class="nav-number">1.12.</span> <span class="nav-text">二分法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0"><span class="nav-number">1.13.</span> <span class="nav-text">匿名函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AD%E5%8C%85"><span class="nav-number">1.14.</span> <span class="nav-text">闭包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="nav-number">1.15.</span> <span class="nav-text">装饰器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E6%97%B6%E5%99%A8%E4%BD%BF%E7%94%A8%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="nav-number">1.16.</span> <span class="nav-text">计时器使用之装饰器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%89%E5%8F%82%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="nav-number">1.17.</span> <span class="nav-text">有参装饰器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="nav-number">1.18.</span> <span class="nav-text">常用模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8C%B4%E5%AD%90%E8%A1%A5%E4%B8%81"><span class="nav-number">1.19.</span> <span class="nav-text">猴子补丁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8D%95%E4%BE%8B%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="nav-number">1.20.</span> <span class="nav-text">实现单例的几种方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%E9%98%BB%E5%A1%9E%E9%9D%9E%E9%98%BB%E5%A1%9E"><span class="nav-number">1.21.</span> <span class="nav-text">同步异步阻塞非阻塞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#requests%E6%A8%A1%E5%9D%97%E6%A8%A1%E6%8B%9F%E4%B8%8B%E5%8F%91form-data%E6%95%B0%E6%8D%AE"><span class="nav-number">1.22.</span> <span class="nav-text">requests模块模拟下发form&#x2F;data数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="nav-number">1.23.</span> <span class="nav-text">虚拟环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#linux%E5%AE%89%E8%A3%85%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="nav-number">1.24.</span> <span class="nav-text">linux安装虚拟环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mq%E4%BD%BF%E7%94%A8json%E4%BC%A0%E8%BE%93%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%9A%84%E6%96%B9%E6%A1%88"><span class="nav-number">1.25.</span> <span class="nav-text">mq使用json传输二进制的方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B9%8B-s"><span class="nav-number">1.26.</span> <span class="nav-text">python格式化字符串之%()s</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3Linux-pip%E6%8A%A5%E9%94%99"><span class="nav-number">1.27.</span> <span class="nav-text">解决Linux pip报错</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#windows-%E7%BB%88%E6%AD%A2%E6%9F%90%E8%BF%9B%E7%A8%8B"><span class="nav-number">1.28.</span> <span class="nav-text">windows 终止某进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Django"><span class="nav-number">1.29.</span> <span class="nav-text">Django</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#http%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.29.1.</span> <span class="nav-text">http协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8Ewsgiref%E5%86%99%E4%B8%80%E4%B8%AAweb%E6%A1%86%E6%9E%B6"><span class="nav-number">1.29.2.</span> <span class="nav-text">基于wsgiref写一个web框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95%E4%B9%8Bfor%E5%BE%AA%E7%8E%AF"><span class="nav-number">1.29.3.</span> <span class="nav-text">模板语法之for循环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python%E4%B8%89%E5%A4%A7%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6"><span class="nav-number">1.29.4.</span> <span class="nav-text">python三大主流框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#django%E7%9B%AE%E5%BD%95%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.29.5.</span> <span class="nav-text">django目录介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MTV%E4%B8%8EMVC"><span class="nav-number">1.29.6.</span> <span class="nav-text">MTV与MVC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#django%E4%B8%ADorm%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.29.7.</span> <span class="nav-text">django中orm的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#diango%E8%BF%9E%E6%8E%A5mysql"><span class="nav-number">1.29.8.</span> <span class="nav-text">diango连接mysql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Django%E8%AF%B7%E6%B1%82%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">1.29.9.</span> <span class="nav-text">Django请求生命周期流程图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">1.29.10.</span> <span class="nav-text">路由匹配注意事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%89%E5%90%8D%E5%88%86%E7%BB%84-%E6%97%A0%E5%90%8D%E5%88%86%E7%BB%84"><span class="nav-number">1.29.11.</span> <span class="nav-text">有名分组 无名分组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90"><span class="nav-number">1.29.12.</span> <span class="nav-text">反向解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%90%8D%E6%9C%89%E5%90%8D%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90"><span class="nav-number">1.29.13.</span> <span class="nav-text">无名有名反向解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91"><span class="nav-number">1.29.14.</span> <span class="nav-text">路由分发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#render%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86"><span class="nav-number">1.29.15.</span> <span class="nav-text">render内部原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JsonResponse"><span class="nav-number">1.29.16.</span> <span class="nav-text">JsonResponse</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">1.29.17.</span> <span class="nav-text">文件上传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cbv%E5%92%8Cfbv"><span class="nav-number">1.29.18.</span> <span class="nav-text">cbv和fbv</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E7%9A%84%E7%BB%A7%E6%89%BF%E5%92%8C%E5%AF%BC%E5%85%A5"><span class="nav-number">1.29.19.</span> <span class="nav-text">模板的继承和导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ORM"><span class="nav-number">1.29.20.</span> <span class="nav-text">ORM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E8%AE%B0%E5%BD%95API"><span class="nav-number">1.29.21.</span> <span class="nav-text">查询表记录API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E6%A8%A1%E5%9E%8B%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.29.22.</span> <span class="nav-text">表模型多表查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E7%9A%84%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.29.23.</span> <span class="nav-text">双下划线的模糊查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.29.24.</span> <span class="nav-text">聚合查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.29.25.</span> <span class="nav-text">分组查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#F%E5%92%8CQ%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.29.26.</span> <span class="nav-text">F和Q查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%93%E5%8D%B0%E5%8E%9F%E7%94%9Fsql"><span class="nav-number">1.29.27.</span> <span class="nav-text">打印原生sql</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Django%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="nav-number">1.29.27.1.</span> <span class="nav-text">Django日志配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-number">1.29.28.</span> <span class="nav-text">事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#forms%E7%BB%84%E4%BB%B6"><span class="nav-number">1.29.29.</span> <span class="nav-text">forms组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#django%E4%B8%ADcookie%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.29.30.</span> <span class="nav-text">django中cookie的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cookie-session-token"><span class="nav-number">1.29.31.</span> <span class="nav-text">cookie session token</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cookie%E7%89%88%E7%99%BB%E9%99%86%E6%A0%A1%E9%AA%8C"><span class="nav-number">1.29.32.</span> <span class="nav-text">cookie版登陆校验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.29.33.</span> <span class="nav-text">中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF-TOKEN%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0"><span class="nav-number">1.29.34.</span> <span class="nav-text">CSRF_TOKEN跨站请求伪造</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#auth-%E5%86%85%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%8F%8A%E6%96%B9%E6%B3%95"><span class="nav-number">1.29.35.</span> <span class="nav-text">auth 内置属性及方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Signal-Redis-Websocket"><span class="nav-number">1.29.36.</span> <span class="nav-text">Signal+Redis+Websocket</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DjangoRestFramework"><span class="nav-number">1.30.</span> <span class="nav-text">DjangoRestFramework</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#restful%E8%A7%84%E8%8C%83"><span class="nav-number">1.30.1.</span> <span class="nav-text">restful规范</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#APIView%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">1.30.2.</span> <span class="nav-text">APIView源码分析</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Admin"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Admin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021-07 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Admin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>







    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 


<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共151.4k字</span>
</div>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
