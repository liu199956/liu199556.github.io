<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="luffy项目配置1.配置pip源123456789101112131415161718192021222324&quot;&quot;&quot;1、采用国内源，加速下载模块的速度2、常用pip源：	-- 豆瓣：https:&#x2F;&#x2F;pypi.douban.com&#x2F;simple	-- 阿里：https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;pypi&#x2F;simple3、加速安装的命令：	-- &gt;">
<meta property="og:type" content="article">
<meta property="og:title" content="luffy">
<meta property="og:url" content="http://example.com/2020/12/10/luffy/index.html">
<meta property="og:site_name" content="Admin">
<meta property="og:description" content="luffy项目配置1.配置pip源123456789101112131415161718192021222324&quot;&quot;&quot;1、采用国内源，加速下载模块的速度2、常用pip源：	-- 豆瓣：https:&#x2F;&#x2F;pypi.douban.com&#x2F;simple	-- 阿里：https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;pypi&#x2F;simple3、加速安装的命令：	-- &gt;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggqvoob9gbj30lr0dlab0.jpg">
<meta property="og:image" content="c:/Users/%E5%88%98%E4%B8%80/AppData/Roaming/Typora/typora-user-images/image-20201224184543367.png">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggqvtp3d2zj310v0bmq3h.jpg">
<meta property="og:image" content="c:/Users/%E5%88%98%E4%B8%80/AppData/Roaming/Typora/typora-user-images/image-20210106203412932.png">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://img2018.cnblogs.com/blog/1350514/201810/1350514-20181022175533950-849327963.png">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://img2018.cnblogs.com/blog/1350514/201810/1350514-20181022195454464-123231904.png">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://img2018.cnblogs.com/blog/1350514/201810/1350514-20181022211822785-370585666.png">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="c:/Users/%E5%88%98%E4%B8%80/AppData/Roaming/Typora/typora-user-images/image-20210301211021206.png">
<meta property="article:published_time" content="2020-12-10T02:58:27.000Z">
<meta property="article:modified_time" content="2022-05-25T03:03:15.959Z">
<meta property="article:author" content="Admin">
<meta property="article:tag" content="luffy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggqvoob9gbj30lr0dlab0.jpg">

<link rel="canonical" href="http://example.com/2020/12/10/luffy/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>luffy | Admin</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Admin" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
	
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Admin</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/10/luffy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Admin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Admin">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          luffy
        </h1>

        <div class="post-meta">
		<!-- 设置置顶标志 -->
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-10 10:58:27" itemprop="dateCreated datePublished" datetime="2020-12-10T10:58:27+08:00">2020-12-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-25 11:03:15" itemprop="dateModified" datetime="2022-05-25T11:03:15+08:00">2022-05-25</time>
              </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="luffy"><a href="#luffy" class="headerlink" title="luffy"></a>luffy</h1><h2 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h2><h3 id="1-配置pip源"><a href="#1-配置pip源" class="headerlink" title="1.配置pip源"></a>1.配置pip源</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1、采用国内源，加速下载模块的速度</span></span><br><span class="line"><span class="string">2、常用pip源：</span></span><br><span class="line"><span class="string">	-- 豆瓣：https://pypi.douban.com/simple</span></span><br><span class="line"><span class="string">	-- 阿里：https://mirrors.aliyun.com/pypi/simple</span></span><br><span class="line"><span class="string">3、加速安装的命令：</span></span><br><span class="line"><span class="string">	-- &gt;: pip install -i https://pypi.douban.com/simple 模块名</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">永久配置安装源</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1、文件管理器文件路径地址栏敲：%APPDATA% 回车，快速进入 C:\Users\电脑用户\AppData\Roaming 文件夹中</span></span><br><span class="line"><span class="string">2、新建 pip 文件夹并在文件夹中新建 pip.ini 配置文件</span></span><br><span class="line"><span class="string">3、新增 pip.ini 配置文件内容</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">配置文件内容</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[global]</span></span><br><span class="line"><span class="string">index-url = http://pypi.douban.com/simple</span></span><br><span class="line"><span class="string">[install]</span></span><br><span class="line"><span class="string">use-mirrors =true</span></span><br><span class="line"><span class="string">mirrors =http://pypi.douban.com/simple/</span></span><br><span class="line"><span class="string">trusted-host =pypi.douban.com</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-配置虚拟环境"><a href="#2-配置虚拟环境" class="headerlink" title="2.配置虚拟环境"></a>2.配置虚拟环境</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建议使用pip3安装到python3环境下</span></span><br><span class="line">pip3 install virtualenv</span><br><span class="line">pip3 install virtualenvwrapper-win</span><br><span class="line">配置虚拟环境管理器工作目录</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置环境变量：</span></span><br><span class="line"><span class="comment"># 控制面板 =&gt; 系统和安全 =&gt; 系统 =&gt; 高级系统设置 =&gt; 环境变量 =&gt; 系统变量 =&gt; 点击新建 =&gt; 填入变量名与值</span></span><br><span class="line">变量名：WORKON_HOME  变量值：自定义存放虚拟环境的绝对路径</span><br><span class="line">eg: WORKON_HOME: D:\Virtualenvs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步配置信息：</span></span><br><span class="line"><span class="comment"># 去向Python3的安装目录 =&gt; Scripts文件夹 =&gt; virtualenvwrapper.bat =&gt; 双击</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="comment"># 在终端工作的命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1、创建虚拟环境到配置的WORKON_HOME路径下</span></span><br><span class="line"><span class="comment"># 选取默认Python环境创建虚拟环境：</span></span><br><span class="line">	-- mkvirtualenv 虚拟环境名称</span><br><span class="line"><span class="comment"># 基于某Python环境创建虚拟环境：</span></span><br><span class="line">	-- mkvirtualenv -p python2<span class="number">.7</span> 虚拟环境名称</span><br><span class="line">	-- mkvirtualenv -p python3<span class="number">.6</span> 虚拟环境名称</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、查看已有的虚拟环境</span></span><br><span class="line">	-- workon</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、使用某个虚拟环境</span></span><br><span class="line">	-- workon 虚拟环境名称</span><br><span class="line">	</span><br><span class="line"><span class="comment"># 4、进入|退出 该虚拟环境的Python环境</span></span><br><span class="line">	-- python | exit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、为虚拟环境安装模块</span></span><br><span class="line">	-- pip或pip3 install 模块名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、退出当前虚拟环境</span></span><br><span class="line">	-- deactivate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7、删除虚拟环境(删除当前虚拟环境要先退出)</span></span><br><span class="line">	-- rmvirtualenv 虚拟环境名称</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggqvoob9gbj30lr0dlab0.jpg" alt="img"></p>
<h3 id="3-后台配置"><a href="#3-后台配置" class="headerlink" title="3.后台配置"></a>3.后台配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后台：Django项目创建</span></span><br><span class="line"><span class="comment"># 1.环境</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">为luffy项目创建一个虚拟环境</span></span><br><span class="line"><span class="string">&gt;: mkvirtualenv luffy</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># 2.按照基础环境依赖</span></span><br><span class="line"><span class="string">&gt;: pip install django==2.0.7</span></span><br><span class="line"><span class="string">&gt;: pip install djangorestframework</span></span><br><span class="line"><span class="string">&gt;: pip install pymysql</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.创建项目</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">前提：在目标目录新建luffy文件夹</span></span><br><span class="line"><span class="string">&gt;: cd 建立的luffy文件夹</span></span><br><span class="line"><span class="string">&gt;: django-admin startproject luffyapi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">开发：用pycharm打开项目，并选择提前备好的虚拟环境</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#重构项目目录</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">├── luffyapi</span></span><br><span class="line"><span class="string">	├── logs/				# 项目运行时/开发时日志目录 - 包</span></span><br><span class="line"><span class="string">    ├── manage.py			# 脚本文件</span></span><br><span class="line"><span class="string">    ├── luffyapi/      		# 项目主应用，开发时的代码保存 - 包</span></span><br><span class="line"><span class="string">     	├── apps/      		# 开发者的代码保存目录，以模块[子应用]为目录保存 - 包</span></span><br><span class="line"><span class="string">        ├── libs/      		# 第三方类库的保存目录[第三方组件、模块] - 包</span></span><br><span class="line"><span class="string">    	├── settings/  		# 配置目录 - 包</span></span><br><span class="line"><span class="string">			├── dev.py   	# 项目开发时的本地配置</span></span><br><span class="line"><span class="string">			└── prod.py  	# 项目上线时的运行配置</span></span><br><span class="line"><span class="string">		├── urls.py    		# 总路由</span></span><br><span class="line"><span class="string">		└── utils/     		# 多个模块[子应用]的公共函数类库[自己开发的组件]</span></span><br><span class="line"><span class="string">    └── scripts/       		# 保存项目运营时的脚本文件 - 文件夹</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.配置开发环境</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1.修改 wsgi.py 与 manage.py 两个文件：</span></span><br><span class="line"><span class="string"># manage.py</span></span><br><span class="line"><span class="string">os.environ.setdefault(&#x27;DJANGO_SETTINGS_MODULE&#x27;, &#x27;luffyapi.settings.dev&#x27;)</span></span><br><span class="line"><span class="string"># wsgi.py</span></span><br><span class="line"><span class="string">os.environ.setdefault(&#x27;DJANGO_SETTINGS_MODULE&#x27;, &#x27;luffyapi.settings.prod&#x27;)</span></span><br><span class="line"><span class="string"># manage_prod.py</span></span><br><span class="line"><span class="string">os.environ.setdefault(&#x27;DJANGO_SETTINGS_MODULE&#x27;, &#x27;luffyapi.settings.prod&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2.将settings.py删除或改名，内容拷贝到settings/dev.py中</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3.修改dev.py文件内容</span></span><br><span class="line"><span class="string">LANGUAGE_CODE = &#x27;zh-hans&#x27;</span></span><br><span class="line"><span class="string">TIME_ZONE = &#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="string">USE_TZ = False</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4.修改启动配置：见插图</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5.在任何一个__init__.py文件中测试默认配置文件是否是dev.py文件</span></span><br><span class="line"><span class="string">from django.conf import settings</span></span><br><span class="line"><span class="string">print(settings)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-数据库配置"><a href="#4-数据库配置" class="headerlink" title="4.数据库配置"></a>4.数据库配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.创建数据库</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1.管理员连接数据库</span></span><br><span class="line"><span class="string">&gt;: mysql -uroot -proot</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2.创建数据库</span></span><br><span class="line"><span class="string">&gt;: create database luffy default charset=utf8;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3.查看用户</span></span><br><span class="line"><span class="string">&gt;: select user,host,password from mysql.user;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 5.7往后的版本</span></span><br><span class="line"><span class="string">&gt;: select user,host,authentication_string from mysql.user;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.为指定数据库配置指定账户</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">设置权限账号密码</span></span><br><span class="line"><span class="string"># 授权账号命令：grant 权限(create, update) on 库.表 to &#x27;账号&#x27;@&#x27;host&#x27; identified by &#x27;密码&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.配置任意ip都可以连入数据库的账户</span></span><br><span class="line"><span class="string">&gt;: grant all privileges on luffy.* to &#x27;luffy&#x27;@&#x27;%&#x27; identified by &#x27;Luffy123?&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">示例：grant all privileges on luffy.* to &#x27;luffy&#x27;@&#x27;192.168.43.24&#x27; identified by &#x27;liu199556&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2.由于数据库版本的问题，可能本地还连接不上，就给本地用户单独配置</span></span><br><span class="line"><span class="string">&gt;: grant all privileges on luffy.* to &#x27;luffy&#x27;@&#x27;localhost&#x27; identified by &#x27;Luffy123?&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3.刷新一下权限</span></span><br><span class="line"><span class="string">&gt;: flush privileges;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">只能操作luffy数据库的账户</span></span><br><span class="line"><span class="string">账号：luffy</span></span><br><span class="line"><span class="string">密码：Luffy123?</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.配置文件配置</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;数据库用户名密码添加到环境变量中&#x27;&#x27;&#x27;</span></span><br><span class="line">user = os.environ.get(<span class="string">&#x27;User&#x27;</span>, )</span><br><span class="line">password = os.environ.get(<span class="string">&#x27;Password&#x27;</span>, )</span><br><span class="line"></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;luffy&#x27;</span>,  <span class="comment"># 数据库库名</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: user,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: password,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="number">3306</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;192.168.31.50&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;如果用mysqlclient不用加上述两句话，可以下mysqlcilent 1.4.6&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-前台配置"><a href="#5-前台配置" class="headerlink" title="5.前台配置"></a>5.前台配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 vue环境</span></span><br><span class="line"><span class="number">1.</span>傻瓜式安装node: </span><br><span class="line">官网下载：https://nodejs.org/zh-cn/</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>安装cnpm: </span><br><span class="line">&gt;: npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>安装vue最新脚手架: </span><br><span class="line">&gt;: cnpm install -g @vue/cli</span><br><span class="line"></span><br><span class="line">注：如果<span class="number">2</span>、<span class="number">3</span>步报错，清除缓存后重新走<span class="number">2</span>、<span class="number">3</span>步</span><br><span class="line">&gt;: npm cache clean --force</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2重构项目目录</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">├── luffycity</span></span><br><span class="line"><span class="string">	├── public/          			# 项目共有资源</span></span><br><span class="line"><span class="string">		├── favicon.ico				# 站点图标</span></span><br><span class="line"><span class="string">		└── index.html				# 主页</span></span><br><span class="line"><span class="string">    ├── src/      					# 项目主应用，开发时的代码保存</span></span><br><span class="line"><span class="string">    	├── assets/      			# 前台静态资源总目录</span></span><br><span class="line"><span class="string">    		├── css/				# 自定义css样式</span></span><br><span class="line"><span class="string">    			└── global.css		# 自定义全局样式</span></span><br><span class="line"><span class="string">    		├── js/					# 自定义js样式</span></span><br><span class="line"><span class="string">				└── settings.js		# 自定义配置文件</span></span><br><span class="line"><span class="string">			└── img/				# 前台图片资源</span></span><br><span class="line"><span class="string">		├── components/    			# 小组件目录</span></span><br><span class="line"><span class="string">		├── views/  				# 页面组件目录</span></span><br><span class="line"><span class="string">		├── App.vue	    			# 根组件</span></span><br><span class="line"><span class="string">		├── main.js	    			# 入口脚本文件</span></span><br><span class="line"><span class="string">		├── router    		</span></span><br><span class="line"><span class="string">			└── index.js			# 路由脚本文件</span></span><br><span class="line"><span class="string">		store	    		</span></span><br><span class="line"><span class="string">			└── index.js			# 仓库脚本文件</span></span><br><span class="line"><span class="string">    ├── vue.config.js	    		# 项目配置文件</span></span><br><span class="line"><span class="string">    └── *.*							# 其他配置文件</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.全局配置：全局样式、配置文件</span></span><br><span class="line"><span class="keyword">global</span>.css</span><br><span class="line"></span><br><span class="line">/* 声明全局样式和项目的初始化样式 */</span><br><span class="line">body, h1, h2, h3, h4, h5, h6, p, table, tr, td, ul, li, a, form, <span class="built_in">input</span>, select, option, textarea &#123;</span><br><span class="line">    margin: <span class="number">0</span>;</span><br><span class="line">    padding: <span class="number">0</span>;</span><br><span class="line">    font-size: 15px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a &#123;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">    color: <span class="comment">#333;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ul &#123;</span><br><span class="line">    <span class="built_in">list</span>-style: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table &#123;</span><br><span class="line">    border-collapse: collapse; /* 合并边框 */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.settings.js</span></span><br><span class="line">export default &#123;</span><br><span class="line">    base_url: <span class="string">&#x27;http://127.0.0.1:8000&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 4.main.js</span></span><br><span class="line"></span><br><span class="line">// 配置全局样式</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@/assets/css/global.css&#x27;</span></span><br><span class="line"></span><br><span class="line">// 配置全局自定义设置</span><br><span class="line"><span class="keyword">import</span> settings <span class="keyword">from</span> <span class="string">&#x27;@/assets/js/settings&#x27;</span></span><br><span class="line">Vue.prototype.$settings = settings;</span><br><span class="line">// 在所有需要与后台交互的组件中：this.$settings.base_url + <span class="string">&#x27;再拼接具体后台路由&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.axios前后台交互</span></span><br><span class="line">安装：前端项目目录下的终端</span><br><span class="line">&gt;: cnpm install axios</span><br><span class="line">配置：main.js</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line">Vue.prototype.$axios = axios;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.cookies操作</span></span><br><span class="line">安装：前端项目目录下的终端</span><br><span class="line"></span><br><span class="line">&gt;: cnpm install vue-cookies</span><br><span class="line">配置：main.js</span><br><span class="line"><span class="keyword">import</span> cookies <span class="keyword">from</span> <span class="string">&#x27;vue-cookies&#x27;</span></span><br><span class="line">Vue.prototype.$cookies = cookies;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">// 持久化存储val的值到cookie中</span></span><br><span class="line"><span class="string">this.$cookies.set(&#x27;val&#x27;, this.val, 300)</span></span><br><span class="line"><span class="string">// 获取cookie中val字段值</span></span><br><span class="line"><span class="string">this.$cookies.get(&#x27;val&#x27;)</span></span><br><span class="line"><span class="string">// 删除cookie键值对</span></span><br><span class="line"><span class="string">this.$cookies.remove(&#x27;val&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.element-ui页面组件框架</span></span><br><span class="line">安装：前端项目目录下的终端</span><br><span class="line">&gt;: cnpm install element-ui</span><br><span class="line">配置：main.js</span><br><span class="line"><span class="keyword">import</span> ElementUI <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;</span><br><span class="line">Vue.use(ElementUI);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.bootstrap页面组件框架</span></span><br><span class="line">安装：前端项目目录下的终端</span><br><span class="line">&gt;: cnpm install jquery</span><br><span class="line">&gt;: cnpm install bootstrap@<span class="number">3</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 5.配置jquery：vue.config.js</span></span><br><span class="line"></span><br><span class="line">const webpack = require(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    configureWebpack: &#123;</span><br><span class="line">        plugins: [</span><br><span class="line">            new webpack.ProvidePlugin(&#123;</span><br><span class="line">                $: <span class="string">&quot;jquery&quot;</span>,</span><br><span class="line">                jQuery: <span class="string">&quot;jquery&quot;</span>,</span><br><span class="line">                <span class="string">&quot;window.jQuery&quot;</span>: <span class="string">&quot;jquery&quot;</span>,</span><br><span class="line">                <span class="string">&quot;window.$&quot;</span>: <span class="string">&quot;jquery&quot;</span>,</span><br><span class="line">                Popper: [<span class="string">&quot;popper.js&quot;</span>, <span class="string">&quot;default&quot;</span>]</span><br><span class="line">            &#125;)</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.配置bootstrap：main.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;bootstrap&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;bootstrap/dist/css/bootstrap.min.css&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="1-跨域问题"><a href="#1-跨域问题" class="headerlink" title="1 跨域问题"></a>1 跨域问题</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 同源策略：浏览器的安全策略，不允许去另一个域加载数据</span><br><span class="line"><span class="number">2</span> 域：ip或者端口都必须一致</span><br><span class="line"><span class="number">3</span> 前后端分离项目会出现跨域</span><br><span class="line"><span class="number">4</span> 不使用第三方，自己处理</span><br><span class="line"><span class="number">5</span> CORS：后端技术，跨域资源共享，服务端只要做配置，（本身浏览器已经支持了），就支持跨域</span><br><span class="line">	-access-control-allow-origin: *  <span class="comment"># 所有的域都可以向我发送请求，浏览器不会禁止</span></span><br><span class="line"><span class="number">6</span> 浏览器将CORS请求分成两类：</span><br><span class="line">	-简单请求（simple request）</span><br><span class="line">	-非简单请求（<span class="keyword">not</span>-so-simple request）</span><br><span class="line"><span class="number">7</span> 满足以下两大条件就是简单请求</span><br><span class="line">    （<span class="number">1</span>) 请求方法是以下三种方法之一：</span><br><span class="line">        HEAD</span><br><span class="line">        GET</span><br><span class="line">        POST</span><br><span class="line">    （<span class="number">2</span>）HTTP的头信息不超出以下几种字段：</span><br><span class="line">        Accept</span><br><span class="line">        Accept-Language</span><br><span class="line">        Content-Language</span><br><span class="line">        Last-Event-ID</span><br><span class="line">        Content-<span class="type">Type</span>：只限于三个值application/x-www-form-urlencoded、multipart/form-data、text/plain</span><br><span class="line">        </span><br><span class="line"><span class="number">8</span> 简单请求，只发送一次，如果后端写了CORS，浏览器就不禁止了</span><br><span class="line"><span class="number">9</span> 非简单请求，发两次，第一次是OPTIONS（预检请求），看后端是否允许，如果允许再发真正的请求</span><br></pre></td></tr></table></figure>



<h3 id="1-1-后端解决跨域问题"><a href="#1-1-后端解决跨域问题" class="headerlink" title="1.1 后端解决跨域问题"></a>1.1 后端解决跨域问题</h3><p>一个测试服务端</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $(<span class="string">&#x27;#btn&#x27;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> obj = &#123;<span class="attr">name</span>: <span class="string">&#x27;xxxx&#x27;</span>&#125;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">url</span>: <span class="string">&#x27;http://127.0.0.1:8000/user/index&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">type</span>: <span class="string">&#x27;post&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">headers</span>: &#123;<span class="string">&#x27;authorization&#x27;</span>: <span class="string">&#x27;jwt&#x27;</span>&#125;,</span></span><br><span class="line"><span class="javascript">            <span class="attr">contentType</span>: <span class="string">&#x27;application/json&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">data</span>: <span class="built_in">JSON</span>.stringify(obj),</span></span><br><span class="line"><span class="javascript">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(res)</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    &#125;)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>写一个中间件</p>
<p>1 middle.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiddleCors</span>(<span class="params">MiddlewareMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span>(<span class="params">self, request, response</span>):</span></span><br><span class="line">        <span class="comment"># 配置跨域简单请求</span></span><br><span class="line">        response[<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>] = <span class="string">&#x27;*&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(request.method)</span><br><span class="line">        <span class="comment"># 配置跨域非简单请求</span></span><br><span class="line">        <span class="keyword">if</span> request.method == <span class="string">&#x27;OPTIONS&#x27;</span>:</span><br><span class="line">            response[<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>] = <span class="string">&#x27;content-type,authorization&#x27;</span></span><br><span class="line">            response[<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>] = <span class="string">&#x27;*&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>2 注册定义的中间件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [    </span><br><span class="line">    <span class="string">&#x27;....&#x27;</span></span><br><span class="line">    <span class="string">&#x27;middle.MiddleCors&#x27;</span>,  <span class="comment"># 自定义的解决跨域中间件</span></span><br><span class="line">	<span class="string">&#x27;....&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="1-2-第三方解决跨域"><a href="#1-2-第三方解决跨域" class="headerlink" title="1.2 第三方解决跨域"></a>1.2 第三方解决跨域</h2><h3 id="1、使用pip安装"><a href="#1、使用pip安装" class="headerlink" title="1、使用pip安装"></a>1、使用pip安装</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-cors-headers</span><br></pre></td></tr></table></figure>

<h3 id="2、添加到setting的app中"><a href="#2、添加到setting的app中" class="headerlink" title="2、添加到setting的app中"></a>2、添加到setting的app中</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = (</span><br><span class="line">	...</span><br><span class="line">	<span class="string">&#x27;corsheaders&#x27;</span>,</span><br><span class="line">	...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="3、添加中间件"><a href="#3、添加中间件" class="headerlink" title="3、添加中间件"></a>3、添加中间件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [  <span class="comment"># Or MIDDLEWARE_CLASSES on Django &lt; 1.10</span></span><br><span class="line">	...</span><br><span class="line">	<span class="string">&#x27;corsheaders.middleware.CorsMiddleware&#x27;</span>,</span><br><span class="line">	...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="4、setting下面添加下面的配置"><a href="#4、setting下面添加下面的配置" class="headerlink" title="4、setting下面添加下面的配置"></a>4、setting下面添加下面的配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">CORS_ALLOW_CREDENTIALS = <span class="literal">True</span></span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span></span><br><span class="line">CORS_ORIGIN_WHITELIST = (</span><br><span class="line">	<span class="comment"># 允许访问请求资源的url</span></span><br><span class="line">    <span class="string">&#x27;http://127.0.0.1:8081&#x27;</span>,</span><br><span class="line">)</span><br><span class="line">CORS_ALLOW_METHODS = (</span><br><span class="line">	<span class="string">&#x27;DELETE&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;OPTIONS&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;PATCH&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;VIEW&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CORS_ALLOW_HEADERS = (</span><br><span class="line">	<span class="string">&#x27;XMLHttpRequest&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;X_FILENAME&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;accept-encoding&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;authorization&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;content-type&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;dnt&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;origin&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;user-agent&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;x-csrftoken&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;x-requested-with&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;Pragma&#x27;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="1-3-前端解决跨域问题"><a href="#1-3-前端解决跨域问题" class="headerlink" title="1.3 前端解决跨域问题"></a>1.3 前端解决跨域问题</h2><h3 id="1-配置文件vue-config-js"><a href="#1-配置文件vue-config-js" class="headerlink" title="1 配置文件vue.config.js"></a>1 配置文件vue.config.js</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        proxy: &#123;</span><br><span class="line"></span><br><span class="line">            // <span class="string">&#x27;/ajax&#x27;</span>: &#123; // 路径当中以ajax开头的请求代理到https://m.maoyan.com/中</span><br><span class="line">            //     target: <span class="string">&#x27;https://m.maoyan.com/&#x27;</span>,</span><br><span class="line">            //     changeOrigin: true</span><br><span class="line">            //</span><br><span class="line">            // &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;/user&#x27;</span>: &#123; // 路径当中以user开头的请求代理到https://m.maoyan.com/中</span><br><span class="line">                target: <span class="string">&#x27;http://127.0.0.1:8000/&#x27;</span>,</span><br><span class="line">                changeOrigin: true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-axios发送请求"><a href="#2-axios发送请求" class="headerlink" title="2 axios发送请求"></a>2 axios发送请求</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mounted() &#123;</span><br><span class="line">            this.$axios.get(<span class="string">&#x27;user/index&#x27;</span>).then(response =&gt; &#123;</span><br><span class="line">                console.log(response.data)</span><br><span class="line">            &#125;).catch(error =&gt; &#123;</span><br><span class="line">                console.log(error)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-git"><a href="#2-git" class="headerlink" title="2 git"></a>2 git</h2><h3 id="2-1-git的工作流程"><a href="#2-1-git的工作流程" class="headerlink" title="2.1 git的工作流程"></a>2.1 git的工作流程</h3><p><img src="C:/Users/%E5%88%98%E4%B8%80/AppData/Roaming/Typora/typora-user-images/image-20201224184543367.png" alt="image-20201224184543367"></p>
<h3 id="2-2-基础命令"><a href="#2-2-基础命令" class="headerlink" title="2.2 基础命令"></a>2.2 基础命令</h3><h5 id="将已有的文件夹-初始化为git仓库"><a href="#将已有的文件夹-初始化为git仓库" class="headerlink" title="将已有的文件夹 - 初始化为git仓库"></a>将已有的文件夹 - 初始化为git仓库</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&gt;: cd 目标文件夹内部</span></span><br><span class="line"><span class="string">&gt;: git init</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="在指定目录下-初始化git仓库"><a href="#在指定目录下-初始化git仓库" class="headerlink" title="在指定目录下 - 初始化git仓库"></a>在指定目录下 - 初始化git仓库</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&gt;: cd 目标目录</span></span><br><span class="line"><span class="string">&gt;: git init 仓库名</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="在仓库目录终端下-设置全局用户"><a href="#在仓库目录终端下-设置全局用户" class="headerlink" title="在仓库目录终端下 - 设置全局用户"></a>在仓库目录终端下 - 设置全局用户</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&gt;: git config --global user.name &#x27;lhj&#x27;</span></span><br><span class="line"><span class="string">&gt;: git config --global user.email &#x27;lhj@qq.com&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">注：在全局文件 C:\Users\用户文件夹\.gitconfig新建用户信息，在所有仓库下都可以使用</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="在仓库目录终端下-设置局部用户"><a href="#在仓库目录终端下-设置局部用户" class="headerlink" title="在仓库目录终端下 - 设置局部用户"></a>在仓库目录终端下 - 设置局部用户</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&gt;: git config user.name &#x27;lhj&#x27;</span></span><br><span class="line"><span class="string">	-- 用户名</span></span><br><span class="line"><span class="string">&gt;: git config user.email &#x27;lhj@qq.com&#x27;</span></span><br><span class="line"><span class="string">	-- 用户邮箱</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">注：在当前仓库下的config新建用户信息，只能在当前仓库下使用</span></span><br><span class="line"><span class="string">注：一个仓库有局部用户，优先使用局部用户，没有配置再找全局用户</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="查看仓库状态"><a href="#查看仓库状态" class="headerlink" title="查看仓库状态"></a>查看仓库状态</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># 当仓库中有文件增加、删除、修改，都可以在仓库状态中查看</span></span><br><span class="line"><span class="string">&gt;: git status  </span></span><br><span class="line"><span class="string">	-- 查看仓库状态</span></span><br><span class="line"><span class="string">&gt;: git status -s  </span></span><br><span class="line"><span class="string">	-- 查看仓库状态的简约显示</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="撤销工作区操作：改、删（了解）"><a href="#撤销工作区操作：改、删（了解）" class="headerlink" title="撤销工作区操作：改、删（了解）"></a>撤销工作区操作：改、删（了解）</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&gt;: git checkout .</span></span><br><span class="line"><span class="string">	-- 撤销所有暂存区的提交</span></span><br><span class="line"><span class="string">&gt;: git checkout 文件名</span></span><br><span class="line"><span class="string">	-- 撤销某一文件的暂存区提交</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="工作区内容提交到暂存区"><a href="#工作区内容提交到暂存区" class="headerlink" title="工作区内容提交到暂存区"></a>工作区内容提交到暂存区</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&gt;: git add .  </span></span><br><span class="line"><span class="string">	-- 添加项目中所有文件</span></span><br><span class="line"><span class="string">&gt;: git add 文件名  </span></span><br><span class="line"><span class="string">	-- 添加指定文件</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="撤销暂存区提交：add的逆运算（很少使用）"><a href="#撤销暂存区提交：add的逆运算（很少使用）" class="headerlink" title="撤销暂存区提交：add的逆运算（很少使用）"></a>撤销暂存区提交：add的逆运算（很少使用）</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&gt;: git reset HEAD .</span></span><br><span class="line"><span class="string">	-- 撤销所有暂存区的提交</span></span><br><span class="line"><span class="string">&gt;: git reset 文件名</span></span><br><span class="line"><span class="string">	-- 撤销某一文件的暂存区提交</span></span><br><span class="line"><span class="string">&gt;: git reset .</span></span><br><span class="line"><span class="string">	-- 撤销所有暂存区的提交</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="提交暂存区内容到版本库"><a href="#提交暂存区内容到版本库" class="headerlink" title="提交暂存区内容到版本库"></a>提交暂存区内容到版本库</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">&quot;版本描述信息&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="撤销版本库提交：commit的逆运算"><a href="#撤销版本库提交：commit的逆运算" class="headerlink" title="撤销版本库提交：commit的逆运算"></a>撤销版本库提交：commit的逆运算</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">回滚暂存区已经提交到版本库的操作：</span></span><br><span class="line"><span class="string">    查看历史版本：</span></span><br><span class="line"><span class="string">        &gt;: git log</span></span><br><span class="line"><span class="string">        &gt;: git reflog</span></span><br><span class="line"><span class="string">    查看时间点之前|之后的日志：</span></span><br><span class="line"><span class="string">        &gt;: git log --after 2018-6-1</span></span><br><span class="line"><span class="string">        &gt;: git log --before 2018-6-1</span></span><br><span class="line"><span class="string">        &gt;: git reflog --after 2018-6-1</span></span><br><span class="line"><span class="string">        &gt;: git reflog --before 2018-6-1</span></span><br><span class="line"><span class="string">    查看指定开发者日志</span></span><br><span class="line"><span class="string">        &gt;: git log --author author_name</span></span><br><span class="line"><span class="string">        &gt;: git reflog --author author_name</span></span><br><span class="line"><span class="string">    回滚到指定版本：</span></span><br><span class="line"><span class="string">        回滚到上一个版本：</span></span><br><span class="line"><span class="string">            &gt;: git reset --hard HEAD^</span></span><br><span class="line"><span class="string">            &gt;: git reset --hard HEAD~</span></span><br><span class="line"><span class="string">        回滚到上三个版本：</span></span><br><span class="line"><span class="string">            &gt;: git reset --hard HEAD^^^</span></span><br><span class="line"><span class="string">            &gt;: git reset --hard HEAD~3</span></span><br><span class="line"><span class="string">        回滚到指定版本号的版本：</span></span><br><span class="line"><span class="string">            &gt;: git reset --hard 版本号 (重点)</span></span><br><span class="line"><span class="string">            &gt;: eg: git reset --hard 35cb292</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-3-git分支"><a href="#2-3-git分支" class="headerlink" title="2.3 git分支"></a>2.3 git分支</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggqvtp3d2zj310v0bmq3h.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 分支查看：git branch  <span class="comment"># 绿色表示当前所在分支</span></span><br><span class="line"><span class="number">2</span> 分支创建：git branch dev <span class="comment"># 创建分支的代码，基于master创建出来的，代码现在跟master一样</span></span><br><span class="line">	-在那个分支上创建分支，目前新分支和所在分支代码一样</span><br><span class="line"><span class="number">3</span> 分支删除：git branch -d dev</span><br><span class="line"><span class="number">4</span> 切换分支 ：git checkout dev</span><br><span class="line"><span class="number">5</span> 分支合并</span><br><span class="line">    git merge 分支名</span><br><span class="line">    把dev分支合并到master分支：切换到master分支，执行合并dev分支的命令</span><br><span class="line">    </span><br><span class="line"><span class="number">6</span> 创建并切换到某个分支（两部并作一步）</span><br><span class="line">	git checkout -b 分支名</span><br></pre></td></tr></table></figure>

<h2 id="3-远程仓库"><a href="#3-远程仓库" class="headerlink" title="3 远程仓库"></a>3 远程仓库</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">简易的命令行入门教程:</span><br><span class="line">Git 全局设置:</span><br><span class="line"></span><br><span class="line">git config --<span class="keyword">global</span> user.name <span class="string">&quot;刘皓杰&quot;</span></span><br><span class="line">git config --<span class="keyword">global</span> user.email <span class="string">&quot;1026170773@qq.com&quot;</span></span><br><span class="line">创建 git 仓库:</span><br><span class="line"></span><br><span class="line">mkdir luufy</span><br><span class="line">cd luufy</span><br><span class="line">git init</span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">&quot;first commit&quot;</span></span><br><span class="line">git remote add origin https://gitee.com/liuhaojie_199556/luufy.git</span><br><span class="line">git push  origin master</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">其它命令</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1）查看仓库已配置的远程源</span></span><br><span class="line"><span class="string">&gt;: git remote</span></span><br><span class="line"><span class="string">&gt;: git remote -v</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2）查看remote命令帮助文档</span></span><br><span class="line"><span class="string">&gt;: git remote -h</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3）删除远程源</span></span><br><span class="line"><span class="string">&gt;: git remote remove 源名</span></span><br><span class="line"><span class="string">eg: git remote remove origin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4）添加远程源</span></span><br><span class="line"><span class="string">&gt;: git remote add 源名 源地址</span></span><br><span class="line"><span class="string">&gt;: git remote add orgin git@gitee.com:doctor_owen/luffyapi.git</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5）提交代码到远程源</span></span><br><span class="line"><span class="string">&gt;: git push 源码 分支名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6）克隆远程源</span></span><br><span class="line"><span class="string">&gt;: git clone 远程源地址</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-采用ssh协议连接远程源"><a href="#4-采用ssh协议连接远程源" class="headerlink" title="4 采用ssh协议连接远程源"></a>4 采用ssh协议连接远程源</h2><h3 id="4-1-创建电脑的公钥私钥"><a href="#4-1-创建电脑的公钥私钥" class="headerlink" title="4.1 创建电脑的公钥私钥"></a>4.1 创建电脑的公钥私钥</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">官网：https://gitee.com/<span class="built_in">help</span>/articles/<span class="number">4181</span><span class="comment">#article-header0</span></span><br><span class="line">本机命令，生成公钥：ssh-keygen -t rsa -C <span class="string">&quot;1026170773@qq.com&quot;</span></span><br><span class="line">	邮箱可以任意填写</span><br><span class="line">本机命令，查看公钥：cat ~/.ssh/id_rsa.pub</span><br><span class="line"></span><br><span class="line">码云线上添加公钥：项目仓库 =&gt; 管理 =&gt; 部署公钥管理 =&gt; 添加公钥 =&gt; 添加个人公钥</span><br></pre></td></tr></table></figure>

<h3 id="4-2-协同开发"><a href="#4-2-协同开发" class="headerlink" title="4.2 协同开发"></a>4.2 协同开发</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1）作为开发者，第一次同步项目（前台已经是项目开发者了）</span></span><br><span class="line"><span class="string">&gt;: git clone 项目地址</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2）保证自己本地有dev分支，且与远程仓库版本同步(没有就自己新建)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3）本地开发的代码，必须add、commit到本地版本库后，才和远程仓库进行交互</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4）交互顺序：必须 先拉(pull)后提(push)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5）必须切换到要交互的分支，在与远程同名的分支进行交互，如本地dev与远程dev交互</span></span><br><span class="line"><span class="string">&gt;: git checkout dev</span></span><br><span class="line"><span class="string">&gt;: git add .</span></span><br><span class="line"><span class="string">&gt;: git commit -m &#x27;本次提交的信息提示&#x27;</span></span><br><span class="line"><span class="string">&gt;: git pull origin dev</span></span><br><span class="line"><span class="string">&gt;: git push origin dev</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-远程仓库回滚"><a href="#4-3-远程仓库回滚" class="headerlink" title="4.3 远程仓库回滚"></a>4.3 远程仓库回滚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">用dev分支举例</span></span><br><span class="line"><span class="string">1）本地切换到远程要回滚的分支对应的本地分支</span></span><br><span class="line"><span class="string">git checkout dev</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2）回滚本地分支</span></span><br><span class="line"><span class="string">git reset --hard 版本号</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3）本地版本强行提交给服务器</span></span><br><span class="line"><span class="string">git push origin dev -f</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-redis"><a href="#5-redis" class="headerlink" title="5 redis"></a>5 redis</h2><h3 id="5-1-基本操作"><a href="#5-1-基本操作" class="headerlink" title="5.1 基本操作"></a>5.1 基本操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">redis: 操作字符串、列表、字典、无序集合、有序集合 | 支持数据持久化(数据丢失可以找回(默认持久化，主动持久化save)、可以将数据同步给mysql) | 高并发支持</span></span><br><span class="line"><span class="string">memcache: 操作字符串 | 不支持数据持久化 | 并发量小</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">前提：前往一个方便管理redis持久化文件的逻辑再启动服务：dump.rdb</span></span><br><span class="line"><span class="string">1）前台启动服务</span></span><br><span class="line"><span class="string">&gt;: redis-server</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2）后台启动服务</span></span><br><span class="line"><span class="string">&gt;: redis-server --service-start</span></span><br><span class="line"><span class="string">注）Linux系统后台启动（或是修改配置文件，建议采用方式）</span></span><br><span class="line"><span class="string">&gt;: redis-server &amp;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3）配置文件启动前台服务</span></span><br><span class="line"><span class="string">&gt;: redis-server 配置文件的绝对路径</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4）配置文件启动后台服务</span></span><br><span class="line"><span class="string">注）windows系统默认按Redis安装包下的redis.windows-service.conf配置文件启动</span></span><br><span class="line"><span class="string">&gt;: redis-server --service-start</span></span><br><span class="line"><span class="string">注）Linux系统可以完全自定义配置文件(redis.conf)后台启动</span></span><br><span class="line"><span class="string">&gt;: redis-server 配置文件的绝对路径 &amp;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">windows系统</span></span><br><span class="line"><span class="string">1）前台启动</span></span><br><span class="line"><span class="string">	i）打开终端切换到redis安装目录</span></span><br><span class="line"><span class="string">	&gt;: cd C:\Apps\Redis</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	ii）启动服务</span></span><br><span class="line"><span class="string">	&gt;: redis-server redis.windows.conf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2）后台启动</span></span><br><span class="line"><span class="string">	i）打开终端切换到redis安装目录</span></span><br><span class="line"><span class="string">	&gt;: cd C:\Apps\Redis</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	ii）启动服务（后面的配置文件可以省略）</span></span><br><span class="line"><span class="string">	&gt;: redis-server --service-start redis.windows-service.conf</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="5-2-数据类型"><a href="#5-2-数据类型" class="headerlink" title="5.2 数据类型"></a>5.2 数据类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">数据操作：字符串、列表、哈希(字典)、无序集合、有序(排序)集合</span></span><br><span class="line"><span class="string">	有序集合：游戏排行榜</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">字符串：</span></span><br><span class="line"><span class="string">	set key value</span></span><br><span class="line"><span class="string">	get key</span></span><br><span class="line"><span class="string">	mset k1 v1 k2 v2 ...</span></span><br><span class="line"><span class="string">	mget k1 k2 ...</span></span><br><span class="line"><span class="string">	setex key exp value</span></span><br><span class="line"><span class="string">	incrby key increment</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">列表：</span></span><br><span class="line"><span class="string">	rpush key value1 value2 ...</span></span><br><span class="line"><span class="string">	lpush key value1 value2 ...</span></span><br><span class="line"><span class="string">	lrange key bindex eindex</span></span><br><span class="line"><span class="string">	lindex key index</span></span><br><span class="line"><span class="string">	lpop key | rpop key</span></span><br><span class="line"><span class="string">	linsert key before|after old_value new_value</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">哈希：</span></span><br><span class="line"><span class="string">	hset key field value </span></span><br><span class="line"><span class="string">		- conn.hset(&#x27;userinfo&#x27;, &#x27;name&#x27;, &#x27;lqz&#x27;)</span></span><br><span class="line"><span class="string">	hget key field</span></span><br><span class="line"><span class="string">	hmset key field1 value1 field2 value2 ...</span></span><br><span class="line"><span class="string">	hmget key field1 field2</span></span><br><span class="line"><span class="string">	hkeys key</span></span><br><span class="line"><span class="string">	hvals key</span></span><br><span class="line"><span class="string">	hdel key field</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">集合：</span></span><br><span class="line"><span class="string">	sadd key member1 member2 ...</span></span><br><span class="line"><span class="string">	sdiff key1 key2 ...</span></span><br><span class="line"><span class="string">	sdiffstore newkey key1 key2 ...</span></span><br><span class="line"><span class="string">	sinter key1 key2 ...</span></span><br><span class="line"><span class="string">	sunion key1 key2 ...</span></span><br><span class="line"><span class="string">	smembers key</span></span><br><span class="line"><span class="string">	spop key</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">有序集合：</span></span><br><span class="line"><span class="string">	zadd key grade1 member1 grade2 member2 ...</span></span><br><span class="line"><span class="string">	zincrby key grade member</span></span><br><span class="line"><span class="string">	zrange key start end</span></span><br><span class="line"><span class="string">	zrevrange key start end</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-redis普通链接和链接池"><a href="#5-3-redis普通链接和链接池" class="headerlink" title="5.3 redis普通链接和链接池"></a>5.3 redis普通链接和链接池</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from redis import Redis</span></span><br><span class="line"><span class="comment"># 1 普通链接</span></span><br><span class="line"><span class="comment"># # 拿到一个链接</span></span><br><span class="line"><span class="comment"># coon = Redis()</span></span><br><span class="line"><span class="comment"># # conn=Redis(host=&#x27;127.0.0.1&#x27;, port=6379)</span></span><br><span class="line"><span class="comment"># # 使用链接操作</span></span><br><span class="line"><span class="comment"># coon.set(&#x27;name&#x27;, &#x27;lyh&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># coon.close()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 链接池</span></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建出一个连接池</span></span><br><span class="line"><span class="comment"># pool = redis.ConnectionPool(host=&#x27;127.0.0.1&#x27;, port=6379, max_connections=100)</span></span><br><span class="line"><span class="comment"># # 从连接池中拿一个连接</span></span><br><span class="line"><span class="comment"># conn = redis.Redis(connection_pool=pool)</span></span><br><span class="line"><span class="comment"># conn.set(&#x27;foo&#x27;, &#x27;Bar&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.close()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实际应用</span></span><br><span class="line"><span class="keyword">from</span> redis_pool <span class="keyword">import</span> POOL  <span class="comment"># Pool是单例，</span></span><br><span class="line"></span><br><span class="line">conn = redis.Redis(connection_pool=POOL)</span><br><span class="line">conn.<span class="built_in">set</span>(<span class="string">&#x27;age&#x27;</span>, <span class="number">18</span>)</span><br><span class="line">conn.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="redis-pool"><a href="#redis-pool" class="headerlink" title="redis_pool"></a>redis_pool</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line">POOL=redis.ConnectionPool(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">6379</span>,max_connections=<span class="number">100</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-4-redis之字符串"><a href="#5-4-redis之字符串" class="headerlink" title="5.4  redis之字符串"></a>5.4  redis之字符串</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> Redis</span><br><span class="line"></span><br><span class="line">conn = Redis()</span><br><span class="line"><span class="comment">###  1 set 的使用</span></span><br><span class="line"><span class="comment"># name:key值</span></span><br><span class="line"><span class="comment"># value：value值</span></span><br><span class="line"><span class="comment"># ex:过期时间，按秒记</span></span><br><span class="line"><span class="comment"># px：过期时间（毫秒）</span></span><br><span class="line"><span class="comment"># nx：如果设置为True，则只有name不存在时，当前set操作才执行,值存在，就修改不了，执行没效果</span></span><br><span class="line"><span class="comment"># xx：如果设置为True，则只有name存在时，当前set操作才执行，值存在才能修改，值不存在，不会设置新值</span></span><br><span class="line"><span class="comment"># conn.set(&#x27;name&#x27;,&#x27;egon&#x27;)</span></span><br><span class="line"><span class="comment"># conn.set(&#x27;name&#x27;,&#x27;lqz&#x27;,nx=True)</span></span><br><span class="line"><span class="comment"># conn.set(&#x27;name&#x27;,&#x27;lqz&#x27;,xx=True)</span></span><br><span class="line"><span class="comment"># conn.set(&#x27;age&#x27;,&#x27;18&#x27;,xx=True)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2 get</span></span><br><span class="line"><span class="comment"># res=conn.get(&#x27;name&#x27;)</span></span><br><span class="line"><span class="comment"># print(res)  # 返回的数据是byte格式</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##3 setnx(name, value)</span></span><br><span class="line"><span class="comment"># 设置值，只有name不存在时，执行设置操作（添加）,如果存在，不会修改</span></span><br><span class="line"><span class="comment"># conn.setnx(&#x27;name&#x27;,&#x27;egon&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##4 setex(name, time,value, )</span></span><br><span class="line"><span class="comment"># conn.setex(&#x27;name&#x27;,3,&#x27;egon&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 5 mset</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.mset(&#123;&#x27;name&#x27;:&#x27;lqz22&#x27;,&#x27;age&#x27;:192,&#x27;sex&#x27;:&#x27;男&#x27;&#125;)</span></span><br><span class="line"><span class="comment">## 6 mget</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.mget(&#x27;name&#x27;,&#x27;age&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.mget([&#x27;name&#x27;,&#x27;age&#x27;])</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 7 getset(name, value)</span></span><br><span class="line"><span class="comment"># 一次网络io，完成了取值和设置</span></span><br><span class="line"><span class="comment"># res=conn.getset(&#x27;name&#x27;,&#x27;egon111111111111111&#x27;)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 8 getrange(key, start, end)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 前闭后闭区间</span></span><br><span class="line"><span class="comment"># res1 = conn.getrange(&#x27;name&#x27;, 0, 4).decode(&#x27;utf-8&#x27;)</span></span><br><span class="line"><span class="comment"># 最终效果跟上面一样</span></span><br><span class="line"><span class="comment"># res=conn.get(&#x27;name&#x27;).decode(&#x27;utf-8&#x27;)</span></span><br><span class="line"><span class="comment"># print(res[0:5])</span></span><br><span class="line"><span class="comment"># print(res1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># setrange(name, offset, value)</span></span><br><span class="line"><span class="comment"># conn.setrange(&#x27;name&#x27;,0,&#x27;tt&#x27;)</span></span><br><span class="line"><span class="comment"># conn.setrange(&#x27;name&#x27;,5,&#x27;tt&#x27;)</span></span><br><span class="line"><span class="comment"># conn.setrange(&#x27;name&#x27;,7,&#x27;ttttttttttttttttttttttttt&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># setbit(name, offset, value)</span></span><br><span class="line"><span class="comment"># conn.set(&#x27;n1&#x27;,&#x27;foo&#x27;)</span></span><br><span class="line"><span class="comment"># 那么字符串foo的二进制表示为：01100110 01101111 01101111</span></span><br><span class="line"><span class="comment"># conn.setbit(&#x27;n1&#x27;,7,1)</span></span><br><span class="line"><span class="comment"># #那么字符串foo的二进制表示为：01100111 01101111 01101111</span></span><br><span class="line"><span class="comment"># res=conn.get(&#x27;n1&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># getbit(name, offset)</span></span><br><span class="line"><span class="comment"># 获取bit位的第几个位置，看是1还是0</span></span><br><span class="line"><span class="comment"># res=conn.getbit(&#x27;n1&#x27;,7)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># bitcount(key, start=None, end=None)</span></span><br><span class="line"><span class="comment"># end:指的是bytes，前闭后闭区间</span></span><br><span class="line"><span class="comment"># res=conn.bitcount(&#x27;n1&#x27;,0,1)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### incr 重点</span></span><br><span class="line"><span class="comment"># 每次自增1</span></span><br><span class="line"><span class="comment"># 统计网页访问量，文章阅读量，粉丝数量，计数相关（不会存在并发安全的问题）</span></span><br><span class="line"><span class="comment"># conn.incr(&#x27;age&#x27;,-2)</span></span><br><span class="line"><span class="comment"># res=conn.get(&#x27;age&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.decr(&#x27;age&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.get(&#x27;age&#x27;)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># append</span></span><br><span class="line"><span class="comment"># conn.append(&#x27;name&#x27;,&#x27;lqz&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># res=conn.get(&#x27;name&#x27;)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.close()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 总结</span></span><br><span class="line"><span class="comment"># set:超时时间，nx，xx</span></span><br><span class="line"><span class="comment"># get</span></span><br><span class="line"><span class="comment"># mset</span></span><br><span class="line"><span class="comment"># mget</span></span><br><span class="line"><span class="comment"># incr</span></span><br><span class="line"><span class="comment"># decr</span></span><br><span class="line"><span class="comment"># getrange</span></span><br><span class="line"><span class="comment"># setrange</span></span><br><span class="line"><span class="comment"># append</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-5-redis之hash"><a href="#5-5-redis之hash" class="headerlink" title="5.5 redis之hash"></a>5.5 redis之hash</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">conn = redis.Redis()</span><br><span class="line"></span><br><span class="line"><span class="comment"># hset</span></span><br><span class="line">conn.hset(<span class="string">&#x27;userinfo&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;lqz&#x27;</span>)</span><br><span class="line"><span class="comment"># conn.hset(&#x27;userinfo&#x27;, &#x27;age&#x27;, &#x27;18&#x27;)</span></span><br><span class="line"><span class="comment"># conn.hset(&#x27;userinfo&#x27;, &#x27;sex&#x27;, &#x27;男&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hmset</span></span><br><span class="line"><span class="comment"># conn.hmset(&#x27;userinfo_2&#x27;,&#123;&#x27;name&#x27;:&#x27;egon&#x27;,&#x27;age&#x27;:18,&#x27;sex&#x27;:&#x27;男&#x27;&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hget</span></span><br><span class="line"><span class="comment"># res=conn.hget(&#x27;userinfo&#x27;,&#x27;sex&#x27;).decode(&#x27;utf-8&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hmget</span></span><br><span class="line"><span class="comment"># res=conn.hmget(&#x27;userinfo&#x27;,&#x27;age&#x27;,&#x27;name&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.hmget(&#x27;userinfo&#x27;,[&#x27;age&#x27;,&#x27;name&#x27;])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hgetall</span></span><br><span class="line"><span class="comment"># res=conn.hgetall(&#x27;userinfo&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># hlen(name)</span></span><br><span class="line"><span class="comment"># res=conn.hlen(&#x27;userinfo&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hkeys(name)</span></span><br><span class="line"><span class="comment"># res=conn.hkeys(&#x27;userinfo&#x27;)</span></span><br><span class="line"><span class="comment"># hvals(name)</span></span><br><span class="line"><span class="comment"># res=conn.hvals(&#x27;userinfo&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># hexists(name, key)</span></span><br><span class="line"><span class="comment"># res=conn.hexists(&#x27;userinfo&#x27;,&#x27;hobby&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.hexists(&#x27;userinfo&#x27;,&#x27;name&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hdel</span></span><br><span class="line"><span class="comment"># res=conn.hdel(&#x27;userinfo&#x27;,&#x27;name&#x27;,&#x27;age&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hincrby</span></span><br><span class="line"><span class="comment"># res=conn.hset(&#x27;userinfo&#x27;,&#x27;age&#x27;,19)</span></span><br><span class="line"><span class="comment"># conn.hincrby(&#x27;userinfo&#x27;,&#x27;age&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.hget(&#x27;userinfo&#x27;,&#x27;age&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># hscan</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in range(100):</span></span><br><span class="line"><span class="comment">#     conn.hset(&#x27;test&#x27;,&#x27;test_&#x27;+str(i),str(i))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不建议使用</span></span><br><span class="line"><span class="comment"># res=conn.hgetall(&#x27;test&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不怎么用</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># name，redis的name</span></span><br><span class="line"><span class="comment"># cursor，游标（基于游标分批取获取数据）</span></span><br><span class="line"><span class="comment"># match，匹配指定key，默认None 表示所有的key</span></span><br><span class="line"><span class="comment"># count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># res = conn.hscan(&#x27;test&#x27;, cursor=2, count=50)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># print(len(res[1]))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hscan_iter</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.hscan_iter(&#x27;test&#x27;,count=10)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 以后要使用hgetall的时候，要使用如下方式</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> conn.hscan_iter(<span class="string">&#x27;test&#x27;</span>, count=<span class="number">10</span>):</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">## 总结</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">hset</span></span><br><span class="line"><span class="string">hget</span></span><br><span class="line"><span class="string">hmset</span></span><br><span class="line"><span class="string">hmget</span></span><br><span class="line"><span class="string">hincrby</span></span><br><span class="line"><span class="string">hdel</span></span><br><span class="line"><span class="string">hexists</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">hscan_iter/hgetall 区分</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-6-redis之列表"><a href="#5-6-redis之列表" class="headerlink" title="5.6 redis之列表"></a>5.6 redis之列表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import redis</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># class MyRedis():</span></span><br><span class="line"><span class="comment">#     def __enter__(self):</span></span><br><span class="line"><span class="comment">#         self.conn = redis.Redis()</span></span><br><span class="line"><span class="comment">#         return self.conn</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     def __exit__(self, exc_type, exc_val, exc_tb):</span></span><br><span class="line"><span class="comment">#         self.conn.close()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># with MyRedis() as conn:</span></span><br><span class="line">    <span class="comment"># 列表操作</span></span><br><span class="line">    <span class="comment"># 1 lpush(name,values)</span></span><br><span class="line">    <span class="comment"># conn.lpush(&#x27;l1&#x27;, 1, 2, 3, 4, 5, &#x27;lqz&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2 rpush</span></span><br><span class="line">    <span class="comment"># conn.rpush(&#x27;l1&#x27;,&#x27;egon&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3 lpushx(name,value)</span></span><br><span class="line">    <span class="comment"># 在name对应的list中添加元素，只有name已经存在时，值添加到列表的最左边</span></span><br><span class="line">    <span class="comment"># conn.lpushx(&#x27;l2&#x27;,9)</span></span><br><span class="line">    <span class="comment"># conn.lpushx(&#x27;l1&#x27;,9)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># llen(name)</span></span><br><span class="line">    <span class="comment"># res=conn.llen(&#x27;l1&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># linsert(name, where, refvalue, value))  在某个位置插入值</span></span><br><span class="line">    <span class="comment"># where :BEFORE或AFTER,大小写都行</span></span><br><span class="line">    <span class="comment"># refvalue: lqz 表示以lqz为标准（不是下标索引）</span></span><br><span class="line">    <span class="comment"># conn.linsert(&#x27;l1&#x27;,&#x27;after&#x27;,&#x27;lqz&#x27;,&#x27;刘亦菲&#x27;)</span></span><br><span class="line">    <span class="comment"># conn.linsert(&#x27;l1&#x27;,&#x27;before&#x27;,&#x27;lqz&#x27;,&#x27;baby&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># lset</span></span><br><span class="line">    <span class="comment"># conn.lset(&#x27;l1&#x27;,0,&#x27;黄晓明&#x27;)</span></span><br><span class="line">    <span class="comment"># conn.lset(&#x27;l1&#x27;,5,&#x27;老伙计&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># lrem</span></span><br><span class="line">    <span class="comment"># 第二个参数count：</span></span><br><span class="line">    <span class="comment"># count = 0，删除列表中所有的指定值；</span></span><br><span class="line">    <span class="comment"># count=2,从前到后，删除2个；</span></span><br><span class="line">    <span class="comment"># count=-2,从后向前，删除2个</span></span><br><span class="line">    <span class="comment"># conn.lrem(&#x27;l1&#x27;,0,&#x27;lqz&#x27;)  # 把所有lqz都删除</span></span><br><span class="line">    <span class="comment"># conn.lrem(&#x27;l1&#x27;,2,&#x27;lqz&#x27;)  # 从前往后，删除2个lqz</span></span><br><span class="line">    <span class="comment"># conn.lrem(&#x27;l1&#x27;,-1,&#x27;lqz&#x27;)  # 从前往后，删除2个lqz</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># lpop</span></span><br><span class="line">    <span class="comment"># res=conn.lpop(&#x27;l1&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res=conn.rpop(&#x27;l1&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># lindex(不删除)</span></span><br><span class="line">    <span class="comment"># res=conn.lindex(&#x27;l1&#x27;,3)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># lrange   # 前闭后闭区间</span></span><br><span class="line">    <span class="comment"># res = conn.lrange(&#x27;l1&#x27;, 0, 3)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ltrim</span></span><br><span class="line">    <span class="comment"># res=conn.ltrim(&#x27;l1&#x27;,3,5)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># rpoplpush  需要两个列表</span></span><br><span class="line">    <span class="comment"># conn.lpush(&#x27;l2&#x27;,&#x27;lqz&#x27;,&#x27;egon&#x27;)</span></span><br><span class="line">    <span class="comment"># conn.rpoplpush(&#x27;l1&#x27;,&#x27;l1&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># blpop   # block:阻塞  左边弹出</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res=conn.blpop(&#x27;l1&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">lpush</span></span><br><span class="line"><span class="string">llen</span></span><br><span class="line"><span class="string">linsert</span></span><br><span class="line"><span class="string">lset</span></span><br><span class="line"><span class="string">lrem</span></span><br><span class="line"><span class="string">lpop</span></span><br><span class="line"><span class="string">lrange  # 使用它，自定义增量迭代</span></span><br><span class="line"><span class="string">blpop</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### redis类库中没有提供对列表元素的增量迭代，借助lrange</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">conn = redis.Redis()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.lpush(&#x27;l2&#x27;,1,2,3,4,5,6,7,8,9,)</span></span><br><span class="line"><span class="comment"># res=conn.lrange(&#x27;l2&#x27;,0,9999)  # 全部取出来</span></span><br><span class="line"><span class="comment"># res1=conn.lrange(&#x27;l2&#x27;,0,conn.llen(&#x27;l2&#x27;))  # 从0取到列表长度</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># print(res1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 类似于字典的hgetall，一次性全取出来，存在的问题是，因为不知道列表有多大，很有可能撑爆内存</span></span><br><span class="line"><span class="comment"># 我们实现一个增量迭代</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in range(10000):</span></span><br><span class="line"><span class="comment">#     conn.lpush(&#x27;l_test&#x27;,&#x27;test_%s&#x27;%i)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.lrange(&#x27;l2&#x27;,0,conn.llen(&#x27;l2&#x27;))</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># res = conn.lrange(&#x27;l_test&#x27;, 0, 9)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># def lscan_iter(name, conn, count=10):</span></span><br><span class="line"><span class="comment">#     cursor = 0</span></span><br><span class="line"><span class="comment">#     lenght = conn.llen(name)  # 计算列表总长度</span></span><br><span class="line"><span class="comment">#     while cursor &lt; lenght:</span></span><br><span class="line"><span class="comment">#         data = conn.lrange(name, cursor, (cursor+count) - 1)</span></span><br><span class="line"><span class="comment">#         cursor += count</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         for item in data:</span></span><br><span class="line"><span class="comment">#             yield item</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lcan_iter</span>(<span class="params">name, conn, count=<span class="number">10</span>, </span>):</span></span><br><span class="line">    cursor = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = conn.lrange(name, cursor, (cursor + count) - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> data:</span><br><span class="line">            cursor += count</span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">yield</span> item</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> lcan_iter(<span class="string">&#x27;l_test&#x27;</span>, conn, <span class="number">20</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<h3 id="5-7-redis之其它操作"><a href="#5-7-redis之其它操作" class="headerlink" title="5.7 redis之其它操作"></a>5.7 redis之其它操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 公共操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搭建哨兵。用了集群，这个模块就不够用了</span></span><br><span class="line"><span class="comment"># conn=redis.Redis()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># delete</span></span><br><span class="line"><span class="comment"># res=conn.delete(&#x27;l2&#x27;,&#x27;name&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#exists</span></span><br><span class="line"><span class="comment"># res=conn.exists(&#x27;l1&#x27;,&#x27;l_test&#x27;,&#x27;l2&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.exists(&#x27;l_test&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># expire</span></span><br><span class="line"><span class="comment"># res=conn.expire(&#x27;l_test&#x27;,5)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rename</span></span><br><span class="line"><span class="comment"># conn.lpush(&#x27;l1&#x27;,1,2,3)</span></span><br><span class="line"><span class="comment"># res=conn.rename(&#x27;l1&#x27;,&#x27;l2&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># res=conn.move(&#x27;l2&#x27;,3)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## redis的库是隔离的</span></span><br><span class="line">conn = redis.Redis()</span><br><span class="line"><span class="comment"># res=conn.lpop(&#x27;l2&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机出一个key值</span></span><br><span class="line"><span class="comment"># res=conn.randomkey()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.sadd(&#x27;choujiang&#x27;,9)</span></span><br><span class="line"><span class="comment"># conn.sadd(&#x27;choujiang&#x27;,90)</span></span><br><span class="line"><span class="comment"># conn.sadd(&#x27;choujiang&#x27;,99)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># res=conn.spop(&#x27;choujiang&#x27;)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># type----查看类型</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.type(&#x27;choujiang&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.type(&#x27;ss&#x27;)</span></span><br><span class="line">res=conn.<span class="built_in">type</span>(<span class="string">&#x27;zzz&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<h1 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h1><h2 id="一-简介"><a href="#一-简介" class="headerlink" title="一 简介"></a>一 简介</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 使用Redis有哪些好处？</span><br><span class="line"></span><br><span class="line">(<span class="number">1</span>) 速度快，因为数据存在内存中，类似于HashMap，HashMap的优势就是查找和操作的时间复杂度都是O(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>) 支持丰富数据类型，支持string，<span class="built_in">list</span>，<span class="built_in">set</span>，<span class="built_in">sorted</span> <span class="built_in">set</span>，<span class="built_in">hash</span></span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>) 支持事务，操作都是原子性，所谓的原子性就是对数据的更改要么全部执行，要么全部不执行</span><br><span class="line"></span><br><span class="line">(<span class="number">4</span>) 丰富的特性：可用于缓存，消息，按key设置过期时间，过期后将会自动删除</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> redis相比memcached有哪些优势？</span><br><span class="line"></span><br><span class="line">(<span class="number">1</span>) memcached所有的值均是简单的字符串，redis作为其替代者，支持更为丰富的数据类型</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>) redis的速度比memcached快很多</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>) redis可以持久化其数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> redis常见性能问题和解决方案：</span><br><span class="line"></span><br><span class="line">(<span class="number">1</span>) Master最好不要做任何持久化工作，如RDB内存快照和AOF日志文件</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>) 如果数据比较重要，某个Slave开启AOF备份数据，策略设置为每秒同步一次</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>) 为了主从复制的速度和连接的稳定性，Master和Slave最好在同一个局域网内</span><br><span class="line"></span><br><span class="line">(<span class="number">4</span>) 尽量避免在压力很大的主库上增加从库</span><br><span class="line"></span><br><span class="line">(<span class="number">5</span>) 主从复制不要用图状结构，用单向链表结构更为稳定，即：Master &lt;- Slave1 &lt;- Slave2 &lt;- Slave3...</span><br><span class="line"></span><br><span class="line">这样的结构方便解决单点故障问题，实现Slave对Master的替换。如果Master挂了，可以立刻启用Slave1做Master，其他不变。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> MySQL里有2000w数据，redis中只存20w的数据，如何保证redis中的数据都是热点数据</span><br><span class="line"></span><br><span class="line"> 相关知识：redis 内存数据集大小上升到一定大小的时候，就会施行数据淘汰策略。redis 提供 <span class="number">6</span>种数据淘汰策略：</span><br><span class="line"></span><br><span class="line">volatile-lru：从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰</span><br><span class="line"></span><br><span class="line">volatile-ttl：从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰</span><br><span class="line"></span><br><span class="line">volatile-random：从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰</span><br><span class="line"></span><br><span class="line">allkeys-lru：从数据集（server.db[i].<span class="built_in">dict</span>）中挑选最近最少使用的数据淘汰</span><br><span class="line"></span><br><span class="line">allkeys-random：从数据集（server.db[i].<span class="built_in">dict</span>）中任意选择数据淘汰</span><br><span class="line"></span><br><span class="line">no-enviction（驱逐）：禁止驱逐数据</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> Memcache与Redis的区别都有哪些？</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>)、存储方式</span><br><span class="line"></span><br><span class="line">Memecache把数据全部存在内存之中，断电后会挂掉，数据不能超过内存大小。</span><br><span class="line"></span><br><span class="line">Redis有部份存在硬盘上，这样能保证数据的持久性。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>)、数据支持类型</span><br><span class="line"></span><br><span class="line">Memcache对数据类型支持相对简单。</span><br><span class="line"></span><br><span class="line">Redis有复杂的数据类型。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>），value大小</span><br><span class="line"></span><br><span class="line">redis最大可以达到1GB，而memcache只有1MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">6.</span> Redis 常见的性能问题都有哪些？如何解决？</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="number">1</span>).Master写内存快照，save命令调度rdbSave函数，会阻塞主线程的工作，当快照比较大时对性能影响是非常大的，会间断性暂停服务，所以Master最好不要写内存快照。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>).Master AOF持久化，如果不重写AOF文件，这个持久化方式对性能的影响是最小的，但是AOF文件会不断增大，AOF文件过大会影响Master重启的恢复速度。Master最好不要做任何持久化工作，包括内存快照和AOF日志文件，特别是不要启用内存快照做持久化,如果数据比较关键，某个Slave开启AOF备份数据，策略为每秒同步一次。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="number">3</span>).Master调用BGREWRITEAOF重写AOF文件，AOF在重写的时候会占大量的CPU和内存资源，导致服务load过高，出现短暂服务暂停现象。</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>). Redis主从复制的性能问题，为了主从复制的速度和连接的稳定性，Slave和Master最好在同一个局域网内</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">7</span>, redis 最适合的场景</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Redis最适合所有数据<span class="keyword">in</span>-momory的场景，虽然Redis也提供持久化功能，但实际更多的是一个disk-backed的功能，跟传统意义上的持久化有比较大的差别，那么可能大家就会有疑问，似乎Redis更像一个加强版的Memcached，那么何时使用Memcached,何时使用Redis呢?</span><br><span class="line"></span><br><span class="line">       如果简单地比较Redis与Memcached的区别，大多数都会得到以下观点：</span><br><span class="line"></span><br><span class="line">     <span class="number">1</span> 、Redis不仅仅支持简单的k/v类型的数据，同时还提供<span class="built_in">list</span>，<span class="built_in">set</span>，zset，<span class="built_in">hash</span>等数据结构的存储。</span><br><span class="line">     <span class="number">2</span> 、Redis支持数据的备份，即master-slave模式的数据备份。</span><br><span class="line">     <span class="number">3</span> 、Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。</span><br><span class="line"></span><br><span class="line">（<span class="number">1</span>）、会话缓存（Session Cache）</span><br><span class="line"></span><br><span class="line">最常用的一种使用Redis的情景是会话缓存（session cache）。用Redis缓存会话比其他存储（如Memcached）的优势在于：Redis提供持久化。当维护一个不是严格要求一致性的缓存时，如果用户的购物车信息全部丢失，大部分人都会不高兴的，现在，他们还会这样吗？</span><br><span class="line"></span><br><span class="line">幸运的是，随着 Redis 这些年的改进，很容易找到怎么恰当的使用Redis来缓存会话的文档。甚至广为人知的商业平台Magento也提供Redis的插件。</span><br><span class="line"></span><br><span class="line">（<span class="number">2</span>）、全页缓存（FPC）</span><br><span class="line"></span><br><span class="line">除基本的会话token之外，Redis还提供很简便的FPC平台。回到一致性问题，即使重启了Redis实例，因为有磁盘的持久化，用户也不会看到页面加载速度的下降，这是一个极大改进，类似PHP本地FPC。</span><br><span class="line"></span><br><span class="line">再次以Magento为例，Magento提供一个插件来使用Redis作为全页缓存后端。</span><br><span class="line"></span><br><span class="line">此外，对WordPress的用户来说，Pantheon有一个非常好的插件  wp-redis，这个插件能帮助你以最快速度加载你曾浏览过的页面。</span><br><span class="line"></span><br><span class="line">（<span class="number">3</span>）、队列</span><br><span class="line"></span><br><span class="line">Reids在内存存储引擎领域的一大优点是提供 <span class="built_in">list</span> 和 <span class="built_in">set</span> 操作，这使得Redis能作为一个很好的消息队列平台来使用。Redis作为队列使用的操作，就类似于本地程序语言（如Python）对 <span class="built_in">list</span> 的 push/pop 操作。</span><br><span class="line"></span><br><span class="line">如果你快速的在Google中搜索“Redis queues”，你马上就能找到大量的开源项目，这些项目的目的就是利用Redis创建非常好的后端工具，以满足各种队列需求。例如，Celery有一个后台就是使用Redis作为broker，你可以从这里去查看。</span><br><span class="line"></span><br><span class="line">（<span class="number">4</span>），排行榜/计数器</span><br><span class="line"></span><br><span class="line">Redis在内存中对数字进行递增或递减的操作实现的非常好。集合（<span class="type">Set</span>）和有序集合（Sorted <span class="type">Set</span>）也使得我们在执行这些操作的时候变的非常简单，Redis只是正好提供了这两种数据结构。所以，我们要从排序集合中获取到排名最靠前的<span class="number">10</span>个用户–我们称之为“user_scores”，我们只需要像下面一样执行即可：</span><br><span class="line"></span><br><span class="line">当然，这是假定你是根据你用户的分数做递增的排序。如果你想返回用户及用户的分数，你需要这样执行：</span><br><span class="line"></span><br><span class="line">ZRANGE user_scores <span class="number">0</span> <span class="number">10</span> WITHSCORES</span><br><span class="line"></span><br><span class="line">Agora Games就是一个很好的例子，用Ruby实现的，它的排行榜就是使用Redis来存储数据的，你可以在这里看到。</span><br><span class="line"></span><br><span class="line">（<span class="number">5</span>）、发布/订阅</span><br><span class="line"></span><br><span class="line">最后（但肯定不是最不重要的）是Redis的发布/订阅功能。发布/订阅的使用场景确实非常多。我已看见人们在社交网络连接中使用，还可作为基于发布/订阅的脚本触发器，甚至用Redis的发布/订阅功能来建立聊天系统！（不，这是真的，你可以去核实）。</span><br><span class="line"></span><br><span class="line">Redis提供的所有特性中，我感觉这个是喜欢的人最少的一个，虽然它为用户提供如果此多功能。</span><br></pre></td></tr></table></figure>

<p><img src="C:/Users/%E5%88%98%E4%B8%80/AppData/Roaming/Typora/typora-user-images/image-20210106203412932.png" alt="image-20210106203412932"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis=&#123;</span><br><span class="line">        k1:<span class="string">&#x27;123&#x27;</span>,      字符串</span><br><span class="line">        k2:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],   列表/数组</span><br><span class="line">        k3:&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;     集合</span><br><span class="line">        k4:&#123;name:lqz,age:<span class="number">12</span>&#125;  字典/哈希表</span><br><span class="line">        k5:&#123;(<span class="string">&#x27;lqz&#x27;</span>,<span class="number">18</span>),(<span class="string">&#x27;egon&#x27;</span>,<span class="number">33</span>)&#125;  有序集合</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="二-redis的安装和使用"><a href="#二-redis的安装和使用" class="headerlink" title="二 redis的安装和使用"></a>二 redis的安装和使用</h2><p><strong>linux下安装</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-3.0.6.tar.gz</span><br><span class="line">tar xzf redis-3.0.6.tar.gz</span><br><span class="line">cd redis-3.0.6</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<p><strong>启动服务端</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src/redis-server</span><br></pre></td></tr></table></figure>

<p><strong>启动客户端</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">src/redis-cli</span><br><span class="line">redis&gt; set foo bar</span><br><span class="line">OK</span><br><span class="line">redis&gt; get foo</span><br><span class="line">&quot;bar&quot;</span><br></pre></td></tr></table></figure>

<p><strong>Windows下安装</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/liuqingzheng/p/9831331.html">详见：链接</a></p>
<h2 id="三-Python操作Redis之安装和支持存储类型"><a href="#三-Python操作Redis之安装和支持存储类型" class="headerlink" title="三 Python操作Redis之安装和支持存储类型"></a>三 Python操作Redis之安装和支持存储类型</h2><p><strong>安装redis模块</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install redis</span><br></pre></td></tr></table></figure>

<h2 id="四-Python操作Redis之普通连接"><a href="#四-Python操作Redis之普通连接" class="headerlink" title="四 Python操作Redis之普通连接"></a>四 Python操作Redis之普通连接</h2><p>redis-py提供两个类Redis和StrictRedis用于实现Redis的命令，StrictRedis用于实现大部分官方的命令，并使用官方的语法和命令，Redis是StrictRedis的子类，用于向后兼容旧版本的redis-py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import redis</span><br><span class="line"></span><br><span class="line">r = redis.Redis(host=&#x27;127.0.0.1&#x27;, port=6379)</span><br><span class="line">r.set(&#x27;foo&#x27;, &#x27;Bar&#x27;)</span><br><span class="line">print(r.get(&#x27;foo&#x27;))</span><br></pre></td></tr></table></figure>

<h2 id="四-Python操作Redis之连接池"><a href="#四-Python操作Redis之连接池" class="headerlink" title="四 Python操作Redis之连接池"></a>四 Python操作Redis之连接池</h2><p>redis-py使用connection pool来管理对一个redis server的所有连接，避免每次建立、释放连接的开销。默认，每个Redis实例都会维护一个自己的连接池。可以直接建立一个连接池，然后作为参数Redis，这样就可以实现多个Redis实例共享一个连接池</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import redis</span><br><span class="line"></span><br><span class="line">pool = redis.ConnectionPool(host=&#x27;127.0.0.1&#x27;, port=6379)</span><br><span class="line">r = redis.Redis(connection_pool=pool)</span><br><span class="line">r.set(&#x27;foo&#x27;, &#x27;Bar&#x27;)</span><br><span class="line">print(r.get(&#x27;foo&#x27;))</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h2 id="五-操作之String操作"><a href="#五-操作之String操作" class="headerlink" title="五 操作之String操作"></a>五 操作之String操作</h2><p>String操作，redis中的String在在内存中按照一个name对应一个value来存储。如图：</p>
<p><a target="_blank" rel="noopener" href="https://img2018.cnblogs.com/blog/1350514/201810/1350514-20181022175533950-849327963.png"><img src="https://img2018.cnblogs.com/blog/1350514/201810/1350514-20181022175533950-849327963.png" alt="img"></a></p>
<p><strong>set(name, value, ex=None, px=None, nx=False, xx=False)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">在Redis中设置值，默认，不存在则创建，存在则修改</span><br><span class="line">参数：</span><br><span class="line">     ex，过期时间（秒）</span><br><span class="line">     px，过期时间（毫秒）</span><br><span class="line">     nx，如果设置为True，则只有name不存在时，当前set操作才执行,值存在，就修改不了，执行没效果</span><br><span class="line">     xx，如果设置为True，则只有name存在时，当前set操作才执行，值存在才能修改，值不存在，不会设置新值</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>setnx(name, value)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">设置值，只有name不存在时，执行设置操作（添加）,如果存在，不会修改</span><br></pre></td></tr></table></figure>

<p><strong>setex(name, value, time)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 设置值</span><br><span class="line"># 参数：</span><br><span class="line">    # time，过期时间（数字秒 或 timedelta对象）</span><br></pre></td></tr></table></figure>

<p><strong>psetex(name, time_ms, value)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 设置值</span><br><span class="line"># 参数：</span><br><span class="line">    # time_ms，过期时间（数字毫秒 或 timedelta对象</span><br></pre></td></tr></table></figure>

<p>*<em>mset(*args, *<em>kwargs)</em></em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">批量设置值</span><br><span class="line">如：</span><br><span class="line">    mset(k1=&#x27;v1&#x27;, k2=&#x27;v2&#x27;)</span><br><span class="line">    或</span><br><span class="line">    mget(&#123;&#x27;k1&#x27;: &#x27;v1&#x27;, &#x27;k2&#x27;: &#x27;v2&#x27;&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>get(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">获取值</span><br></pre></td></tr></table></figure>

<p><strong>mget(keys, *args)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">批量获取</span><br><span class="line">如：</span><br><span class="line">    mget(&#x27;k1&#x27;, &#x27;k2&#x27;)</span><br><span class="line">    或</span><br><span class="line">    r.mget([&#x27;k3&#x27;, &#x27;k4&#x27;])</span><br></pre></td></tr></table></figure>

<p><strong>getset(name, value)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">设置新值并获取原来的值</span><br></pre></td></tr></table></figure>

<p><strong>getrange(key, start, end)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 获取子序列（根据字节获取，非字符）</span><br><span class="line"># 参数：</span><br><span class="line">    # name，Redis 的 name</span><br><span class="line">    # start，起始位置（字节）</span><br><span class="line">    # end，结束位置（字节）</span><br><span class="line"># 如： &quot;刘清政&quot; ，0-3表示 &quot;刘&quot;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>setrange(name, offset, value)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 修改字符串内容，从指定字符串索引开始向后替换（新值太长时，则向后添加）</span><br><span class="line"># 参数：</span><br><span class="line">    # offset，字符串的索引，字节（一个汉字三个字节）</span><br><span class="line">    # value，要设置的值</span><br></pre></td></tr></table></figure>

<p><strong>setbit(name, offset, value)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 对name对应值的二进制表示的位进行操作</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis的name</span><br><span class="line">    # offset，位的索引（将值变换成二进制后再进行索引）</span><br><span class="line">    # value，值只能是 1 或 0</span><br><span class="line"> </span><br><span class="line"># 注：如果在Redis中有一个对应： n1 = &quot;foo&quot;，</span><br><span class="line">        那么字符串foo的二进制表示为：01100110 01101111 01101111</span><br><span class="line">    所以，如果执行 setbit(&#x27;n1&#x27;, 7, 1)，则就会将第7位设置为1，</span><br><span class="line">        那么最终二进制则变成 01100111 01101111 01101111，即：&quot;goo&quot;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>getbit(name, offset)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取name对应的值的二进制表示中的某位的值 （0或1）</span><br></pre></td></tr></table></figure>

<p><strong>bitcount(key, start=None, end=None)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 获取name对应的值的二进制表示中 1 的个数</span><br><span class="line"># 参数：</span><br><span class="line">    # key，Redis的name</span><br><span class="line">    # start，位起始位置</span><br><span class="line">    # end，位结束位置</span><br></pre></td></tr></table></figure>

<p><strong>bitop(operation, dest, *keys)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 获取多个值，并将值做位运算，将最后的结果保存至新的name对应的值</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # operation,AND（并） 、 OR（或） 、 NOT（非） 、 XOR（异或）</span><br><span class="line">    # dest, 新的Redis的name</span><br><span class="line">    # *keys,要查找的Redis的name</span><br><span class="line"> </span><br><span class="line"># 如：</span><br><span class="line">    bitop(&quot;AND&quot;, &#x27;new_name&#x27;, &#x27;n1&#x27;, &#x27;n2&#x27;, &#x27;n3&#x27;)</span><br><span class="line">    # 获取Redis中n1,n2,n3对应的值，然后讲所有的值做位运算（求并集），然后将结果保存 new_name 对应的值中</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>strlen(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 返回name对应值的字节长度（一个汉字3个字节）</span><br></pre></td></tr></table></figure>

<p><strong>incr(self, name, amount=1)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 自增 name对应的值，当name不存在时，则创建name＝amount，否则，则自增。</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name,Redis的name</span><br><span class="line">    # amount,自增数（必须是整数）</span><br><span class="line"> </span><br><span class="line"># 注：同incrby</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>incrbyfloat(self, name, amount=1.0)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 自增 name对应的值，当name不存在时，则创建name＝amount，否则，则自增。</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name,Redis的name</span><br><span class="line">    # amount,自增数（浮点型）</span><br></pre></td></tr></table></figure>

<p><strong>decr(self, name, amount=1)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 自减 name对应的值，当name不存在时，则创建name＝amount，否则，则自减。</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name,Redis的name</span><br><span class="line">    # amount,自减数（整数）</span><br></pre></td></tr></table></figure>

<p><strong>append(key, value)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 在redis name对应的值后面追加内容</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    key, redis的name</span><br><span class="line">    value, 要追加的字符串</span><br></pre></td></tr></table></figure>

<h2 id="六-操作之Hash操作"><a href="#六-操作之Hash操作" class="headerlink" title="六 操作之Hash操作"></a>六 操作之Hash操作</h2><p>Hash操作，redis中Hash在内存中的存储格式如下图：</p>
<p><a target="_blank" rel="noopener" href="https://img2018.cnblogs.com/blog/1350514/201810/1350514-20181022195454464-123231904.png"><img src="https://img2018.cnblogs.com/blog/1350514/201810/1350514-20181022195454464-123231904.png" alt="img"></a></p>
<p><strong>hset(name, key, value)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># name对应的hash中设置一个键值对（不存在，则创建；否则，修改）</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis的name</span><br><span class="line">    # key，name对应的hash中的key</span><br><span class="line">    # value，name对应的hash中的value</span><br><span class="line"> </span><br><span class="line"># 注：</span><br><span class="line">    # hsetnx(name, key, value),当name对应的hash中不存在当前key时则创建（相当于添加）</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>hmset(name, mapping)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的hash中批量设置键值对</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis的name</span><br><span class="line">    # mapping，字典，如：&#123;&#x27;k1&#x27;:&#x27;v1&#x27;, &#x27;k2&#x27;: &#x27;v2&#x27;&#125;</span><br><span class="line"> </span><br><span class="line"># 如：</span><br><span class="line">    # r.hmset(&#x27;xx&#x27;, &#123;&#x27;k1&#x27;:&#x27;v1&#x27;, &#x27;k2&#x27;: &#x27;v2&#x27;&#125;)</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>hget(name,key)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的hash中获取根据key获取value</span><br></pre></td></tr></table></figure>

<p><strong>hmget(name, keys, *args)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的hash中获取多个key的值</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name，reids对应的name</span><br><span class="line">    # keys，要获取key集合，如：[&#x27;k1&#x27;, &#x27;k2&#x27;, &#x27;k3&#x27;]</span><br><span class="line">    # *args，要获取的key，如：k1,k2,k3</span><br><span class="line"> </span><br><span class="line"># 如：</span><br><span class="line">    # r.mget(&#x27;xx&#x27;, [&#x27;k1&#x27;, &#x27;k2&#x27;])</span><br><span class="line">    # 或</span><br><span class="line">    # print r.hmget(&#x27;xx&#x27;, &#x27;k1&#x27;, &#x27;k2&#x27;)</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>hgetall(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 获取name对应hash的所有键值</span><br><span class="line">print(re.hgetall(&#x27;xxx&#x27;).get(b&#x27;name&#x27;))</span><br></pre></td></tr></table></figure>

<p><strong>hlen(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取name对应的hash中键值对的个数</span><br></pre></td></tr></table></figure>

<p><strong>hkeys(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取name对应的hash中所有的key的值</span><br></pre></td></tr></table></figure>

<p><strong>hvals(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取name对应的hash中所有的value的值</span><br></pre></td></tr></table></figure>

<p><strong>hexists(name, key)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 检查name对应的hash是否存在当前传入的key</span><br></pre></td></tr></table></figure>

<p><strong>hdel(name,*keys)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将name对应的hash中指定key的键值对删除</span><br><span class="line">print(re.hdel(&#x27;xxx&#x27;,&#x27;sex&#x27;,&#x27;name&#x27;))</span><br></pre></td></tr></table></figure>

<p><strong>hincrby(name, key, amount=1)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 自增name对应的hash中的指定key的值，不存在则创建key=amount</span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis中的name</span><br><span class="line">    # key， hash对应的key</span><br><span class="line">    # amount，自增数（整数）</span><br></pre></td></tr></table></figure>

<p><strong>hincrbyfloat(name, key, amount=1.0)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 自增name对应的hash中的指定key的值，不存在则创建key=amount</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis中的name</span><br><span class="line">    # key， hash对应的key</span><br><span class="line">    # amount，自增数（浮点数）</span><br><span class="line"> </span><br><span class="line"># 自增name对应的hash中的指定key的值，不存在则创建key=amount</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>hscan(name, cursor=0, match=None, count=None)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 增量式迭代获取，对于数据大的数据非常有用，hscan可以实现分片的获取数据，并非一次性将数据全部获取完，从而放置内存被撑爆</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis的name</span><br><span class="line">    # cursor，游标（基于游标分批取获取数据）</span><br><span class="line">    # match，匹配指定key，默认None 表示所有的key</span><br><span class="line">    # count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数</span><br><span class="line"> </span><br><span class="line"># 如：</span><br><span class="line">    # 第一次：cursor1, data1 = r.hscan(&#x27;xx&#x27;, cursor=0, match=None, count=None)</span><br><span class="line">    # 第二次：cursor2, data1 = r.hscan(&#x27;xx&#x27;, cursor=cursor1, match=None, count=None)</span><br><span class="line">    # ...</span><br><span class="line">    # 直到返回值cursor的值为0时，表示数据已经通过分片获取完毕</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>hscan_iter(name, match=None, count=None)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 利用yield封装hscan创建生成器，实现分批去redis中获取数据</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # match，匹配指定key，默认None 表示所有的key</span><br><span class="line">    # count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数</span><br><span class="line"> </span><br><span class="line"># 如：</span><br><span class="line">    # for item in r.hscan_iter(&#x27;xx&#x27;):</span><br><span class="line">    #     print item</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h2 id="七-操作之List操作"><a href="#七-操作之List操作" class="headerlink" title="七 操作之List操作"></a>七 操作之List操作</h2><p>List操作，redis中的List在在内存中按照一个name对应一个List来存储。如图：</p>
<p><a target="_blank" rel="noopener" href="https://img2018.cnblogs.com/blog/1350514/201810/1350514-20181022211822785-370585666.png"><img src="https://img2018.cnblogs.com/blog/1350514/201810/1350514-20181022211822785-370585666.png" alt="img"></a></p>
<p><strong>lpush(name,values)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的list中添加元素，每个新的元素都添加到列表的最左边</span><br><span class="line"> </span><br><span class="line"># 如：</span><br><span class="line">    # r.lpush(&#x27;oo&#x27;, 11,22,33)</span><br><span class="line">    # 保存顺序为: 33,22,11</span><br><span class="line"> </span><br><span class="line"># 扩展：</span><br><span class="line">    # rpush(name, values) 表示从右向左操作</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>lpushx(name,value)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的list中添加元素，只有name已经存在时，值添加到列表的最左边</span><br><span class="line"> </span><br><span class="line"># 更多：</span><br><span class="line">    # rpushx(name, value) 表示从右向左操作</span><br></pre></td></tr></table></figure>

<p><strong>llen(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># name对应的list元素的个数</span><br></pre></td></tr></table></figure>

<p><strong>linsert(name, where, refvalue, value))</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的列表的某一个值前或后插入一个新值</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis的name</span><br><span class="line">    # where，BEFORE或AFTER(小写也可以)</span><br><span class="line">    # refvalue，标杆值，即：在它前后插入数据（如果存在多个标杆值，以找到的第一个为准）</span><br><span class="line">    # value，要插入的数据</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>r.lset(name, index, value)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 对name对应的list中的某一个索引位置重新赋值</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis的name</span><br><span class="line">    # index，list的索引位置</span><br><span class="line">    # value，要设置的值</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>r.lrem(name, value, num)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的list中删除指定的值</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis的name</span><br><span class="line">    # value，要删除的值</span><br><span class="line">    # num，  num=0，删除列表中所有的指定值；</span><br><span class="line">           # num=2,从前到后，删除2个；</span><br><span class="line">           # num=-2,从后向前，删除2个</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>lpop(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的列表的左侧获取第一个元素并在列表中移除，返回值则是第一个元素</span><br><span class="line"> </span><br><span class="line"># 更多：</span><br><span class="line">    # rpop(name) 表示从右向左操作</span><br></pre></td></tr></table></figure>

<p><strong>lindex(name, index)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在name对应的列表中根据索引获取列表元素</span><br></pre></td></tr></table></figure>

<p><strong>lrange(name, start, end)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的列表分片获取数据</span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis的name</span><br><span class="line">    # start，索引的起始位置</span><br><span class="line">    # end，索引结束位置  print(re.lrange(&#x27;aa&#x27;,0,re.llen(&#x27;aa&#x27;)))</span><br></pre></td></tr></table></figure>

<p><strong>ltrim(name, start, end)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的列表中移除没有在start-end索引之间的值</span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis的name</span><br><span class="line">    # start，索引的起始位置</span><br><span class="line">    # end，索引结束位置（大于列表长度，则代表不移除任何）</span><br></pre></td></tr></table></figure>

<p><strong>rpoplpush(src, dst)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 从一个列表取出最右边的元素，同时将其添加至另一个列表的最左边</span><br><span class="line"># 参数：</span><br><span class="line">    # src，要取数据的列表的name</span><br><span class="line">    # dst，要添加数据的列表的name</span><br></pre></td></tr></table></figure>

<p><strong>blpop(keys, timeout)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 将多个列表排列，按照从左到右去pop对应列表的元素</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # keys，redis的name的集合</span><br><span class="line">    # timeout，超时时间，当元素所有列表的元素获取完之后，阻塞等待列表内有数据的时间（秒）, 0 表示永远阻塞</span><br><span class="line"> </span><br><span class="line"># 更多：</span><br><span class="line">    # r.brpop(keys, timeout)，从右向左获取数据爬虫实现简单分布式：多个url放到列表里，往里不停放URL，程序循环取值，但是只能一台机器运行取值，可以把url放到redis中，多台机器从redis中取值，爬取数据，实现简单分布式</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>brpoplpush(src, dst, timeout=0)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 从一个列表的右侧移除一个元素并将其添加到另一个列表的左侧</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # src，取出并要移除元素的列表对应的name</span><br><span class="line">    # dst，要插入元素的列表对应的name</span><br><span class="line">    # timeout，当src对应的列表中没有数据时，阻塞等待其有数据的超时时间（秒），0 表示永远阻塞</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>自定义增量迭代</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 由于redis类库中没有提供对列表元素的增量迭代，如果想要循环name对应的列表的所有元素，那么就需要：</span><br><span class="line">    # 1、获取name对应的所有列表</span><br><span class="line">    # 2、循环列表</span><br><span class="line"># 但是，如果列表非常大，那么就有可能在第一步时就将程序的内容撑爆，所有有必要自定义一个增量迭代的功能：</span><br><span class="line">import redis</span><br><span class="line">conn=redis.Redis(host=&#x27;127.0.0.1&#x27;,port=6379)</span><br><span class="line"># conn.lpush(&#x27;test&#x27;,*[1,2,3,4,45,5,6,7,7,8,43,5,6,768,89,9,65,4,23,54,6757,8,68])</span><br><span class="line"># conn.flushall()</span><br><span class="line">def scan_list(name,count=2):</span><br><span class="line">    index=0</span><br><span class="line">    while True:</span><br><span class="line">        data_list=conn.lrange(name,index,count+index-1)</span><br><span class="line">        if not data_list:</span><br><span class="line">            return</span><br><span class="line">        index+=count</span><br><span class="line">        for item in data_list:</span><br><span class="line">            yield item</span><br><span class="line">print(conn.lrange(&#x27;test&#x27;,0,100))</span><br><span class="line">for item in scan_list(&#x27;test&#x27;,5):</span><br><span class="line">    print(&#x27;---&#x27;)</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h2 id="八-操作之Set操作"><a href="#八-操作之Set操作" class="headerlink" title="八 操作之Set操作"></a>八 操作之Set操作</h2><p>Set操作，Set集合就是不允许重复的列表</p>
<p> <strong>sadd(name,values)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># name对应的集合中添加元素</span><br></pre></td></tr></table></figure>

<p><strong>scard(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">获取name对应的集合中元素个数</span><br></pre></td></tr></table></figure>

<p><strong>sdiff(keys, *args)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在第一个name对应的集合中且不在其他name对应的集合的元素集合</span><br></pre></td></tr></table></figure>

<p><strong>sdiffstore(dest, keys, *args)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取第一个name对应的集合中且不在其他name对应的集合，再将其新加入到dest对应的集合中</span><br></pre></td></tr></table></figure>

<p><strong>sinter(keys, *args)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取多一个name对应集合的并集</span><br></pre></td></tr></table></figure>

<p><strong>sinterstore(dest, keys, *args)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取多一个name对应集合的并集，再讲其加入到dest对应的集合中</span><br></pre></td></tr></table></figure>

<p><strong>sismember(name, value)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 检查value是否是name对应的集合的成员</span><br></pre></td></tr></table></figure>

<p><strong>smembers(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取name对应的集合的所有成员</span><br></pre></td></tr></table></figure>

<p><strong>smove(src, dst, value)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 将某个成员从一个集合中移动到另外一个集合</span><br></pre></td></tr></table></figure>

<p><strong>spop(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 从集合的右侧（尾部）移除一个成员，并将其返回</span><br></pre></td></tr></table></figure>

<p><strong>srandmember(name, numbers)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 从name对应的集合中随机获取 numbers 个元素</span><br></pre></td></tr></table></figure>

<p><strong>srem(name, values)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的集合中删除某些值</span><br></pre></td></tr></table></figure>

<p><strong>srem(name, values)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的集合中删除某些值</span><br></pre></td></tr></table></figure>

<p><strong>sunion(keys, *args)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取多一个name对应的集合的并集</span><br></pre></td></tr></table></figure>

<p><strong>sunionstore(dest,keys, *args)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取多一个name对应的集合的并集，并将结果保存到dest对应的集合中</span><br></pre></td></tr></table></figure>

<p><strong>sscan(name, cursor=0, match=None, count=None)</strong><br><strong>sscan_iter(name, match=None, count=None)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 同字符串的操作，用于增量迭代分批获取元素，避免内存消耗太大</span><br></pre></td></tr></table></figure>

<p><strong>有序集合，在集合的基础上，为每元素排序；元素的排序需要根据另外一个值来进行比较，所以，对于有序集合，每一个元素有两个值，即：值和分数，分数专门用来做排序。</strong></p>
<p> *<em>zadd(name, *args, *<em>kwargs)</em></em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 在name对应的有序集合中添加元素</span><br><span class="line"># 如：</span><br><span class="line">     # zadd(&#x27;zz&#x27;, &#x27;n1&#x27;, 1, &#x27;n2&#x27;, 2)</span><br><span class="line">     # 或</span><br><span class="line">     # zadd(&#x27;zz&#x27;, n1=11, n2=22)</span><br></pre></td></tr></table></figure>

<p><strong>zcard(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取name对应的有序集合元素的数量</span><br></pre></td></tr></table></figure>

<p><strong>zcount(name, min, max)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取name对应的有序集合中分数 在 [min,max] 之间的个数</span><br></pre></td></tr></table></figure>

<p><strong>zincrby(name, value, amount)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 自增name对应的有序集合的 name 对应的分数</span><br></pre></td></tr></table></figure>

<p><strong>r.zrange( name, start, end, desc=False, withscores=False, score_cast_func=float)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 按照索引范围获取name对应的有序集合的元素</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis的name</span><br><span class="line">    # start，有序集合索引起始位置（非分数）</span><br><span class="line">    # end，有序集合索引结束位置（非分数）</span><br><span class="line">    # desc，排序规则，默认按照分数从小到大排序</span><br><span class="line">    # withscores，是否获取元素的分数，默认只获取元素的值</span><br><span class="line">    # score_cast_func，对分数进行数据转换的函数</span><br><span class="line"> </span><br><span class="line"># 更多：</span><br><span class="line">    # 从大到小排序</span><br><span class="line">    # zrevrange(name, start, end, withscores=False, score_cast_func=float)</span><br><span class="line"> </span><br><span class="line">    # 按照分数范围获取name对应的有序集合的元素</span><br><span class="line">    # zrangebyscore(name, min, max, start=None, num=None, withscores=False, score_cast_func=float)</span><br><span class="line">    # 从大到小排序</span><br><span class="line">    # zrevrangebyscore(name, max, min, start=None, num=None, withscores=False, score_cast_func=float)</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>zrank(name, value)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 获取某个值在 name对应的有序集合中的排行（从 0 开始）</span><br><span class="line"> </span><br><span class="line"># 更多：</span><br><span class="line">    # zrevrank(name, value)，从大到小排序</span><br></pre></td></tr></table></figure>

<p><strong>zrangebylex(name, min, max, start=None, num=None)</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 当有序集合的所有成员都具有相同的分值时，有序集合的元素会根据成员的 值 （lexicographical ordering）来进行排序，而这个命令则可以返回给定的有序集合键 key 中， 元素的值介于 min 和 max 之间的成员</span><br><span class="line"># 对集合中的每个成员进行逐个字节的对比（byte-by-byte compare）， 并按照从低到高的顺序， 返回排序后的集合成员。 如果两个字符串有一部分内容是相同的话， 那么命令会认为较长的字符串比较短的字符串要大</span><br><span class="line"> </span><br><span class="line"># 参数：</span><br><span class="line">    # name，redis的name</span><br><span class="line">    # min，左区间（值）。 + 表示正无限； - 表示负无限； ( 表示开区间； [ 则表示闭区间</span><br><span class="line">    # min，右区间（值）</span><br><span class="line">    # start，对结果进行分片处理，索引位置</span><br><span class="line">    # num，对结果进行分片处理，索引后面的num个元素</span><br><span class="line"> </span><br><span class="line"># 如：</span><br><span class="line">    # ZADD myzset 0 aa 0 ba 0 ca 0 da 0 ea 0 fa 0 ga</span><br><span class="line">    # r.zrangebylex(&#x27;myzset&#x27;, &quot;-&quot;, &quot;[ca&quot;) 结果为：[&#x27;aa&#x27;, &#x27;ba&#x27;, &#x27;ca&#x27;]</span><br><span class="line"> </span><br><span class="line"># 更多：</span><br><span class="line">    # 从大到小排序</span><br><span class="line">    # zrevrangebylex(name, max, min, start=None, num=None)</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>zrem(name, values)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 删除name对应的有序集合中值是values的成员</span><br><span class="line"> </span><br><span class="line"># 如：zrem(&#x27;zz&#x27;, [&#x27;s1&#x27;, &#x27;s2&#x27;])</span><br></pre></td></tr></table></figure>

<p><strong>zremrangebyrank(name, min, max)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 根据排行范围删除</span><br></pre></td></tr></table></figure>

<p><strong>zremrangebyscore(name, min, max)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 根据分数范围删除</span><br></pre></td></tr></table></figure>

<p><strong>zremrangebylex(name, min, max)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 根据值返回删除</span><br></pre></td></tr></table></figure>

<p><strong>zscore(name, value)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取name对应有序集合中 value 对应的分数</span><br></pre></td></tr></table></figure>

<p><strong>zinterstore(dest, keys, aggregate=None)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 获取两个有序集合的交集，如果遇到相同值不同分数，则按照aggregate进行操作</span><br><span class="line"># aggregate的值为:  SUM  MIN  MAX</span><br></pre></td></tr></table></figure>

<p><strong>zunionstore(dest, keys, aggregate=None)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 获取两个有序集合的并集，如果遇到相同值不同分数，则按照aggregate进行操作</span><br><span class="line"># aggregate的值为:  SUM  MIN  MAX</span><br></pre></td></tr></table></figure>

<p><strong>zscan(name, cursor=0, match=None, count=None, score_cast_func=float)</strong><br><strong>zscan_iter(name, match=None, count=None,score_cast_func=float)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 同字符串相似，相较于字符串新增score_cast_func，用来对分数进行操作</span><br></pre></td></tr></table></figure>

<h2 id="九-其它操作"><a href="#九-其它操作" class="headerlink" title="九 其它操作"></a>九 其它操作</h2><p><strong>delete(*names)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 根据删除redis中的任意数据类型</span><br></pre></td></tr></table></figure>

<p><strong>exists(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 检测redis的name是否存在</span><br></pre></td></tr></table></figure>

<p><strong>keys(pattern=’*‘)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 根据模型获取redis的name</span><br><span class="line"> </span><br><span class="line"># 更多：</span><br><span class="line">    # KEYS * 匹配数据库中所有 key 。</span><br><span class="line">    # KEYS h?llo 匹配 hello ， hallo 和 hxllo 等。</span><br><span class="line">    # KEYS h*llo 匹配 hllo 和 heeeeello 等。</span><br><span class="line">    # KEYS h[ae]llo 匹配 hello 和 hallo ，但不匹配 hillo </span><br></pre></td></tr></table></figure>

<p><strong>expire(name ,time)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 为某个redis的某个name设置超时时间</span><br></pre></td></tr></table></figure>

<p><strong>rename(src, dst)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 对redis的name重命名为</span><br></pre></td></tr></table></figure>

<p><strong>move(name, db))</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 将redis的某个值移动到指定的db下</span><br></pre></td></tr></table></figure>

<p><strong>randomkey()</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 随机获取一个redis的name（不删除）</span><br></pre></td></tr></table></figure>

<p><strong>type(name)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 获取name对应值的类型</span><br></pre></td></tr></table></figure>

<p><strong>scan(cursor=0, match=None, count=None)</strong><br><strong>scan_iter(match=None, count=None)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 同字符串操作，用于增量迭代获取key</span><br></pre></td></tr></table></figure>

<h2 id="十一-管道"><a href="#十一-管道" class="headerlink" title="十一 管道"></a>十一 管道</h2><p>redis-py默认在执行每次请求都会创建（连接池申请连接）和断开（归还连接池）一次连接操作，如果想要在一次请求中指定多个命令，则可以使用pipline实现一次请求指定多个命令，并且默认情况下一次pipline 是原子性操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import redis</span><br><span class="line"> </span><br><span class="line">pool = redis.ConnectionPool(host=&#x27;10.211.55.4&#x27;, port=6379)</span><br><span class="line"> </span><br><span class="line">r = redis.Redis(connection_pool=pool)</span><br><span class="line"> </span><br><span class="line"># pipe = r.pipeline(transaction=False)</span><br><span class="line">pipe = r.pipeline(transaction=True)</span><br><span class="line">pipe.multi()</span><br><span class="line">pipe.set(&#x27;name&#x27;, &#x27;alex&#x27;)</span><br><span class="line">pipe.set(&#x27;role&#x27;, &#x27;sb&#x27;)</span><br><span class="line"> </span><br><span class="line">pipe.execute()</span><br></pre></td></tr></table></figure>

<h2 id="十二-Django中使用redis"><a href="#十二-Django中使用redis" class="headerlink" title="十二 Django中使用redis"></a>十二 Django中使用redis</h2><p><strong>方式一：</strong></p>
<p>utils文件夹下，建立django_redis_pool.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import redis</span><br><span class="line"></span><br><span class="line">POOL = redis.ConnectionPool(host=&#x27;127.0.0.1&#x27;, port=6379, max_connections=100)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>视图函数中使用：</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import redis</span><br><span class="line">from django.shortcuts import render,HttpResponse</span><br><span class="line">from utils.redis_pool import POOL</span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    conn = redis.Redis(connection_pool=POOL)</span><br><span class="line">    conn.hset(&#x27;kkk&#x27;,&#x27;age&#x27;,18)</span><br><span class="line"></span><br><span class="line">    return HttpResponse(&#x27;设置成功&#x27;)</span><br><span class="line">def order(request):</span><br><span class="line">    conn = redis.Redis(connection_pool=POOL)</span><br><span class="line">    conn.hget(&#x27;kkk&#x27;,&#x27;age&#x27;)</span><br><span class="line"></span><br><span class="line">    return HttpResponse(&#x27;获取成功&#x27;)</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>方式二：</strong></p>
<p>安装django-redis模块</p>
<p>pip3 install django-redis</p>
<p>setting里配置：</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># redis配置</span><br><span class="line">CACHES = &#123;</span><br><span class="line">    &quot;default&quot;: &#123;</span><br><span class="line">        &quot;BACKEND&quot;: &quot;django_redis.cache.RedisCache&quot;,</span><br><span class="line">        &quot;LOCATION&quot;: &quot;redis://127.0.0.1:6379&quot;,</span><br><span class="line">        &quot;OPTIONS&quot;: &#123;</span><br><span class="line">            &quot;CLIENT_CLASS&quot;: &quot;django_redis.client.DefaultClient&quot;,</span><br><span class="line">            &quot;CONNECTION_POOL_KWARGS&quot;: &#123;&quot;max_connections&quot;: 100&#125;</span><br><span class="line">            # &quot;PASSWORD&quot;: &quot;123&quot;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>视图函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from django_redis import get_redis_connection</span><br><span class="line">conn = get_redis_connection(&#x27;default&#x27;)</span><br><span class="line">print(conn.hgetall(&#x27;xxx&#x27;))</span><br></pre></td></tr></table></figure>

<h1 id="celery"><a href="#celery" class="headerlink" title="celery"></a>celery</h1><h2 id="1-celery基本使用"><a href="#1-celery基本使用" class="headerlink" title="1 celery基本使用"></a>1 celery基本使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 写一个py文件 t_celery.py</span><br><span class="line">    <span class="keyword">import</span> celery</span><br><span class="line">    <span class="comment"># 消息中间件（redis）</span></span><br><span class="line">    broker=<span class="string">&#x27;redis://127.0.0.1:6379/1&#x27;</span>     <span class="comment"># 1 表示使用redis 1 这个db</span></span><br><span class="line">    <span class="comment"># 结果存储（redis）</span></span><br><span class="line">    backend=<span class="string">&#x27;redis://127.0.0.1:6379/2&#x27;</span>   <span class="comment"># 2 表示使用redis 2 这个db</span></span><br><span class="line">    <span class="comment"># 实例化得到对象，指定中间件和结果存储</span></span><br><span class="line">    app=celery.Celery(<span class="string">&#x27;test&#x27;</span>,broker=broker,backend=backend)</span><br><span class="line"><span class="meta">    @app.task</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a,b</span>):</span></span><br><span class="line">        <span class="keyword">return</span> a+b</span><br><span class="line"><span class="meta">    @app.task</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">a,b</span>):</span></span><br><span class="line">        <span class="keyword">return</span> a*b</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> 提交任务（在其它文件中）</span><br><span class="line">    <span class="keyword">from</span> t_celery <span class="keyword">import</span> add, mul</span><br><span class="line">    res=add.delay(<span class="number">100</span>,<span class="number">4</span>) </span><br><span class="line">    <span class="built_in">print</span>(res)  <span class="comment"># id号</span></span><br><span class="line">    </span><br><span class="line"><span class="number">3</span> 启动worker</span><br><span class="line">	<span class="comment"># 非windows平台：celery worker -A t_celery -l info</span></span><br><span class="line">    <span class="comment"># windows装eventlet：celery worker -A t_celery -l info -P eventlet</span></span><br><span class="line">    </span><br><span class="line"><span class="number">4</span> 查看执行结果</span><br><span class="line">	<span class="keyword">from</span> t_celery <span class="keyword">import</span> app</span><br><span class="line">    <span class="keyword">from</span> celery.result <span class="keyword">import</span> AsyncResult</span><br><span class="line">    <span class="comment"># 关键字，变量不能定义为关键字</span></span><br><span class="line">    <span class="built_in">id</span> = <span class="string">&#x27;5331c70b-1b51-4a15-aa17-2fa0f7952c00&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">        res = AsyncResult(<span class="built_in">id</span>=<span class="built_in">id</span>, app=app)</span><br><span class="line">        <span class="keyword">if</span> res.successful():</span><br><span class="line">            result = res.get()</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">        <span class="keyword">elif</span> res.failed():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;任务失败&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> res.status == <span class="string">&#x27;PENDING&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;任务等待中被执行&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> res.status == <span class="string">&#x27;RETRY&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;任务异常后正在重试&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> res.status == <span class="string">&#x27;STARTED&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;任务已经开始被执行&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="2-celery多任务结构"><a href="#2-celery多任务结构" class="headerlink" title="2 celery多任务结构"></a>2 celery多任务结构</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">package_celery:     <span class="comment"># 项目名</span></span><br><span class="line">    celery_task     <span class="comment"># celery包名</span></span><br><span class="line">        __init__.py </span><br><span class="line">        celery.py   <span class="comment"># celery 的app，必须叫celery</span></span><br><span class="line">        order_task.py <span class="comment"># 任务</span></span><br><span class="line">        user_task.py  <span class="comment"># 任务</span></span><br><span class="line">    result.py         <span class="comment"># 结果查询</span></span><br><span class="line">    submit_tast.py    <span class="comment"># 提交任务</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># celery.py</span></span><br><span class="line">	<span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"></span><br><span class="line">    broker = <span class="string">&#x27;redis://127.0.0.1:6379/1&#x27;</span></span><br><span class="line">    backend = <span class="string">&#x27;redis://127.0.0.1:6379/2&#x27;</span></span><br><span class="line">    app = Celery(<span class="string">&#x27;test&#x27;</span>, broker=broker, backend=backend, include=[<span class="string">&#x27;celery_task.order_task&#x27;</span>, <span class="string">&#x27;celery_task.user_task&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># submit_task.py</span></span><br><span class="line">    <span class="comment"># 运行worker（在package_celery目录下执行）</span></span><br><span class="line">        celery worker -A celery_task -l info -P eventlet</span><br><span class="line">    <span class="comment"># 提交任务</span></span><br><span class="line">        <span class="keyword">from</span> celery_task <span class="keyword">import</span> order_task,user_task</span><br><span class="line">        <span class="comment"># 提交一个给用户发短信的任务</span></span><br><span class="line">        res=user_task.send_sms.delay(<span class="string">&#x27;18723454566&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(res)</span><br><span class="line">        <span class="comment"># 提交一个取消订单任务</span></span><br><span class="line">        res=order_task.cancel_order.delay()</span><br><span class="line">        <span class="built_in">print</span>(res)</span><br><span class="line"><span class="comment"># result.py</span></span><br><span class="line">	<span class="keyword">from</span> celery_task.celery <span class="keyword">import</span> app</span><br><span class="line">    <span class="keyword">from</span> celery.result <span class="keyword">import</span> AsyncResult</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关键字，变量不能定义为关键字</span></span><br><span class="line">    <span class="comment"># 发短信任务： 0b46e91b-f1a6-498b-854d-944efe6e87f3</span></span><br><span class="line">    <span class="comment"># 取消订单任务：d9cd67db-ddbf-4bd9-b3ab-1b10c7ec28b1</span></span><br><span class="line">    <span class="built_in">id</span> = <span class="string">&#x27;bda2a1a4-29e6-4e2c-8a84-f94b874e37bb&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">        res = AsyncResult(<span class="built_in">id</span>=<span class="built_in">id</span>, app=app)</span><br><span class="line">        <span class="keyword">if</span> res.successful():</span><br><span class="line">            result = res.get()</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">        <span class="keyword">elif</span> res.failed():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;任务失败&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> res.status == <span class="string">&#x27;PENDING&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;任务等待中被执行&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> res.status == <span class="string">&#x27;RETRY&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;任务异常后正在重试&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> res.status == <span class="string">&#x27;STARTED&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;任务已经开始被执行&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 真实应用场景</span></span><br><span class="line">	-秒杀系统</span><br><span class="line">    	-不能秒超，使用锁（mysql悲观锁，乐观锁），redis锁</span><br><span class="line">        -提高并发量---》把同步做成异步---》使用celery</span><br><span class="line">        	-前端点击秒杀按钮，向后端发送秒杀请求---》同步操作</span><br><span class="line">            	-同步操作</span><br><span class="line">                    -请求来到后端，判断数量是否够，如果够，要生成订单（mysql），订单状态是待支付状					态						</span><br><span class="line">                    -请求返回，告诉前端，秒杀成功</span><br><span class="line">                -异步操作</span><br><span class="line">                	-请求来到后端，提交一个celery任务---》celery任务异步的执行判断数量是否够，如						果够，要生成订单（mysql）</span><br><span class="line">                    -秒杀是否成功的结果还没有，直接返回了（返回任务<span class="built_in">id</span>）</span><br><span class="line">                    -前端启动一个定时任务，每隔5s，向后台发送一个查询请求，查询秒杀任务是否执行完                     成（带着任务<span class="built_in">id</span>查）</span><br><span class="line">                    -如果是未执行状态，或者执行中---》返回给前端，前端不处理，定时任务继续执行</span><br><span class="line">                    -又隔了5s，发送查询，查询到秒杀成功的结果，返回给前端，秒杀成功</span><br></pre></td></tr></table></figure>

<h2 id="3-高级使用之延时任务"><a href="#3-高级使用之延时任务" class="headerlink" title="3 高级使用之延时任务"></a>3 高级使用之延时任务</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery_task <span class="keyword">import</span> user_task</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交一个给用户发短信的任务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res = user_task.send_sms.delay(&#x27;18723454566&#x27;)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># # 提交一个取消订单任务</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># res = order_task.cancel_order.delay()</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># celery执行延时任务</span></span><br><span class="line"><span class="comment">## 第一种方式：2021年1月7日17点3分12秒发送短信</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># # eta:延迟多长时间执行，eta需要传时间对象,并且是utc时间</span></span><br><span class="line"><span class="comment"># v1 = datetime(2021, 1, 7, 22, 35, 00)</span></span><br><span class="line"><span class="comment"># print(v1)</span></span><br><span class="line"><span class="comment"># v2 = datetime.utcfromtimestamp(v1.timestamp())</span></span><br><span class="line"><span class="comment"># print(v2)</span></span><br><span class="line"><span class="comment"># res = user_task.send_sms.apply_async(args=[&#x27;15194683767&#x27;], eta=v2)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 第二种方式：隔几秒后执行</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"></span><br><span class="line">ctime = datetime.now()</span><br><span class="line"><span class="comment"># 默认使用utc事件</span></span><br><span class="line">utc_time = datetime.utcfromtimestamp(ctime.timestamp())</span><br><span class="line">time_delay = timedelta(seconds=<span class="number">5</span>)</span><br><span class="line">task_time = utc_time + time_delay  <span class="comment"># 往后延迟10s的时间</span></span><br><span class="line"><span class="built_in">print</span>(task_time)</span><br><span class="line">res = user_task.send_sms.apply_async(args=[<span class="string">&#x27;15194683767&#x27;</span>], eta=task_time)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-高级使用之定时任务"><a href="#4-高级使用之定时任务" class="headerlink" title="4 高级使用之定时任务"></a>4 高级使用之定时任务</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在celery.py中配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 时区</span></span><br><span class="line">app.conf.timezone = <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="comment"># 是否使用UTC</span></span><br><span class="line">app.conf.enable_utc = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 任务的定时配置</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="keyword">from</span> celery.schedules <span class="keyword">import</span> crontab</span><br><span class="line"></span><br><span class="line">app.conf.beat_schedule = &#123;</span><br><span class="line">    <span class="string">&#x27;send-msg&#x27;</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;task&#x27;</span>: <span class="string">&#x27;celery_task.user_task.send_sms&#x27;</span>,</span><br><span class="line">        <span class="comment"># &#x27;schedule&#x27;: timedelta(hours=24*10),</span></span><br><span class="line">        <span class="comment"># &#x27;schedule&#x27;: crontab(hour=8, day_of_week=1),  # 每周一早八点</span></span><br><span class="line">        <span class="string">&#x27;schedule&#x27;</span>: crontab(hour=<span class="number">8</span>, day_of_month=<span class="number">1</span>),  <span class="comment"># 每月一号早八点</span></span><br><span class="line">        <span class="string">&#x27;args&#x27;</span>: (<span class="string">&#x27;18964352112&#x27;</span>,),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动beat，负责每隔3s提交一个任务</span></span><br><span class="line">celery beat -A celery_task -l info</span><br><span class="line"><span class="comment"># 启动worker</span></span><br><span class="line">celery worker -A celery_task -l info -P eventlet</span><br></pre></td></tr></table></figure>

<h2 id="5-django中使用celery"><a href="#5-django中使用celery" class="headerlink" title="5 django中使用celery"></a>5 django中使用celery</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> celery是独立的，跟框架没有关系</span><br><span class="line"><span class="number">2</span> django-celery第三方模块，兼容性不好，咱们不采用，咱们使用通用方式</span><br><span class="line"><span class="number">3</span> 目录</span><br><span class="line">	celery_task</span><br><span class="line">    	__init__.py</span><br><span class="line">        celery.py</span><br><span class="line">        home_task.py</span><br><span class="line">        order_task.py</span><br><span class="line">        user_task.py</span><br><span class="line">	luffyapi</span><br></pre></td></tr></table></figure>

<h3 id="view-py"><a href="#view-py" class="headerlink" title="view.py"></a>view.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery_task <span class="keyword">import</span> user_task</span><br><span class="line"><span class="keyword">from</span> celery_task.celery <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">from</span> celery.result <span class="keyword">import</span> AsyncResult</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_celery</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = request.GET.get(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">id</span>:</span><br><span class="line">        res = AsyncResult(<span class="built_in">id</span>=<span class="built_in">id</span>, app=app)</span><br><span class="line">        <span class="keyword">if</span> res.successful():</span><br><span class="line">            result = res.get()</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;执行完成了，结果是：%s&#x27;</span> % result)</span><br><span class="line"></span><br><span class="line">    res = user_task.send_sms.delay(<span class="string">&#x27;15194683767&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;任务号%s&#x27;</span> % <span class="built_in">str</span>(res))</span><br></pre></td></tr></table></figure>

<h3 id="urls-py"><a href="#urls-py" class="headerlink" title="urls.py"></a>urls.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">&#x27;test_celery&#x27;</span>, views.test_celery)</span><br></pre></td></tr></table></figure>

<h3 id="user-task-py"><a href="#user-task-py" class="headerlink" title="user_task.py"></a>user_task.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .celery <span class="keyword">import</span> app</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_sms</span>(<span class="params">phone</span>):</span></span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s短信发送成功&#x27;</span> % phone)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%s短信发送成功&#x27;</span> % phone</span><br></pre></td></tr></table></figure>

<h2 id="6-celery应用首页轮播图接口和定时更新"><a href="#6-celery应用首页轮播图接口和定时更新" class="headerlink" title="6 celery应用首页轮播图接口和定时更新"></a>6 celery应用首页轮播图接口和定时更新</h2><h3 id="home-view-py"><a href="#home-view-py" class="headerlink" title="home/view.py"></a>home/view.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> GenericViewSet</span><br><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> ListModelMixin</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> serializer</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BannerView</span>(<span class="params">GenericViewSet, ListModelMixin</span>):</span></span><br><span class="line">    queryset = models.Banner.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>, is_show=<span class="literal">True</span>, ).order_by(<span class="string">&#x27;-orders&#x27;</span>)[:settings.BANNER]</span><br><span class="line">    serializer_class = serializer.BannerSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 改成，先从缓存中取，缓存中如果有，直接返回，没有，再去数据库查</span></span><br><span class="line">    <span class="comment"># 重写list方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        banner_data = cache.get(<span class="string">&#x27;banner_data&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> banner_data:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;走了缓存&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> Response(data=banner_data)</span><br><span class="line">        <span class="comment"># 如果缓存中没有，再走数据，查出来，放到缓存中</span></span><br><span class="line">        res = <span class="built_in">super</span>().<span class="built_in">list</span>(request, *args, **kwargs)</span><br><span class="line">        <span class="comment"># 把首页轮播图放到缓存中</span></span><br><span class="line">        cache.<span class="built_in">set</span>(<span class="string">&#x27;banner_data&#x27;</span>, res.data)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;没走缓存&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="celery-py"><a href="#celery-py" class="headerlink" title="celery.py"></a>celery.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;luffyapi.settings.dev&quot;</span>)</span><br><span class="line">broker = <span class="string">&#x27;redis://127.0.0.1:6379/1&#x27;</span></span><br><span class="line">backend = <span class="string">&#x27;redis://127.0.0.1:6379/2&#x27;</span></span><br><span class="line">app = Celery(broker=broker, backend=backend,</span><br><span class="line">             include=[<span class="string">&#x27;celery_task.order_task&#x27;</span>, <span class="string">&#x27;celery_task.user_task&#x27;</span>, <span class="string">&#x27;celery_task.home_task&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 时区</span></span><br><span class="line">app.conf.timezone = <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="comment"># 是否使用UTC</span></span><br><span class="line">app.conf.enable_utc = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 任务的定时配置</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="keyword">from</span> celery.schedules <span class="keyword">import</span> crontab</span><br><span class="line"></span><br><span class="line">app.conf.beat_schedule = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;update_banner&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;task&#x27;</span>: <span class="string">&#x27;celery_task.home_task.update_banner&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;schedule&#x27;</span>: timedelta(seconds=<span class="number">10</span>),</span><br><span class="line">        <span class="comment"># &#x27;schedule&#x27;: crontab(hour=8, day_of_week=1),  # 每周一早八点</span></span><br><span class="line">        <span class="comment"># &#x27;schedule&#x27;: crontab(hour=8, day_of_month=1),  # 每月一号早八点</span></span><br><span class="line">        <span class="string">&#x27;args&#x27;</span>: (),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="home-task-py"><a href="#home-task-py" class="headerlink" title="home_task.py"></a>home_task.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .celery <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">from</span> home <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> home.serializer <span class="keyword">import</span> BannerSerializer</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.task()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_banner</span>():</span></span><br><span class="line">    banners = models.Banner.objects.<span class="built_in">filter</span>(is_delete=<span class="literal">False</span>, is_show=<span class="literal">True</span>).order_by(<span class="string">&#x27;-orders&#x27;</span>)[:settings.BANNER]</span><br><span class="line">    serializer = BannerSerializer(instance=banners, many=<span class="literal">True</span>)</span><br><span class="line">    banner_data = serializer.data</span><br><span class="line">    <span class="keyword">for</span> banner <span class="keyword">in</span> banner_data:</span><br><span class="line">        banner[<span class="string">&#x27;image&#x27;</span>] = <span class="string">&#x27;http://127.0.0.1:8000%s&#x27;</span> % banner[<span class="string">&#x27;image&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    cache.<span class="built_in">set</span>(<span class="string">&#x27;banner_data&#x27;</span>, banner_data)  <span class="comment"># 放到缓存中</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="1-七牛云对象存储托管视频"><a href="#1-七牛云对象存储托管视频" class="headerlink" title="1 七牛云对象存储托管视频"></a>1 七牛云对象存储托管视频</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from qiniu import Auth, put_file, etag</span></span><br><span class="line"><span class="comment"># import qiniu.config</span></span><br><span class="line"><span class="comment"># #需要填写你的 Access Key 和 Secret Key</span></span><br><span class="line"><span class="comment"># access_key = &#x27;-BoMxfk8dxgDq87mA-qLkgmI_AHYfF27tOFan_NJ&#x27;</span></span><br><span class="line"><span class="comment"># secret_key = &#x27;Wijh6Fg6gedtBqoqKElkxrrlySoiVWbFSfQ6I-qM&#x27;</span></span><br><span class="line"><span class="comment"># #构建鉴权对象</span></span><br><span class="line"><span class="comment"># q = Auth(access_key, secret_key)</span></span><br><span class="line"><span class="comment"># #要上传的空间</span></span><br><span class="line"><span class="comment"># bucket_name = &#x27;lqz&#x27;</span></span><br><span class="line"><span class="comment"># #上传后保存的文件名</span></span><br><span class="line"><span class="comment"># key = &#x27;lqz.mp4&#x27;</span></span><br><span class="line"><span class="comment"># #生成上传 Token，可以指定过期时间等</span></span><br><span class="line"><span class="comment"># token = q.upload_token(bucket_name, key, 3600)</span></span><br><span class="line"><span class="comment"># #要上传文件的本地路径</span></span><br><span class="line"><span class="comment"># localfile = &#x27;./6-测试功能.mp4&#x27;</span></span><br><span class="line"><span class="comment"># ret, info = put_file(token, key, localfile)</span></span><br><span class="line"><span class="comment"># print(info)</span></span><br><span class="line"><span class="comment"># assert ret[&#x27;key&#x27;] == key</span></span><br><span class="line"><span class="comment"># assert ret[&#x27;hash&#x27;] == etag(localfile)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除视频</span></span><br><span class="line"><span class="comment"># from qiniu import Auth</span></span><br><span class="line"><span class="comment"># from qiniu import BucketManager</span></span><br><span class="line"><span class="comment"># access_key = &#x27;-BoMxfk8dxgDq87mA-qLkgmI_AHYfF27tOFan_NJ&#x27;</span></span><br><span class="line"><span class="comment"># secret_key = &#x27;Wijh6Fg6gedtBqoqKElkxrrlySoiVWbFSfQ6I-qM&#x27;</span></span><br><span class="line"><span class="comment"># #初始化Auth状态</span></span><br><span class="line"><span class="comment"># q = Auth(access_key, secret_key)</span></span><br><span class="line"><span class="comment"># #初始化BucketManager</span></span><br><span class="line"><span class="comment"># bucket = BucketManager(q)</span></span><br><span class="line"><span class="comment"># #你要测试的空间， 并且这个key在你空间中存在</span></span><br><span class="line"><span class="comment"># bucket_name = &#x27;lqz&#x27;</span></span><br><span class="line"><span class="comment"># key = &#x27;lqz.mp4&#x27;</span></span><br><span class="line"><span class="comment"># #删除bucket_name 中的文件 key</span></span><br><span class="line"><span class="comment"># ret, info = bucket.delete(bucket_name, key)</span></span><br><span class="line"><span class="comment"># print(info)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># res=requests.get(&#x27;https://vd3.bdstatic.com/mda-kkena9xzt4hmb7b7/sc/cae_h264_clips/1605430730/mda-kkena9xzt4hmb7b7.mp4?auth_key=1610529585-0-0-14a58ce4cca097b0a5c823cc506d95da&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;pt=3&amp;abtest=8656_1&#x27;)</span></span><br><span class="line"><span class="comment"># with open(&#x27;致命诱惑.mp4&#x27;,&#x27;wb&#x27;) as f:</span></span><br><span class="line"><span class="comment">#     for line in res.iter_content():</span></span><br><span class="line"><span class="comment">#         f.write(line)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">通过该程序下载的视频和音频是分成连个文件的，没有合成，</span></span><br><span class="line"><span class="string">视频为：视频名_video.mp4</span></span><br><span class="line"><span class="string">音频为：视频名_audio.mp4</span></span><br><span class="line"><span class="string">修改url的值，换成自己想下载的页面节课</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入requests模块，模拟发送请求</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># 导入json</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment"># 导入re</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义请求头</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;*/*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;en-US,en;q=0.5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正则表达式，根据条件匹配出值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_match</span>(<span class="params">text, pattern</span>):</span></span><br><span class="line">    match = re.search(pattern, text)</span><br><span class="line">    <span class="built_in">print</span>(match.group(<span class="number">1</span>))</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="keyword">return</span> json.loads(match.group(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_video</span>(<span class="params">old_video_url, video_url, audio_url, video_name</span>):</span></span><br><span class="line">    headers.update(&#123;<span class="string">&quot;Referer&quot;</span>: old_video_url&#125;)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始下载视频：%s&quot;</span> % video_name)</span><br><span class="line">    video_content = requests.get(video_url, headers=headers)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s视频大小：&#x27;</span> % video_name, video_content.headers[<span class="string">&#x27;content-length&#x27;</span>])</span><br><span class="line">    audio_content = requests.get(audio_url, headers=headers)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s音频大小：&#x27;</span> % video_name, audio_content.headers[<span class="string">&#x27;content-length&#x27;</span>])</span><br><span class="line">    <span class="comment"># 下载视频开始</span></span><br><span class="line">    received_video = <span class="number">0</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;%s_video.mp4&#x27;</span> % video_name, <span class="string">&#x27;ab&#x27;</span>) <span class="keyword">as</span> output:</span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">int</span>(video_content.headers[<span class="string">&#x27;content-length&#x27;</span>]) &gt; received_video:</span><br><span class="line">            headers[<span class="string">&#x27;Range&#x27;</span>] = <span class="string">&#x27;bytes=&#x27;</span> + <span class="built_in">str</span>(received_video) + <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            response = requests.get(video_url, headers=headers)</span><br><span class="line">            output.write(response.content)</span><br><span class="line">            received_video += <span class="built_in">len</span>(response.content)</span><br><span class="line">    <span class="comment"># 下载视频结束</span></span><br><span class="line">    <span class="comment"># 下载音频开始</span></span><br><span class="line">    audio_content = requests.get(audio_url, headers=headers)</span><br><span class="line">    received_audio = <span class="number">0</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;%s_audio.mp4&#x27;</span> % video_name, <span class="string">&#x27;ab&#x27;</span>) <span class="keyword">as</span> output:</span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">int</span>(audio_content.headers[<span class="string">&#x27;content-length&#x27;</span>]) &gt; received_audio:</span><br><span class="line">            <span class="comment"># 视频分片下载</span></span><br><span class="line">            headers[<span class="string">&#x27;Range&#x27;</span>] = <span class="string">&#x27;bytes=&#x27;</span> + <span class="built_in">str</span>(received_audio) + <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            response = requests.get(audio_url, headers=headers)</span><br><span class="line">            output.write(response.content)</span><br><span class="line">            received_audio += <span class="built_in">len</span>(response.content)</span><br><span class="line">    <span class="comment"># 下载音频结束</span></span><br><span class="line">    <span class="keyword">return</span> video_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 换成你要爬取的视频地址</span></span><br><span class="line">    url = <span class="string">&#x27;https://www.bilibili.com/video/BV1TA411H7gQ&#x27;</span></span><br><span class="line">    <span class="comment"># 发送请求，拿回数据</span></span><br><span class="line">    res = requests.get(url, headers=headers)</span><br><span class="line">    <span class="comment"># 视频详情json</span></span><br><span class="line">    playinfo = my_match(res.text, <span class="string">&#x27;__playinfo__=(.*?)&lt;/script&gt;&lt;script&gt;&#x27;</span>)</span><br><span class="line">    <span class="comment"># 视频内容json</span></span><br><span class="line">    initial_state = my_match(res.text, <span class="string">r&#x27;__INITIAL_STATE__=(.*?);\(function\(\)&#x27;</span>)</span><br><span class="line">    <span class="comment"># 视频分多种格式，直接取分辨率最高的视频 1080p</span></span><br><span class="line">    video_url = playinfo[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;dash&#x27;</span>][<span class="string">&#x27;video&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;baseUrl&#x27;</span>]</span><br><span class="line">    <span class="comment"># 取出音频地址</span></span><br><span class="line">    audio_url = playinfo[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;dash&#x27;</span>][<span class="string">&#x27;audio&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;baseUrl&#x27;</span>]</span><br><span class="line">    video_name = initial_state[<span class="string">&#x27;videoData&#x27;</span>][<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;视频名字为：video_name&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;视频地址为：&#x27;</span>, video_url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;音频地址为：&#x27;</span>, audio_url)</span><br><span class="line">    download_video(url, video_url, audio_url, video_name)</span><br></pre></td></tr></table></figure>

<h1 id="项目上线"><a href="#项目上线" class="headerlink" title="项目上线"></a>项目上线</h1><h2 id="1-购买云服务器"><a href="#1-购买云服务器" class="headerlink" title="1.购买云服务器"></a>1.购买云服务器</h2><h2 id="2-将前端项目build"><a href="#2-将前端项目build" class="headerlink" title="2. 将前端项目build"></a>2. 将前端项目build</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>npm run build</span><br><span class="line"><span class="number">2.</span>远程连接阿里云的服务器<span class="number">47.116</span><span class="number">.138</span><span class="number">.170</span></span><br><span class="line"><span class="number">3.</span>$ scp -r dist root@<span class="number">47.116</span><span class="number">.138</span><span class="number">.170</span>:~ 将项目传到服务器（在git窗口运行）</span><br><span class="line"><span class="number">3.1</span> &gt;: mv dist /home/html(在shell窗口运行)</span><br><span class="line"><span class="number">4.</span>更新系统软件包</span><br><span class="line">	&gt;: yum update -y</span><br><span class="line"><span class="number">5.</span>安装软件管理包和可能使用的依赖</span><br><span class="line">	&gt;: yum install openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel psmisc libffi-devel</span><br><span class="line">     &gt;: yum -y groupinstall <span class="string">&quot;Development tools&quot;</span></span><br><span class="line"> <span class="number">6.</span>检测是否成功：会将git作为依赖安装号</span><br><span class="line">	 &gt;: git</span><br></pre></td></tr></table></figure>

<h2 id="3-安装Mysql"><a href="#3-安装Mysql" class="headerlink" title="3.安装Mysql"></a>3.安装Mysql</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）前往用户根目录</span><br><span class="line">&gt;: cd ~</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）下载mysql57</span><br><span class="line">&gt;: wget http://dev.mysql.com/get/mysql57-community-release-el7-<span class="number">10.</span>noarch.rpm</span><br><span class="line"></span><br><span class="line">也可以本地上传，这条命令要在本地终端上执行</span><br><span class="line">&gt;: scp -r C:mysql57-community-release-el7-<span class="number">10.</span>noarch.rpm root@<span class="number">39.99</span><span class="number">.192</span><span class="number">.127</span>:~</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>）安装mysql57</span><br><span class="line">&gt;: yum -y install mysql57-community-release-el7-<span class="number">10.</span>noarch.rpm</span><br><span class="line">&gt;: yum -y install mysql-community-server</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>）启动mysql57并查看启动状态</span><br><span class="line">&gt;: systemctl start mysqld.service</span><br><span class="line">&gt;: systemctl status mysqld.service</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>）查看默认密码并登录</span><br><span class="line">&gt;: grep <span class="string">&quot;password&quot;</span> /var/log/mysqld.log</span><br><span class="line">&gt;: mysql -uroot -p</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>）修改密码</span><br><span class="line">&gt;: ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;Liuhaojie123456?&#x27;</span>;</span><br><span class="line">    ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;10.21.6.12&#x27;</span> IDENTIFIED BY <span class="string">&#x27;Fod123456?&#x27;</span>;</span><br><span class="line">    </span><br><span class="line"><span class="number">1</span>）管理员连接数据库</span><br><span class="line">&gt;: mysql -uroot -Liuhaojie123456?</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）创建数据库</span><br><span class="line">&gt;: create database luffy default charset=utf8;</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>）设置权限账号密码：账号密码要与项目中配置的一致</span><br><span class="line">&gt;: grant <span class="built_in">all</span> privileges on luffy.* to <span class="string">&#x27;luffy&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;Liu199556?&#x27;</span>;</span><br><span class="line">&gt;: grant <span class="built_in">all</span> privileges on luffy.* to <span class="string">&#x27;luffy&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;Liu199556?&#x27;</span>; <span class="comment"># 本地127.0.0.1 可以链接</span></span><br><span class="line">&gt;: flush privileges;</span><br><span class="line">    </span><br><span class="line">grant <span class="built_in">all</span> privileges on *.* to <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;10.21.6.11&#x27;</span> identified by <span class="string">&#x27;Foda123456?&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="number">4</span>）退出mysql</span><br><span class="line">&gt;: quit;</span><br></pre></td></tr></table></figure>

<h2 id="4-安装Redis"><a href="#4-安装Redis" class="headerlink" title="4.安装Redis"></a>4.安装Redis</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）前往用户根目录</span><br><span class="line">&gt;: cd ~</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）下载redis-<span class="number">5.0</span><span class="number">.5</span></span><br><span class="line">&gt;: wget http://download.redis.io/releases/redis-<span class="number">5.0</span><span class="number">.5</span>.tar.gz</span><br><span class="line">&gt;: scp -r C:\Users\dell\Desktop\pkg\redis-<span class="number">5.0</span><span class="number">.5</span>.tar.gz root@<span class="number">39.99</span><span class="number">.192</span><span class="number">.127</span>:~</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>）解压安装包</span><br><span class="line">&gt;: tar -xf redis-<span class="number">5.0</span><span class="number">.5</span>.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>）进入目标文件</span><br><span class="line">&gt;: cd redis-<span class="number">5.0</span><span class="number">.5</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span>）编译环境</span><br><span class="line">&gt;: make</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>）复制环境到指定路径完成安装</span><br><span class="line">&gt;: cp -r ~/redis-<span class="number">5.0</span><span class="number">.5</span> /usr/local/redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">9</span>）建立软连接</span><br><span class="line">&gt;: ln -s /usr/local/redis/src/redis-server /usr/<span class="built_in">bin</span>/redis-server</span><br><span class="line">&gt;: ln -s /usr/local/redis/src/redis-cli /usr/<span class="built_in">bin</span>/redis-cli</span><br><span class="line"></span><br><span class="line"><span class="number">10</span>）后台运行redis</span><br><span class="line">&gt;: cd /usr/local/redis</span><br><span class="line">&gt;: redis-server &amp;</span><br><span class="line"></span><br><span class="line">ctrl + c 停止</span><br><span class="line"></span><br><span class="line"><span class="number">11</span>）测试redis环境</span><br><span class="line">&gt;: redis-cli</span><br><span class="line">ctrl + c</span><br><span class="line"></span><br><span class="line"><span class="number">12</span>）关闭redis服务</span><br><span class="line">&gt;: pkill -f redis -<span class="number">9</span></span><br></pre></td></tr></table></figure>

<h2 id="5-安装python"><a href="#5-安装python" class="headerlink" title="5.安装python"></a>5.安装python</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）前往用户根目录</span><br><span class="line">&gt;: cd ~</span><br><span class="line">&gt;: yum install zlib-devel bzip2-devel  openssl-devel ncurses-devel  <span class="comment"># 安装依赖</span></span><br><span class="line"><span class="number">2</span>）下载 或 上传 Python3<span class="number">.6</span><span class="number">.7</span></span><br><span class="line"><span class="comment"># 服务器终端</span></span><br><span class="line">&gt;: wget https://www.python.org/ftp/python/<span class="number">3.6</span><span class="number">.7</span>/Python-<span class="number">3.6</span><span class="number">.7</span>.tar.xz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地终端，给服务器上传</span></span><br><span class="line">&gt;: scp -r 本地Python-<span class="number">3.6</span><span class="number">.7</span>.tar.xz ssh root@<span class="number">39.99</span><span class="number">.192</span><span class="number">.127</span>:服务器路径</span><br><span class="line">&gt;: scp -r C:\Users\dell\Desktop\pkg\Python-<span class="number">3.6</span><span class="number">.7</span>.tar.xz ssh root@<span class="number">39.99</span><span class="number">.192</span><span class="number">.127</span>~</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>）解压安装包</span><br><span class="line">&gt;: tar -xf Python-<span class="number">3.6</span><span class="number">.7</span>.tar.xz</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>）进入目标文件</span><br><span class="line">&gt;: cd Python-<span class="number">3.6</span><span class="number">.7</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span>）配置安装路径：mkdir /usr/local/python3</span><br><span class="line">&gt;: ./configure --prefix=/usr/local/python3 <span class="comment"># 如果报错</span></span><br><span class="line">	yum install gcc -y  <span class="comment"># 安装gcc编译工具</span></span><br><span class="line"></span><br><span class="line"><span class="number">6</span>）编译并安装</span><br><span class="line">&gt;: make &amp;&amp; sudo make install</span><br><span class="line"></span><br><span class="line"><span class="number">7</span>）建立软连接：终端命令 python3，pip3</span><br><span class="line">&gt;: ls -l /usr/<span class="built_in">bin</span> | grep python <span class="comment">#查看软连接</span></span><br><span class="line">&gt;: ln -s /usr/local/python3/<span class="built_in">bin</span>/python3<span class="number">.6</span> /usr/<span class="built_in">bin</span>/python3</span><br><span class="line">&gt;: ln -s /usr/local/python3/<span class="built_in">bin</span>/pip3<span class="number">.6</span> /usr/<span class="built_in">bin</span>/pip3</span><br><span class="line"></span><br><span class="line"><span class="number">8</span>）删除安装包与文件：</span><br><span class="line">&gt;: rm -rf Python-<span class="number">3.6</span><span class="number">.7</span></span><br><span class="line">&gt;: rm -rf Python-<span class="number">3.6</span><span class="number">.7</span>.tar.xz</span><br></pre></td></tr></table></figure>

<h2 id="6-安装nginx"><a href="#6-安装nginx" class="headerlink" title="6.安装nginx"></a>6.安装nginx</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）前往用户根目录</span><br><span class="line">&gt;: cd ~</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）下载nginx1<span class="number">.13</span><span class="number">.7</span></span><br><span class="line">&gt;: wget http://nginx.org/download/nginx-<span class="number">1.13</span><span class="number">.7</span>.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>）解压安装包</span><br><span class="line">&gt;: tar -xf nginx-<span class="number">1.13</span><span class="number">.7</span>.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>）进入目标文件</span><br><span class="line">&gt;: cd nginx-<span class="number">1.13</span><span class="number">.7</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span>）配置安装路径：/usr/local/nginx</span><br><span class="line">&gt;: yum -y install gcc pcre-devel zlib-devel openssl openssl-devel </span><br><span class="line">&gt;: ./configure --prefix=/usr/local/nginx</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>）编译并安装</span><br><span class="line">&gt;: make &amp;&amp; sudo make install</span><br><span class="line"></span><br><span class="line"><span class="number">7</span>）建立软连接：终端命令 nginx</span><br><span class="line">&gt;: ln -s /usr/local/nginx/sbin/nginx /usr/<span class="built_in">bin</span>/nginx</span><br><span class="line"></span><br><span class="line"><span class="number">8</span>）删除安装包与文件：</span><br><span class="line">&gt;: cd ~</span><br><span class="line">&gt;: rm -rf nginx-<span class="number">1.13</span><span class="number">.7</span></span><br><span class="line">&gt;: rm -rf nginx-<span class="number">1.13</span><span class="number">.7</span>.tar.xz</span><br><span class="line"></span><br><span class="line"><span class="number">9</span>）测试Nginx环境，服务器运行nginx，本地访问服务器ip</span><br><span class="line">&gt;: nginx</span><br><span class="line">&gt;: 服务器绑定的域名 或 ip:<span class="number">80</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Nginx命令</span></span><br><span class="line"><span class="number">1</span>）启动</span><br><span class="line">&gt;: nginx</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）关闭nginx</span><br><span class="line">&gt;: nginx -s stop</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>）重启nginx</span><br><span class="line">&gt;: nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>）查看端口，强行关闭</span><br><span class="line">&gt;: ps -aux|grep nginx</span><br><span class="line">&gt;: kill &lt;pid:进程编号&gt;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">	Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器</span><br><span class="line">	Apache和Nginx最核心的区别在于 apache 是同步多进程模型，一个连接对应一个进程；而 nginx 是异步的，多个连接（万级别）可以对应一个进程</span><br><span class="line">    </span><br><span class="line">   http请求转发</span><br><span class="line">   反向代理服务器</span><br><span class="line">   负载均衡</span><br><span class="line">   动静分离</span><br></pre></td></tr></table></figure>

<h2 id="7-上线"><a href="#7-上线" class="headerlink" title="7.上线"></a>7.上线</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># 本地终端操作</span></span><br><span class="line"><span class="string">1）本地项目打包，前往luffycity项目目录下</span></span><br><span class="line"><span class="string">&gt;: cnpm run build</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2）本地终端上传</span></span><br><span class="line"><span class="string">&gt;: scp -r dist root@39.99.192.127:~</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 开始服务器连接，在服务器终端操作</span></span><br><span class="line"><span class="string">3）移动并重命名</span></span><br><span class="line"><span class="string">mv ~/dist /home/html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4）去向Nginx配置目录，备份配置，完全更新配置：填入下方内容</span></span><br><span class="line"><span class="string">&gt;: cd /usr/local/nginx/conf</span></span><br><span class="line"><span class="string">&gt;: mv nginx.conf nginx.conf.bak</span></span><br><span class="line"><span class="string">&gt;: vim nginx.conf</span></span><br><span class="line"><span class="string">&gt;: i</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">events &#123;</span></span><br><span class="line"><span class="string">    worker_connections  1024;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">http &#123;</span></span><br><span class="line"><span class="string">    include       mime.types;</span></span><br><span class="line"><span class="string">    default_type  application/octet-stream;</span></span><br><span class="line"><span class="string">    sendfile        on;</span></span><br><span class="line"><span class="string">    server &#123;</span></span><br><span class="line"><span class="string">        listen 80;</span></span><br><span class="line"><span class="string">        server_name  127.0.0.1; # 改为自己的域名，没域名修改为127.0.0.1:80</span></span><br><span class="line"><span class="string">        charset utf-8;</span></span><br><span class="line"><span class="string">        location / &#123;</span></span><br><span class="line"><span class="string">            root /home/html; # html访问路径</span></span><br><span class="line"><span class="string">            index index.html; # html文件名称</span></span><br><span class="line"><span class="string">            try_files $uri $uri/ /index.html; # 解决单页面应用刷新404问题</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;   </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5）退出</span></span><br><span class="line"><span class="string">&gt;: esc</span></span><br><span class="line"><span class="string">&gt;: :wq</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6）重启nginx</span></span><br><span class="line"><span class="string">&gt;: nginx -s reload</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="后台部署"><a href="#后台部署" class="headerlink" title="后台部署"></a>后台部署</h1><h2 id="1-上线前配置"><a href="#1-上线前配置" class="headerlink" title="1 上线前配置"></a>1 上线前配置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">pro.py：上线的配置文件，内容拷贝dev.py，前身就是settings.py</span><br><span class="line"><span class="comment"># 关闭测试环境</span></span><br><span class="line">DEBUG = <span class="literal">False</span></span><br><span class="line">ALLOWED_HOSTS = [</span><br><span class="line">    <span class="string">&#x27;39.99.192.127&#x27;</span>  <span class="comment"># 公网ip地址</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span>  <span class="comment"># 允许所有跨域</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 静态文件配置：上线后还有额外配置，见下方 后台样式问题</span></span><br><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 后台http根路径</span></span><br><span class="line"><span class="comment"># BASE_URL = &#x27;http://127.0.0.1:8000&#x27;</span></span><br><span class="line">BASE_URL = <span class="string">&#x27;http://39.99.192.127:8000&#x27;</span></span><br><span class="line"><span class="comment"># 前台http根路径</span></span><br><span class="line"><span class="comment"># LUFFY_URL = &#x27;http://127.0.0.1:8080&#x27;</span></span><br><span class="line">LUFFY_URL = <span class="string">&#x27;http://39.99.192.127:80&#x27;</span></span><br><span class="line"><span class="comment"># 订单支付成功的后台异步回调接口</span></span><br><span class="line">NOTIFY_URL = BASE_URL + <span class="string">&#x27;/order/success/&#x27;</span></span><br><span class="line"><span class="comment"># 订单支付成功的前台同步回调接口</span></span><br><span class="line">RETURN_URL = LUFFY_URL + <span class="string">&#x27;/order/pay/success/&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># 渲染模块</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_RENDERER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span>,</span><br><span class="line">        <span class="comment"># &#x27;rest_framework.renderers.BrowsableAPIRenderer&#x27;,</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-导出项目环境"><a href="#2-导出项目环境" class="headerlink" title="2 导出项目环境"></a>2 导出项目环境</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）进入本地项目根目录</span><br><span class="line">&gt;: cd 项目根目录</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）本地导出项目环境</span><br><span class="line">&gt;: pip3 freeze &gt; packages.txt</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>）如果环境中有特殊的安装包，需要处理一下xadmin</span><br><span class="line">packages.txt中的</span><br><span class="line">	xadmin==<span class="number">2.0</span><span class="number">.1</span></span><br><span class="line">要被替换为</span><br><span class="line">	https://codeload.github.com/sshwsfc/xadmin/<span class="built_in">zip</span>/django2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3-项目提交到远程git仓库"><a href="#3-项目提交到远程git仓库" class="headerlink" title="3 项目提交到远程git仓库"></a>3 项目提交到远程git仓库</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）去向本地项目仓库</span><br><span class="line">&gt;: cd 项目根目录</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）本地版本库操作</span><br><span class="line">&gt;: git status</span><br><span class="line">&gt;: git add .</span><br><span class="line">&gt;: git commit -m <span class="string">&#x27;项目2.0上线&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>）提交到远程版本库</span><br><span class="line">&gt;: git pull origin master</span><br><span class="line">&gt;: git push origin master</span><br></pre></td></tr></table></figure>

<h2 id="4-线上操作（xshell）"><a href="#4-线上操作（xshell）" class="headerlink" title="4 线上操作（xshell）"></a>4 线上操作（xshell）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）创建存放后台项目的目录</span><br><span class="line">&gt;: mkdir /home/project</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）进入后台项目管理目录同步git仓库中的项目</span><br><span class="line">&gt;: cd /home/project</span><br><span class="line">&gt;: git clone https://gitee.com/liuhaojie_199556/luufy.git</span><br></pre></td></tr></table></figure>

<h2 id="5-项目虚拟环境"><a href="#5-项目虚拟环境" class="headerlink" title="5 项目虚拟环境"></a>5 项目虚拟环境</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）安装依赖</span><br><span class="line">&gt;: pip3 install virtualenv</span><br><span class="line">&gt;: pip3 install virtualenvwrapper</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）建立虚拟环境软连接</span><br><span class="line">&gt;: ln -s /usr/local/python3/<span class="built_in">bin</span>/virtualenv /usr/<span class="built_in">bin</span>/virtualenv</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>）配置虚拟环境：填入下方内容</span><br><span class="line">&gt;: vim ~/.bash_profile</span><br><span class="line"></span><br><span class="line">VIRTUALENVWRAPPER_PYTHON=/usr/<span class="built_in">bin</span>/python3</span><br><span class="line">source /usr/local/python3/<span class="built_in">bin</span>/virtualenvwrapper.sh</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>）退出编辑状态</span><br><span class="line">&gt;: esc</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>）保存修改并退出</span><br><span class="line">&gt;: :wq</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>）更新配置文件内容</span><br><span class="line">&gt;: source ~/.bash_profile</span><br><span class="line"></span><br><span class="line"><span class="number">7</span>）虚拟环境默认根目录：~/.virtualenvs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># virtualenvwrapper 报错</span></span><br><span class="line"><span class="comment">###### 使用这种</span></span><br><span class="line">virtualenv  luffy   <span class="comment">#再当前路径创建</span></span><br><span class="line"><span class="comment">## 使用虚拟环境</span></span><br><span class="line">source luffy/<span class="built_in">bin</span>/activate</span><br><span class="line"><span class="comment">#  退出</span></span><br><span class="line">deactivate</span><br></pre></td></tr></table></figure>

<h2 id="7-云服务器转发动态请求（uwsgi-django项目）"><a href="#7-云服务器转发动态请求（uwsgi-django项目）" class="headerlink" title="7 云服务器转发动态请求（uwsgi+django项目）"></a>7 云服务器转发动态请求（uwsgi+django项目）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 mkdir /home/project</span></span><br><span class="line"><span class="comment"># 2 cd /home/project</span></span><br><span class="line"><span class="comment"># 3 git clone https://gitee.com/liuhaojie_199556/luufy.git</span></span><br><span class="line"><span class="comment"># 4 安装虚拟环境，创建虚拟环境，安装项目依赖</span></span><br><span class="line">    virtualenv  luffy   <span class="comment">#家目录</span></span><br><span class="line">    <span class="comment">## 使用虚拟环境</span></span><br><span class="line">    source luffy/<span class="built_in">bin</span>/activate</span><br><span class="line">    <span class="comment">#  退出</span></span><br><span class="line">    deactivate</span><br><span class="line">    </span><br><span class="line">    (luffy) [root@lhj luffyapi]<span class="comment"># pip install -r requirements.txt  （在指定的目录下）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果遇到mysqlclient报错</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        #CentOS有Python、Mysql的开发工具包，安装后使用pip安装mysqlclient即可</span></span><br><span class="line"><span class="string">    yum install mysql-devel</span></span><br><span class="line"><span class="string">    yum install python-devel</span></span><br><span class="line"><span class="string">    #yum install python36-devel</span></span><br><span class="line"><span class="string">    pip install mysqlclient</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 5 pip install uwsgi （虚拟和真实环境都需要安装）</span></span><br><span class="line"><span class="comment"># 6 进行uwsgi服务配置，内容如下</span></span><br><span class="line">vim /home/project/luffyapi/luffyapi.xml</span><br><span class="line"></span><br><span class="line">&lt;uwsgi&gt;    </span><br><span class="line">   &lt;socket&gt;<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8808</span>&lt;/socket&gt; &lt;!-- 内部端口，自定义 --&gt; </span><br><span class="line">   &lt;chdir&gt;/home/project/luffyapi/&lt;/chdir&gt; &lt;!-- 项目路径 --&gt;            </span><br><span class="line">   &lt;module&gt;luffyapi.wsgi&lt;/module&gt;  &lt;!-- luffyapi为wsgi.py所在目录名--&gt; </span><br><span class="line">   &lt;processes&gt;<span class="number">4</span>&lt;/processes&gt; &lt;!-- 进程数 --&gt;     </span><br><span class="line">   &lt;daemonize&gt;uwsgi.log&lt;/daemonize&gt; &lt;!-- 日志文件 --&gt;</span><br><span class="line">&lt;/uwsgi&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7 去向Nginx配置目录，备份配置，完全更新配置：填入下方内容</span></span><br><span class="line">&gt;: vim /usr/local/nginx/conf/nginx.conf</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen <span class="number">80</span>;</span><br><span class="line">        server_name  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>; <span class="comment"># 改为自己的域名，没域名修改为127.0.0.1:80</span></span><br><span class="line">        charset utf-<span class="number">8</span>;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root /home/html; <span class="comment"># html访问路径</span></span><br><span class="line">            index index.html; <span class="comment"># html文件名称</span></span><br><span class="line">            try_files $uri $uri/ /index.html; <span class="comment"># 解决单页面应用刷新404问题</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 新增的server</span></span><br><span class="line">    server &#123;</span><br><span class="line">        listen <span class="number">8000</span>;</span><br><span class="line">        server_name  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>; <span class="comment"># 改为自己的域名，没域名修改为127.0.0.1:80</span></span><br><span class="line">        charset utf-<span class="number">8</span>;</span><br><span class="line">        location / &#123;</span><br><span class="line">           include uwsgi_params;</span><br><span class="line">           uwsgi_pass <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8808</span>;  <span class="comment"># 端口要和uwsgi里配置的一样</span></span><br><span class="line">           uwsgi_param UWSGI_SCRIPT luffyapi.wsgi;  <span class="comment">#wsgi.py所在的目录名+.wsgi</span></span><br><span class="line">           uwsgi_param UWSGI_CHDIR /home/project/luffyapi/; <span class="comment"># 项目路径</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动uwsgi和nginx（后端项目就可以了）</span></span><br><span class="line">    <span class="number">1</span>）启动uwsgi</span><br><span class="line">    &gt;: uwsgi -x /home/project/luffyapi/luffyapi.xml</span><br><span class="line">    <span class="number">2</span>）重启nginx</span><br><span class="line">    &gt;: nginx -s reload</span><br></pre></td></tr></table></figure>

<h2 id="8-后台样式：admin、rest-framework、xadmin等框架的静态样式也需要处理"><a href="#8-后台样式：admin、rest-framework、xadmin等框架的静态样式也需要处理" class="headerlink" title="8 后台样式：admin、rest_framework、xadmin等框架的静态样式也需要处理"></a>8 后台样式：admin、rest_framework、xadmin等框架的静态样式也需要处理</h2><h5 id="修改线上配置"><a href="#修改线上配置" class="headerlink" title="修改线上配置"></a>修改线上配置</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）编辑线上配置文件</span><br><span class="line">&gt;: vim /home/project/luffyapi/settings/pro.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）修改static配置，新增STATIC_ROOT、STATICFILES_DIRS</span><br><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br><span class="line">STATIC_ROOT = <span class="string">&#x27;/home/project/luffyapi/static&#x27;</span>  </span><br><span class="line">STATICFILES_DIRS = (os.path.join(BASE_DIR, <span class="string">&quot;static&quot;</span>),)</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>）退出编辑</span><br><span class="line">&gt;: esc</span><br><span class="line">&gt;: :wq</span><br></pre></td></tr></table></figure>

<h5 id="迁移静态样式：项目目录下"><a href="#迁移静态样式：项目目录下" class="headerlink" title="迁移静态样式：项目目录下"></a>迁移静态样式：项目目录下</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）项目目录下没有 static 文件夹需要新建</span><br><span class="line">&gt;: mkdir /home/project/luffyapi/static</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）完成静态文件迁移</span><br><span class="line">&gt;: python /home/project/manage_prod.py collectstatic</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Nginx配置静态路径"><a href="#Nginx配置静态路径" class="headerlink" title="Nginx配置静态路径"></a>Nginx配置静态路径</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）修改nginx配置</span><br><span class="line">&gt;: vim /usr/local/nginx/conf/nginx.conf</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen <span class="number">80</span>;</span><br><span class="line">        server_name  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>; <span class="comment"># 改为自己的域名，没域名修改为127.0.0.1:80</span></span><br><span class="line">        charset utf-<span class="number">8</span>;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root /home/html; <span class="comment"># html访问路径</span></span><br><span class="line">            index index.html; <span class="comment"># html文件名称</span></span><br><span class="line">            try_files $uri $uri/ /index.html; <span class="comment"># 解决单页面应用刷新404问题</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen <span class="number">8000</span>;</span><br><span class="line">        server_name  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>; <span class="comment"># 改为自己的域名，没域名修改为127.0.0.1:80</span></span><br><span class="line">        charset utf-<span class="number">8</span>;</span><br><span class="line">        location / &#123;</span><br><span class="line">           include uwsgi_params;</span><br><span class="line">           uwsgi_pass <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8808</span>;  <span class="comment"># 端口要和uwsgi里配置的一样</span></span><br><span class="line">           uwsgi_param UWSGI_SCRIPT luffyapi.wsgi;  <span class="comment">#wsgi.py所在的目录名+.wsgi</span></span><br><span class="line">           uwsgi_param UWSGI_CHDIR /home/project/luffyapi/; <span class="comment"># 项目路径</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># 新增的配置静态文件</span></span><br><span class="line">        location /static &#123;</span><br><span class="line">            alias /home/project/luffyapi/static;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）退出</span><br><span class="line">&gt;: esc</span><br><span class="line">&gt;: :wq</span><br></pre></td></tr></table></figure>

<h5 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）关闭 uwsgi，重新启动 uwsgi</span><br><span class="line">&gt;: pkill -f uwsgi -<span class="number">9</span></span><br><span class="line">&gt;: uwsgi -x /home/project/luffyapi/luffyapi.xml</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）关闭 nginx，重新启动 nginx</span><br><span class="line">&gt;: nginx -s stop</span><br><span class="line">&gt;: nginx</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cloud.tencent.com/document/product/<span class="number">382</span>/<span class="number">11672</span></span><br></pre></td></tr></table></figure>

<h1 id="redis高级"><a href="#redis高级" class="headerlink" title="redis高级"></a>redis高级</h1><h2 id="1-redis单机安装"><a href="#1-redis单机安装" class="headerlink" title="1 redis单机安装"></a>1 redis单机安装</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">mkdir soft</span><br><span class="line">cd soft/</span><br><span class="line"><span class="comment">#下载</span></span><br><span class="line">wget http://download.redis.io/releases/redis-<span class="number">5.0</span><span class="number">.7</span>.tar.gz</span><br><span class="line"><span class="comment">#解压</span></span><br><span class="line">tar -xzf redis-<span class="number">5.0</span><span class="number">.7</span>.tar.gz</span><br><span class="line"><span class="comment">#建立软连接</span></span><br><span class="line">ln -s redis-<span class="number">5.0</span><span class="number">.7</span> redis</span><br><span class="line">cd redis</span><br><span class="line">make&amp;&amp;make install</span><br><span class="line"><span class="comment">#在src目录下可以看到</span></span><br><span class="line"><span class="comment">#redis-server---&gt;redis服务器</span></span><br><span class="line"><span class="comment">#redis-cli---》redis命令行客户端</span></span><br><span class="line"><span class="comment">#redis-benchmark---》redis性能测试工具</span></span><br><span class="line"><span class="comment">#redis-check-aof---&gt;aof文件修复工具</span></span><br><span class="line"><span class="comment">#redis-check-dump---》rdb文件检查工具</span></span><br><span class="line"><span class="comment">#redis-sentinel---》sentinel服务器，哨兵</span></span><br><span class="line"><span class="comment">#redis作者对windows维护不好，window自己有安装包</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在任意路径执行redis-server 都能运行起redis服务</span></span><br><span class="line">	-把可执行文件加入环境变量</span><br><span class="line">    	-用户变量（用户家路径下：.bash_profile）</span><br><span class="line">        	 vim ~/.bash_profile </span><br><span class="line">			export PATH=$PATH:/home/soft/redis/src</span><br><span class="line">			source ~/.bash_profile</span><br><span class="line">        -系统变量</span><br><span class="line">    -把可执行文件在usr路径下建立软链接</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">	redis-server</span><br><span class="line"><span class="comment"># 动态参数启动</span></span><br><span class="line">	redis-server --port <span class="number">6379</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 重点：通过配置文件启动</span></span><br><span class="line">	<span class="comment">#配置文件启动（6379对应手机按键MERZ，意大利女歌手Alessia Merz的名字）</span></span><br><span class="line">    <span class="comment">#####通过redis-cli连接，输入config get * 可以获得默认配置</span></span><br><span class="line">    <span class="comment">#在redis目录下创建config目录，copy一个redis.conf文件</span></span><br><span class="line">    daemonize yes <span class="comment">#是否是守护进程启动（no|yes）</span></span><br><span class="line">    port <span class="number">6379</span></span><br><span class="line">    logfile <span class="string">&quot;6379.log&quot;</span>  <span class="comment">#redis系统日志</span></span><br><span class="line">    <span class="built_in">dir</span> <span class="string">&quot;/soft/redis/data&quot;</span> <span class="comment">#redis工作目录</span></span><br><span class="line">    bind <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">    protected-mode no</span><br><span class="line">    requirepass <span class="number">123456</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 客户端连接</span></span><br><span class="line">	redis-cli -h ip -p port</span><br><span class="line">	redis-cli</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 带密码的</span></span><br><span class="line">    <span class="comment"># 方式一</span></span><br><span class="line">    redis-cli -h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  -p <span class="number">6370</span> -a <span class="number">123456</span></span><br><span class="line">    <span class="comment"># 方式二</span></span><br><span class="line">    redis-cli -h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  -p <span class="number">6370</span></span><br><span class="line">    先登陆，再通过auth输入密码</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 注意</span></span><br><span class="line">CONFIG GET *   一百多对建值</span><br><span class="line">CONFIG SET maxmemory 128M  <span class="comment"># 设置最大使用的内存</span></span><br><span class="line">CONFIG <span class="built_in">set</span> requirepass <span class="number">123456</span>  <span class="comment"># 设置密码</span></span><br><span class="line">CONFIG REWRITE  <span class="comment"># 保存到配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####卸载redis</span></span><br><span class="line"><span class="comment"># 1、查看redis进程；</span></span><br><span class="line">ps aux|grep redis</span><br><span class="line"><span class="comment"># 2、kill掉进程；</span></span><br><span class="line">kill 进程<span class="built_in">id</span></span><br><span class="line"><span class="comment"># 3、进入到redis目录</span></span><br><span class="line">cd /usr/local/</span><br><span class="line"><span class="comment"># 4、删除redis对应的文件</span></span><br><span class="line">rm -f /usr/local/redis/<span class="built_in">bin</span>/redis*</span><br><span class="line">rm -f /usr/local/<span class="built_in">bin</span>/redis*</span><br><span class="line"><span class="comment"># 5、删除对应的文件</span></span><br><span class="line">rm -rf redis</span><br></pre></td></tr></table></figure>

<h2 id="2-数据结构"><a href="#2-数据结构" class="headerlink" title="2 数据结构"></a>2 数据结构</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">string</span><br><span class="line"><span class="built_in">hash</span></span><br><span class="line"><span class="built_in">list</span></span><br><span class="line"><span class="built_in">set</span></span><br><span class="line">zset</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-1-字符串类型"><a href="#2-1-字符串类型" class="headerlink" title="2.1 字符串类型"></a>2.1 字符串类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###1---基本使用get，set，del</span></span><br><span class="line">get name       <span class="comment">#时间复杂度 o(1)</span></span><br><span class="line"><span class="built_in">set</span> name lqz   <span class="comment">#时间复杂度 o(1)</span></span><br><span class="line"><span class="keyword">del</span> name       <span class="comment">#时间复杂度 o(1)</span></span><br><span class="line"><span class="comment">###2---其他使用incr,decr,incrby,decrby</span></span><br><span class="line">incr age  <span class="comment">#对age这个key的value值自增1</span></span><br><span class="line">decr age  <span class="comment">#对age这个key的value值自减1</span></span><br><span class="line">incrby age <span class="number">10</span>  <span class="comment">#对age这个key的value值增加10</span></span><br><span class="line">decrby age <span class="number">10</span>  <span class="comment">#对age这个key的value值减10</span></span><br><span class="line"><span class="comment">#统计网站访问量（单线程无竞争，天然适合做计数器）</span></span><br><span class="line"><span class="comment">#缓存mysql的信息（json格式）</span></span><br><span class="line"><span class="comment">#分布式id生成（多个机器同时并发着生成，不会重复）</span></span><br><span class="line"><span class="comment">###3---set，setnx，setxx</span></span><br><span class="line"><span class="built_in">set</span> name lqz  <span class="comment">#不管key是否存在，都设置 </span></span><br><span class="line">setnx name lqz <span class="comment">#key不存在时才设置（新增操作）</span></span><br><span class="line"><span class="built_in">set</span> name lqz nx <span class="comment">#同上</span></span><br><span class="line"><span class="built_in">set</span> name lqz xx <span class="comment">#key存在，才设置（更新操作）</span></span><br><span class="line"><span class="comment">###4---mget mset</span></span><br><span class="line">mget key1 key2 key3     <span class="comment">#批量获取key1，key2.。。时间复杂度o(n)</span></span><br><span class="line">mset key1 value1 key2 value2 key3 value3    <span class="comment">#批量设置时间复杂度o(n)</span></span><br><span class="line"><span class="comment">#n次get和mget的区别</span></span><br><span class="line"><span class="comment">#n次get时间=n次命令时间+n次网络时间</span></span><br><span class="line"><span class="comment">#mget时间=1次网络时间+n次命令时间</span></span><br><span class="line"><span class="comment">###5---其他：getset，append，strlen</span></span><br><span class="line">getset name lqznb <span class="comment">#设置新值并返回旧值 时间复杂度o(1)</span></span><br><span class="line">append name <span class="number">666</span> <span class="comment">#将value追加到旧的value 时间复杂度o(1)</span></span><br><span class="line">strlen name  <span class="comment">#计算字符串长度(注意中文)  时间复杂度o(1)</span></span><br><span class="line"><span class="comment">###6---其他：incrybyfloat,getrange,setrange</span></span><br><span class="line">increbyfloat age <span class="number">3.5</span>  <span class="comment">#为age自增3.5，传负值表示自减 时间复杂度o(1)</span></span><br><span class="line">getrange key start end <span class="comment">#获取字符串制定下标所有的值  时间复杂度o(1)</span></span><br><span class="line">setrange key index value <span class="comment">#从指定index开始设置value值  时间复杂度o(1)</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-哈希类型"><a href="#2-2-哈希类型" class="headerlink" title="2.2 哈希类型"></a>2.2 哈希类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###1---hget,hset,hdel</span></span><br><span class="line">hget key field  <span class="comment">#获取hash key对应的field的value 时间复杂度为 o(1)</span></span><br><span class="line">hset key field value <span class="comment">#设置hash key对应的field的value值 时间复杂度为 o(1)</span></span><br><span class="line">hdel key field <span class="comment">#删除hash key对应的field的值 时间复杂度为 o(1)</span></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">hset user:<span class="number">1</span>:info age <span class="number">23</span></span><br><span class="line">hget user:<span class="number">1</span>:info ag</span><br><span class="line">hset user:<span class="number">1</span>:info name lqz</span><br><span class="line">hgetall user:<span class="number">1</span>:info</span><br><span class="line">hdel user:<span class="number">1</span>:info age</span><br><span class="line"><span class="comment">###2---hexists,hlen</span></span><br><span class="line">hexists key field  <span class="comment">#判断hash key 是否存在field 时间复杂度为 o(1)</span></span><br><span class="line">hlen key   <span class="comment">#获取hash key field的数量  时间复杂度为 o(1)</span></span><br><span class="line">hexists user:<span class="number">1</span>:info name</span><br><span class="line">hlen user:<span class="number">1</span>:info  <span class="comment">#返回数量</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">###3---hmget，hmset</span></span><br><span class="line">hmget key field1 field2 ...fieldN  <span class="comment">#批量获取hash key 的一批field对应的值  时间复杂度是o(n)</span></span><br><span class="line">hmset key field1 value1 field2 value2  <span class="comment">#批量设置hash key的一批field value 时间复杂度是o(n)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###4--hgetall,hvals，hkeys</span></span><br><span class="line">hgetall key  <span class="comment">#返回hash key 对应的所有field和value  时间复杂度是o(n)</span></span><br><span class="line">hvals key   <span class="comment">#返回hash key 对应的所有field的value  时间复杂度是o(n)</span></span><br><span class="line">hkeys key   <span class="comment">#返回hash key对应的所有field  时间复杂度是o(n)</span></span><br><span class="line"><span class="comment">###小心使用hgetall</span></span><br><span class="line"><span class="comment">##1 计算网站每个用户主页的访问量</span></span><br><span class="line">hincrby user:<span class="number">1</span>:info pageview count</span><br><span class="line"><span class="comment">##2 缓存mysql的信息，直接设置hash格式</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-列表类型"><a href="#2-3-列表类型" class="headerlink" title="2.3 列表类型"></a>2.3 列表类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 插入操作</span><br><span class="line"><span class="comment">#rpush 从右侧插入</span></span><br><span class="line">rpush key value1 value2 ...valueN  <span class="comment">#时间复杂度为o(1~n)</span></span><br><span class="line"><span class="comment">#lpush 从左侧插入</span></span><br><span class="line"><span class="comment">#linsert</span></span><br><span class="line">linsert key before|after value newValue   <span class="comment">#从元素value的前或后插入newValue 时间复杂度o(n) ，需要遍历列表</span></span><br><span class="line">linsert listkey before b java</span><br><span class="line">linsert listkey after b php</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 删除操作</span><br><span class="line">lpop key <span class="comment">#从列表左侧弹出一个item 时间复杂度o(1)</span></span><br><span class="line"></span><br><span class="line">rpop key <span class="comment">#从列表右侧弹出一个item 时间复杂度o(1)</span></span><br><span class="line"></span><br><span class="line">lrem key count value</span><br><span class="line"><span class="comment">#根据count值，从列表中删除所有value相同的项 时间复杂度o(n)</span></span><br><span class="line"><span class="number">1</span> count&gt;<span class="number">0</span> 从左到右，删除最多count个value相等的项</span><br><span class="line"><span class="number">2</span> count&lt;<span class="number">0</span> 从右向左，删除最多 Math.<span class="built_in">abs</span>(count)个value相等的项</span><br><span class="line"><span class="number">3</span> count=<span class="number">0</span> 删除所有value相等的项</span><br><span class="line">lrem listkey <span class="number">0</span> a <span class="comment">#删除列表中所有值a</span></span><br><span class="line">lrem listkey -<span class="number">1</span> c <span class="comment">#从右侧删除1个c</span></span><br><span class="line"></span><br><span class="line">ltrim key start end <span class="comment">#按照索引范围修剪列表 o(n)</span></span><br><span class="line">ltrim listkey <span class="number">1</span> <span class="number">4</span> <span class="comment">#只保留下表1--4的元素</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 查询操作</span><br><span class="line">lrange key start end <span class="comment">#包含end获取列表指定索引范围所有item  o(n)</span></span><br><span class="line">lrange listkey <span class="number">0</span> <span class="number">2</span></span><br><span class="line">lrange listkey <span class="number">1</span> -<span class="number">1</span> <span class="comment">#获取第一个位置到倒数第一个位置的元素</span></span><br><span class="line"></span><br><span class="line">lindex key index <span class="comment">#获取列表指定索引的item  o(n)</span></span><br><span class="line">lindex listkey <span class="number">0</span></span><br><span class="line">lindex listkey -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">llen key <span class="comment">#获取列表长度</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">4</span> 修改操作</span><br><span class="line"><span class="built_in">set</span> key index newValue <span class="comment">#设置列表指定索引值为newValue o(n)</span></span><br><span class="line">lset listkey <span class="number">2</span> ppp <span class="comment">#把第二个位置设为ppp</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> 其它操作</span><br><span class="line">blpop key timeout <span class="comment">#lpop的阻塞版，timeout是阻塞超时时间，timeout=0为拥有不阻塞 o(1)</span></span><br><span class="line">brpop key timeout <span class="comment">#rpop的阻塞版，timeout是阻塞超时时间，timeout=0为拥有不阻塞 o(1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#要实现栈的功能</span></span><br><span class="line">lpush+lpop</span><br><span class="line"><span class="comment">#实现队列功能</span></span><br><span class="line">lpush+rpop</span><br><span class="line"><span class="comment">#固定大小的列表</span></span><br><span class="line">lpush+ltrim</span><br><span class="line"><span class="comment">#消息队列</span></span><br><span class="line">lpush+brpop</span><br></pre></td></tr></table></figure>

<h3 id="2-4-集合类型"><a href="#2-4-集合类型" class="headerlink" title="2.4 集合类型"></a>2.4 集合类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 特点：无序，无重复，集合间操作（交叉并补）</span><br><span class="line"><span class="number">2</span> API：</span><br><span class="line">sadd key element <span class="comment">#向集合key添加element（如果element存在，添加失败） o(1)</span></span><br><span class="line"></span><br><span class="line">srem key element <span class="comment">#从集合中的element移除掉 o(1)</span></span><br><span class="line"></span><br><span class="line">scard key <span class="comment">#计算集合大小</span></span><br><span class="line"></span><br><span class="line">sismember key element <span class="comment">#判断element是否在集合中</span></span><br><span class="line"></span><br><span class="line">srandmember key count <span class="comment">#从集合中随机取出count个元素，不会破坏集合中的元素</span></span><br><span class="line"></span><br><span class="line">spop key <span class="comment">#从集合中随机弹出一个元素</span></span><br><span class="line"></span><br><span class="line">smembers key <span class="comment">#获取集合中所有元素 ，无序，小心使用，会阻塞住 </span></span><br><span class="line"></span><br><span class="line">sdiff user:<span class="number">1</span>:follow user:<span class="number">2</span>:follow  <span class="comment">#计算user:1:follow和user:2:follow的差集</span></span><br><span class="line"></span><br><span class="line">sinter user:<span class="number">1</span>:follow user:<span class="number">2</span>:follow  <span class="comment">#计算user:1:follow和user:2:follow的交集</span></span><br><span class="line">          </span><br><span class="line">sunion user:<span class="number">1</span>:follow user:<span class="number">2</span>:follow  <span class="comment">#计算user:1:follow和user:2:follow的并集</span></span><br><span class="line">                </span><br><span class="line">sdiff|sinter|suion + store destkey... <span class="comment">#将差集，交集，并集结果保存在destkey集合中</span></span><br><span class="line"><span class="number">3</span> 实战</span><br><span class="line">抽奖系统 ：通过spop来弹出用户的<span class="built_in">id</span>，活动取消，直接删除</span><br><span class="line"></span><br><span class="line">点赞，点踩，喜欢等，用户如果点了赞，就把用户<span class="built_in">id</span>放到该条记录的集合中</span><br><span class="line"></span><br><span class="line">标签：给用户/文章等添加标签，sadd user:<span class="number">1</span>:tags 标签<span class="number">1</span> 标签<span class="number">2</span> 标签<span class="number">3</span></span><br><span class="line"></span><br><span class="line">给标签添加用户，关注该标签的人有哪些</span><br><span class="line"></span><br><span class="line">共同好友：集合间的操作</span><br></pre></td></tr></table></figure>

<h3 id="2-5-有序集合类型"><a href="#2-5-有序集合类型" class="headerlink" title="2.5 有序集合类型"></a>2.5 有序集合类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 特点</span><br><span class="line"><span class="comment">#有一个分值字段，来保证顺序</span></span><br><span class="line">key                  score                value</span><br><span class="line">user:ranking           <span class="number">1</span>                   lqz</span><br><span class="line">user:ranking           <span class="number">99</span>                  lqz2</span><br><span class="line">user:ranking           <span class="number">88</span>                  lqz3</span><br><span class="line"><span class="comment">#集合有序集合</span></span><br><span class="line">集合：无重复元素，无序，element</span><br><span class="line">有序集合：无重复元素，有序，element+score</span><br><span class="line"><span class="comment">#列表和有序集合</span></span><br><span class="line">列表：可以重复，有序，element</span><br><span class="line">有序集合：无重复元素，有序，element+score</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> Api</span><br><span class="line">zadd key score element <span class="comment">#score可以重复，可以多个同时添加，element不能重复 o(logN) </span></span><br><span class="line"></span><br><span class="line">zrem key element <span class="comment">#删除元素，可以多个同时删除 o(1)</span></span><br><span class="line"></span><br><span class="line">zscore key element <span class="comment">#获取元素的分数 o(1)</span></span><br><span class="line"></span><br><span class="line">zincrby key increScore element <span class="comment">#增加或减少元素的分数  o(1)</span></span><br><span class="line"></span><br><span class="line">zcard key <span class="comment">#返回元素总个数 o(1)</span></span><br><span class="line"></span><br><span class="line">zrank key element <span class="comment">#返回element元素的排名（从小到大排）</span></span><br><span class="line"></span><br><span class="line">zrange key <span class="number">0</span> -<span class="number">1</span> <span class="comment">#返回排名，不带分数  o(log(n)+m) n是元素个数，m是要获取的值</span></span><br><span class="line">zrange player:rank <span class="number">0</span> -<span class="number">1</span> withscores <span class="comment">#返回排名，带分数</span></span><br><span class="line"></span><br><span class="line">zrangebyscore key minScore maxScore <span class="comment">#返回指定分数范围内的升序元素 o(log(n)+m) n是元素个数，m是要获取的值</span></span><br><span class="line">zrangebyscore user:<span class="number">1</span>:ranking <span class="number">90</span> <span class="number">210</span> withscores <span class="comment">#获取90分到210分的元素</span></span><br><span class="line"></span><br><span class="line">zcount key minScore maxScore <span class="comment">#返回有序集合内在指定分数范围内的个数 o(log(n)+m)</span></span><br><span class="line"></span><br><span class="line">zremrangebyrank key start end <span class="comment">#删除指定排名内的升序元素 o(log(n)+m)</span></span><br><span class="line">zremrangebyrank user:<span class="number">1</span>:rangking <span class="number">1</span> <span class="number">2</span> <span class="comment">#删除升序排名中1到2的元素</span></span><br><span class="line">        </span><br><span class="line">zremrangebyscore key minScore maxScore <span class="comment">#删除指定分数内的升序元素 o(log(n)+m)</span></span><br><span class="line">zremrangebyscore user:<span class="number">1</span>:ranking <span class="number">90</span> <span class="number">210</span> <span class="comment">#删除分数90到210之间的元素</span></span><br><span class="line">        </span><br><span class="line"><span class="number">3</span> 实战</span><br><span class="line">排行榜：音乐排行榜，销售榜，关注榜，游戏排行榜</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">4</span> 其它操作</span><br><span class="line">zrevrank <span class="comment">#从高到低排序</span></span><br><span class="line">zrevrange <span class="comment">#从高到低排序取一定范围</span></span><br><span class="line">zrevrangebyscore <span class="comment">#返回指定分数范围内的降序元素</span></span><br><span class="line">zinterstore <span class="comment">#对两个有序集合交集</span></span><br><span class="line">zunionstore <span class="comment">#对两个有序集合求并集</span></span><br></pre></td></tr></table></figure>



<h2 id="3-单线程架构"><a href="#3-单线程架构" class="headerlink" title="3 单线程架构"></a>3 单线程架构</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.3</span><span class="number">.1</span> 单线程架构，</span><br><span class="line">一个瞬间只会执行一条命令</span><br><span class="line"></span><br><span class="line"><span class="number">1.3</span><span class="number">.2</span> 单线程为什么这么快</span><br><span class="line"><span class="number">1</span> 纯内存</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 非阻塞IO （epoll），自身实现了事件处理，不在网络io上浪费过多时间</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 避免线程间切换和竞态消耗</span><br><span class="line"></span><br><span class="line"><span class="number">1.3</span><span class="number">.3</span> 注意</span><br><span class="line"><span class="number">1</span> 一次只运行一条命令</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 拒绝长慢命令</span><br><span class="line"></span><br><span class="line">​ -keys，flushall,flushdb,慢的lua脚本，mutil/<span class="built_in">exec</span>，operate，big value</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 其实不是单线程（在做持久化是另外的线程）</span><br><span class="line"></span><br><span class="line">​ -fysnc file descriptor</span><br><span class="line"></span><br><span class="line">​ -close file descriptor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-同步异步阻塞非阻塞"><a href="#4-同步异步阻塞非阻塞" class="headerlink" title="4 同步异步阻塞非阻塞"></a>4 同步异步阻塞非阻塞</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">同步/异步关注的是消息通信机制 (synchronous communication/ asynchronous communication) 。</span><br><span class="line">所谓同步，就是在发出一个调用时，在没有得到结果之前， 该调用就不返回。</span><br><span class="line">异步则是相反，调用在发出之后，这个调用就直接返回了，所以没有返回结果</span><br><span class="line"></span><br><span class="line">阻塞非阻塞关注的是程序在等待调用结果（消息，返回值）时的状态.</span><br><span class="line"></span><br><span class="line">阻塞调用是指调用结果返回之前，当前线程会被挂起。调用线程只有在得到结果之后才会返回。非阻塞调用指在不能立刻得到结果之前，该调用不会阻塞当前线程。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">三、悲观锁（悲观并发控制）</span><br><span class="line">悲观锁（Pessimistic Concurrency Control，缩写”PCC”），顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。（共享资源每次只给一个线程使用，其它线程阻塞，用完后再把资源转让给其它线程，和Python中GIL锁一样）</span><br><span class="line">悲观锁：假定会发生并发冲突，屏蔽一切可能违反数据完整性的操作。</span><br><span class="line">悲观锁：主要用于数据争用激烈的环境，以及发生并发冲突时使用锁保护数据的成本要低于回滚事务的成本的环境中。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">四、乐观锁（乐观并发控制）</span><br><span class="line">乐观锁（Optimistic Concurrency Control，缩写”OCC”），顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在提交更新的时候会判断一下在此期间别人有没有去更新这个数据。乐观锁适用于读多写少的应用场景，这样可以提高吞吐量。</span><br><span class="line">乐观锁：假设不会发生并发冲突，只在提交操作时检查是否违反数据完整性。</span><br><span class="line">乐观锁：多数用于数据争用不大、冲突较少的环境中，这种环境中，偶尔回滚事务的成本会低于读取数据时锁定数据的成本，因此可以获得比其他并发控制方法更高的吞吐量。</span><br><span class="line">相对于悲观锁，在对数据库进行处理的时候，乐观锁并不会使用数据库提供的锁机制。一般的实现乐观锁的方式就是记录数据版本</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GIL：又叫全局解释器锁，每个线程在执行的过程中都需要先获取GIL，保证同一时刻只有一个线程在运行，目的是解决多线程同时竞争程序中的全局变量而出现的线程安全问题</span><br><span class="line"></span><br><span class="line">GIL面试题参考答案：</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> Python语言和GIL没有什么关系。仅仅是由于历史原因在Cpython虚拟机(解释器)，难以移除GIL。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> GIL：全局解释器锁。每个线程在执行的过程都需要先获取GIL，保证同一时刻只有一个线程可以执行代码。</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 线程释放GIL锁的情况： 在IO操作等可能会引起阻塞的system call之前,可以暂时释放GIL,但在执行完毕后,必须重新获取GIL Python <span class="number">3.</span>x使用计时器（执行时间</span><br><span class="line">达到阈值后，当前线程释放GIL）或Python <span class="number">2.</span>x，tickets计数达到<span class="number">100</span>。</span><br><span class="line"></span><br><span class="line"><span class="number">4</span> Python使用多进程是可以利用多核的CPU资源的。</span><br><span class="line"></span><br><span class="line"><span class="number">5</span> 多线程爬取比单线程性能有提升，因为遇到IO阻塞会自动释放GIL锁。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="5-慢查询"><a href="#5-慢查询" class="headerlink" title="5 慢查询"></a>5 慢查询</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.2</span> 两个配置</span><br><span class="line"><span class="number">1.2</span><span class="number">.1</span> slowlog-<span class="built_in">max</span>-<span class="built_in">len</span></span><br><span class="line">慢查询是一个先进先出的队列</span><br><span class="line"></span><br><span class="line">固定长度</span><br><span class="line"></span><br><span class="line">保存在内存中</span><br><span class="line"></span><br><span class="line"><span class="number">1.2</span><span class="number">.2</span> slowlog-<span class="built_in">max</span>-<span class="built_in">len</span></span><br><span class="line">慢查询阈值（单位：微秒）</span><br><span class="line"></span><br><span class="line">slowlog-log-slower-than=<span class="number">0</span>，记录所有命令</span><br><span class="line"></span><br><span class="line">slowlog-log-slower-than &lt;<span class="number">0</span>,不记录任何命令</span><br><span class="line"></span><br><span class="line"><span class="number">1.2</span><span class="number">.3</span> 配置方法</span><br><span class="line"><span class="number">1</span> 默认配置</span><br><span class="line"></span><br><span class="line">config get slowlog-<span class="built_in">max</span>-<span class="built_in">len</span>=<span class="number">128</span></span><br><span class="line"></span><br><span class="line">Config get slowly-log-slower-than=<span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 修改配置文件重启</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 动态配置</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置记录所有命令</span></span><br><span class="line">config <span class="built_in">set</span> slowlog-log-slower-than <span class="number">0</span></span><br><span class="line"><span class="comment"># 最多记录100条</span></span><br><span class="line">config <span class="built_in">set</span> slowlog-<span class="built_in">max</span>-<span class="built_in">len</span> <span class="number">100</span></span><br><span class="line"><span class="comment"># 持久化到本地配置文件</span></span><br><span class="line">config rewrite</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">config set slowlog-max-len 1000</span></span><br><span class="line"><span class="string">config set slowlog-log-slower-than 1000</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.3</span> 三个命令</span><br><span class="line">slowlog get [n]  <span class="comment">#获取慢查询队列</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">日志由4个属性组成：</span></span><br><span class="line"><span class="string">1）日志的标识id</span></span><br><span class="line"><span class="string">2）发生的时间戳</span></span><br><span class="line"><span class="string">3）命令耗时</span></span><br><span class="line"><span class="string">4）执行的命令和参数</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">slowlog <span class="built_in">len</span> <span class="comment">#获取慢查询队列长度</span></span><br><span class="line"></span><br><span class="line">slowlog reset <span class="comment">#清空慢查询队列</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.4</span> 经验</span><br><span class="line"><span class="number">1</span> slowlog-<span class="built_in">max</span>-<span class="built_in">len</span> 不要设置过大，默认10ms，通常设置1ms</span><br><span class="line"><span class="number">2</span> slowlog-log-slower-than不要设置过小，通常设置<span class="number">1000</span>左右</span><br><span class="line"><span class="number">3</span> 理解命令生命周期</span><br><span class="line"><span class="number">4</span> 定期持久化慢查询</span><br></pre></td></tr></table></figure>

<h2 id="6-pipeline与事务"><a href="#6-pipeline与事务" class="headerlink" title="6 pipeline与事务"></a>6 pipeline与事务</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Redis的pipeline(管道)功能在命令行中没有，但redis是支持pipeline的，而且在各个语言版的client中都有相应的实现</span><br><span class="line"></span><br><span class="line">将一批命令，批量打包，在redis服务端批量计算(执行)，然后把结果批量返回</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>次pipeline(n条命令)=<span class="number">1</span>次网络时间+n次命令时间</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用建议</span></span><br><span class="line">	<span class="number">1</span> 注意每次pipeline携带的数据量</span><br><span class="line"></span><br><span class="line">    <span class="number">2</span> pipeline每次只能作用在一个Redis的节点上</span><br><span class="line"></span><br><span class="line">    <span class="number">3</span> M(mset，mget….)操作和pipeline的区别</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 原生事务操作</span></span><br><span class="line">    <span class="comment"># 1 mutil  开启事务，放到管道中一次性执行</span></span><br><span class="line">    multi   <span class="comment"># 开启事务</span></span><br><span class="line">    <span class="built_in">set</span> name lqz</span><br><span class="line">    <span class="built_in">set</span> age <span class="number">18</span></span><br><span class="line">    <span class="built_in">exec</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2 模拟事务</span></span><br><span class="line">    <span class="comment"># 在开启事务之前，先watch</span></span><br><span class="line">    wathc age</span><br><span class="line">    multi</span><br><span class="line">    decr age</span><br><span class="line">    <span class="built_in">exec</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 另一台机器</span></span><br><span class="line">    mutil</span><br><span class="line">    decr age</span><br><span class="line">    <span class="built_in">exec</span>  <span class="comment"># 先执行，上面的执行就会失败(乐观锁，被wathc的事务不会执行成功)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="7-发布订阅"><a href="#7-发布订阅" class="headerlink" title="7 发布订阅"></a>7 发布订阅</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发布者发布了消息，所有的订阅者都可以收到，就是生产者消费者模型（后订阅了，无法获取历史消息）</span></span><br><span class="line">publish channel message <span class="comment">#发布命令</span></span><br><span class="line">publish souhu:tv <span class="string">&quot;hello world&quot;</span> <span class="comment">#在souhu:tv频道发布一条hello world  返回订阅者个数</span></span><br><span class="line"></span><br><span class="line">subscribe [channel] <span class="comment">#订阅命令，可以订阅一个或多个</span></span><br><span class="line">subscribe souhu:tv  <span class="comment">#订阅sohu:tv频道</span></span><br><span class="line"></span><br><span class="line">unsubscribe [channel] <span class="comment">#取消订阅一个或多个频道</span></span><br><span class="line">unsubscribe sohu:tv  <span class="comment">#取消订阅sohu:tv频道</span></span><br><span class="line">    </span><br><span class="line">psubscribe [pattern...] <span class="comment">#订阅模式匹配</span></span><br><span class="line">psubscribe c*  <span class="comment">#订阅以c开头的频道</span></span><br><span class="line"></span><br><span class="line">unpsubscribe [pattern...] <span class="comment">#按模式退订指定频道</span></span><br><span class="line"></span><br><span class="line">pubsub channels <span class="comment">#列出至少有一个订阅者的频道,列出活跃的频道</span></span><br><span class="line"></span><br><span class="line">pubsub numsub [channel...] <span class="comment">#列出给定频道的订阅者数量</span></span><br><span class="line"></span><br><span class="line">pubsub numpat <span class="comment">#列出被订阅模式的数量</span></span><br></pre></td></tr></table></figure>

<h2 id="8-Bitmap位图"><a href="#8-Bitmap位图" class="headerlink" title="8 Bitmap位图"></a>8 Bitmap位图</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4.2</span> 相关命令</span><br><span class="line"><span class="built_in">set</span> hello big <span class="comment">#放入key位hello 值为big的字符串</span></span><br><span class="line">getbit hello <span class="number">0</span> <span class="comment">#取位图的第0个位置，返回0</span></span><br><span class="line">getbit hello <span class="number">1</span> <span class="comment">#取位图的第1个位置，返回1 如上图</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##我们可以直接操纵位</span></span><br><span class="line">setbit key offset value <span class="comment">#给位图指定索引设置值</span></span><br><span class="line">setbit hello <span class="number">7</span> <span class="number">1</span> <span class="comment">#把hello的第7个位置设为1 这样，big就变成了cig</span></span><br><span class="line"></span><br><span class="line">setbit test <span class="number">50</span> <span class="number">1</span> <span class="comment">#test不存在，在key为test的value的第50位设为1，那其他位都以0补</span></span><br><span class="line"></span><br><span class="line">bitcount key [start end] <span class="comment">#获取位图指定范围(start到end,单位为字节,注意按字节一个字节8个bit为，如果不指定就是获取全部)位值为1的个数</span></span><br><span class="line"></span><br><span class="line">bitop op destkey key [key...] <span class="comment">#做多个Bitmap的and(交集)/or(并集)/not(非)/xor(异或)，操作并将结果保存在destkey中 </span></span><br><span class="line">bitop <span class="keyword">and</span> after_lqz lqz lqz2 <span class="comment">#把lqz和lqz2按位与操作，放到after_lqz中</span></span><br><span class="line"></span><br><span class="line">bitpos key targetBit start end <span class="comment">#计算位图指定范围(start到end，单位为字节，如果不指定是获取全部)第一个偏移量对应的值等于targetBit的位置</span></span><br><span class="line">bitpos lqz <span class="number">1</span> <span class="comment">#big 对应位图中第一个1的位置，在第二个位置上，由于从0开始返回1</span></span><br><span class="line">bitpos lqz <span class="number">0</span> <span class="comment">#big 对应位图中第一个0的位置，在第一个位置上，由于从0开始返回0</span></span><br><span class="line">bitpos lqz <span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="comment">#返回9：返回从第一个字节到第二个字节之间 第一个1的位置，看上图，为9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">使用<span class="built_in">set</span>和Bitmap对比</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>亿用户，<span class="number">5</span>千万独立（<span class="number">1</span>亿用户量，约<span class="number">5</span>千万人访问，统计活跃用户数量）</span><br><span class="line"></span><br><span class="line">数据类型	每个userid占用空间	需要存储用户量	   全部内存量</span><br><span class="line"><span class="built_in">set</span>	       <span class="number">32</span>位(假设userid是整形，占<span class="number">32</span>位)	<span class="number">5</span>千万	<span class="number">32</span>位*<span class="number">5</span>千万=200MB</span><br><span class="line">bitmap	    <span class="number">1</span>位	                          <span class="number">1</span>亿   <span class="number">1</span>位*<span class="number">1</span>亿=<span class="number">12.5</span>MB</span><br><span class="line">假设有<span class="number">10</span>万独立用户，使用位图还是占用<span class="number">12.5</span>mb，使用<span class="built_in">set</span>需要<span class="number">32</span>位*<span class="number">1</span>万=4MB</span><br></pre></td></tr></table></figure>

<h2 id="9-HyperLogLog"><a href="#9-HyperLogLog" class="headerlink" title="9 HyperLogLog"></a>9 HyperLogLog</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HyperLogLog：极小的空间完成独立数量统计</span></span><br><span class="line">	-pfadd key element  增加（重复了不会增加）</span><br><span class="line">    -pfcount key         统计个数</span><br><span class="line">    -去重，独立用户统计，有错误率</span><br><span class="line">    </span><br><span class="line"><span class="comment"># GEO（redis，es）</span></span><br><span class="line">	<span class="comment"># 插入</span></span><br><span class="line">    geoadd cities:locations <span class="number">116.28</span> <span class="number">39.55</span> beijing <span class="comment">#把北京地理信息天津到cities:locations中</span></span><br><span class="line">    geoadd cities:locations <span class="number">117.12</span> <span class="number">39.08</span> tianjin</span><br><span class="line">    geoadd cities:locations <span class="number">114.29</span> <span class="number">38.02</span> shijiazhuang</span><br><span class="line">    geoadd cities:locations <span class="number">118.01</span> <span class="number">39.38</span> tangshan</span><br><span class="line">    geoadd cities:locations <span class="number">115.29</span> <span class="number">38.51</span> baoding</span><br><span class="line">    <span class="comment"># 计算北京到天津的距离</span></span><br><span class="line">    geodist cities:locations beijing tianjin km</span><br><span class="line">	<span class="comment"># 计算北京方圆150km内的城市</span></span><br><span class="line">    georadiusbymember cities:locations beijing <span class="number">150</span> km</span><br><span class="line">        </span><br><span class="line"><span class="number">5.3</span> 内存消耗&amp;总结</span><br><span class="line">百万级别独立用户统计，百万条数据只占15k</span><br><span class="line"></span><br><span class="line">错误率 <span class="number">0.81</span>%</span><br><span class="line"></span><br><span class="line">无法取出单条数据，只能统计个数</span><br></pre></td></tr></table></figure>

<h2 id="10-持久化"><a href="#10-持久化" class="headerlink" title="10 持久化"></a>10 持久化</h2><h3 id="rdb"><a href="#rdb" class="headerlink" title="rdb"></a>rdb</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 两种：</span></span><br><span class="line">	-rdb：缓存</span><br><span class="line">    -aof：对数据准确性要求高一些</span><br><span class="line"><span class="comment"># rdb：触发方式三种</span></span><br><span class="line">	-手动 save</span><br><span class="line">    	</span><br><span class="line">    -手动 bgsave</span><br><span class="line">    </span><br><span class="line">    -配置文件</span><br><span class="line">    配置   seconds   changes</span><br><span class="line">    save   <span class="number">900</span>        <span class="number">1</span></span><br><span class="line">    save   <span class="number">300</span>        <span class="number">10</span></span><br><span class="line">    save   <span class="number">60</span>         <span class="number">10000</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># rdb最佳配置</span></span><br><span class="line">save <span class="number">900</span> <span class="number">1</span> </span><br><span class="line">save <span class="number">300</span> <span class="number">10</span> </span><br><span class="line">save <span class="number">60</span> <span class="number">10000</span> </span><br><span class="line">dbfilename dump-<span class="number">3306.</span>rdb  <span class="comment">#以端口号作为文件名，可能一台机器上很多reids，不会乱</span></span><br><span class="line"><span class="built_in">dir</span> /bigdiskpath <span class="comment">#保存路径放到一个大硬盘位置目录</span></span><br><span class="line">stop-writes-on-bgsave-error yes <span class="comment">#出现错误停止</span></span><br><span class="line">rdbcompression yes <span class="comment">#压缩</span></span><br><span class="line">rdbchecksum yes <span class="comment">#校验</span></span><br></pre></td></tr></table></figure>

<h3 id="aof"><a href="#aof" class="headerlink" title="aof"></a>aof</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">客户端每写入一条命令，都记录一条日志，放到日志文件中，如果出现宕机，可以将数据完全恢复</span><br><span class="line"></span><br><span class="line"><span class="comment"># AOF 重写</span></span><br><span class="line">	本质就是把过期的，无用的，重复的，可以优化的命令，来优化</span><br><span class="line">	这样可以减少磁盘占用量，加速恢复速度</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># aof的最佳配置</span></span><br><span class="line">appendonly yes <span class="comment">#将该选项设置为yes，打开</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly-3306.aof&quot;</span> <span class="comment">#文件保存的名字</span></span><br><span class="line">appendfsync everysec <span class="comment">#采用第二种策略</span></span><br><span class="line"><span class="built_in">dir</span> /data <span class="comment">#存放的路径</span></span><br><span class="line">no-appendfsync-on-rewrite yes</span><br></pre></td></tr></table></figure>

<h3 id="rdb和aof的比较"><a href="#rdb和aof的比较" class="headerlink" title="rdb和aof的比较"></a>rdb和aof的比较</h3><p><img src="C:/Users/%E5%88%98%E4%B8%80/AppData/Roaming/Typora/typora-user-images/image-20210301211021206.png" alt="image-20210301211021206"></p>
<h2 id="11-主从复制原理与优化"><a href="#11-主从复制原理与优化" class="headerlink" title="11 主从复制原理与优化"></a>11 主从复制原理与优化</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 副本库通过slaveof <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">6379</span>命令,连接主库,并发送SYNC给主库 </span><br><span class="line"><span class="number">2.</span> 主库收到SYNC,会立即触发BGSAVE,后台保存RDB,发送给副本库</span><br><span class="line"><span class="number">3.</span> 副本库接收后会应用RDB快照</span><br><span class="line"><span class="number">4.</span> 主库会陆续将中间产生的新的操作,保存并发送给副本库</span><br><span class="line"><span class="number">5.</span> 到此,我们主复制集就正常工作了</span><br><span class="line"><span class="number">6.</span> 再此以后,主库只要发生新的操作,都会以命令传播的形式自动发送给副本库.</span><br><span class="line"><span class="number">7.</span> 所有复制相关信息,从info信息中都可以查到.即使重启任何节点,他的主从关系依然都在.</span><br><span class="line"><span class="number">8.</span> 如果发生主从关系断开时,从库数据没有任何损坏,在下次重连之后,从库发送PSYNC给主库</span><br><span class="line"><span class="number">9.</span> 主库只会将从库缺失部分的数据同步给从库应用,达到快速恢复主从的目的</span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 手动配置</span></span><br><span class="line">在<span class="number">6380</span>上执行（去从库配置，配置主库）</span><br><span class="line"><span class="comment"># 127.0.0.1 6379主库</span></span><br><span class="line"><span class="comment"># 127.0.0.1 6380 从库</span></span><br><span class="line"><span class="comment"># 在从库上执行，就建立了主从</span></span><br><span class="line">slaveof <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">6379</span> <span class="comment">#异步</span></span><br><span class="line"><span class="comment"># 取消主从</span></span><br><span class="line">slaveof no one <span class="comment">#取消复制，不会把之前的数据清除</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置文件配置</span></span><br><span class="line"><span class="comment"># vim redis_6381.conf</span></span><br><span class="line">daemonize yes</span><br><span class="line">port <span class="number">6381</span></span><br><span class="line">logfile <span class="string">&quot;6381.log&quot;</span></span><br><span class="line"><span class="built_in">dir</span> <span class="string">&quot;/soft/redis/data2&quot;</span></span><br><span class="line">bind <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">protected-mode no</span><br><span class="line"><span class="comment">#requirepass 123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rdb最佳配置</span></span><br><span class="line">save <span class="number">900</span> <span class="number">1</span></span><br><span class="line">save <span class="number">300</span> <span class="number">10</span></span><br><span class="line">save <span class="number">60</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># aof的最佳配置</span></span><br><span class="line">appendonly yes</span><br><span class="line">appendfilename <span class="string">&quot;appendonly-3306.aof&quot;</span></span><br><span class="line">appendfsync everysec</span><br><span class="line">no-appendfsync-on-rewrite yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定主库为139.196.29.107 6379</span></span><br><span class="line">slaveof <span class="number">139.196</span><span class="number">.29</span><span class="number">.107</span> <span class="number">6379</span></span><br><span class="line"><span class="comment"># 从库只读</span></span><br><span class="line">slave-read-only yes</span><br></pre></td></tr></table></figure>

<h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 读写分离</span><br><span class="line"></span><br><span class="line">读流量分摊到从节点</span><br><span class="line"></span><br><span class="line">可能遇到问题：复制数据延迟，读到过期数据，从节点故障</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 主从配置不一致</span><br><span class="line"></span><br><span class="line">maxmemory不一致：丢失数据</span><br><span class="line"></span><br><span class="line">数据结构优化参数：主节点做了优化，从节点没有设置优化，会出现一些问题</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 规避全量复制</span><br><span class="line"></span><br><span class="line">第一次全量复制，不可避免：小主节点，低峰(夜间)</span><br><span class="line"></span><br><span class="line">节点运行<span class="built_in">id</span>不匹配：主节点重启(运行<span class="built_in">id</span>变化)</span><br><span class="line"></span><br><span class="line">复制挤压缓冲区不足：增大复制缓冲区大小，rel_backlog_size</span><br><span class="line"></span><br><span class="line"><span class="number">4</span> 规避复制风暴</span><br><span class="line"></span><br><span class="line">单主节点复制风暴，主节点重启，所有从节点复制</span><br></pre></td></tr></table></figure>

<h2 id="12-redis哨兵"><a href="#12-redis哨兵" class="headerlink" title="12 redis哨兵"></a>12 redis哨兵</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 搭一个一主两从</span><br><span class="line"><span class="comment">#创建三个配置文件：</span></span><br><span class="line"><span class="comment">#第一个是主配置文件</span></span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /var/run/redis.pid</span><br><span class="line">port <span class="number">6379</span></span><br><span class="line"><span class="built_in">dir</span> <span class="string">&quot;/opt/soft/redis/data&quot;</span></span><br><span class="line">logfile “<span class="number">6379.</span>log”</span><br><span class="line"></span><br><span class="line"><span class="comment">#第二个是从配置文件</span></span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /var/run/redis2.pid</span><br><span class="line">port <span class="number">6378</span></span><br><span class="line"><span class="built_in">dir</span> <span class="string">&quot;/soft/redis/data2&quot;</span></span><br><span class="line">logfile “<span class="number">6378.</span>log”</span><br><span class="line">slaveof <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">6379</span></span><br><span class="line">slave-read-only yes</span><br><span class="line"><span class="comment">#第三个是从配置文件</span></span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /var/run/redis3.pid</span><br><span class="line">port <span class="number">6377</span></span><br><span class="line"><span class="built_in">dir</span> <span class="string">&quot;/soft/redis/data3&quot;</span></span><br><span class="line">logfile “<span class="number">6377.</span>log”</span><br><span class="line">slaveof <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">6379</span></span><br><span class="line">slave-read-only yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#把三个redis服务都启动起来</span></span><br><span class="line">./src/redis-server redis_6379.conf</span><br><span class="line">./src/redis-server redis_6378.conf</span><br><span class="line">./src/redis-server redis_6377.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@lhj redis]<span class="comment"># vi sentinel_26381.conf</span></span><br><span class="line"><span class="comment"># sentinel.conf这个文件</span></span><br><span class="line"><span class="comment"># 把哨兵也当成一个redis服务器</span></span><br><span class="line">创建三个配置文件分别叫sentinel_26379.conf sentinel_26380.conf  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前路径下创建 data1 data2 data3 个文件夹</span></span><br><span class="line"><span class="comment">#内容如下(需要修改端口，文件地址日志文件名字)</span></span><br><span class="line"><span class="comment"># sentinel_26381.conf</span></span><br><span class="line">port <span class="number">26381</span></span><br><span class="line">daemonize yes</span><br><span class="line"><span class="built_in">dir</span> /soft/redis/data3</span><br><span class="line">protected-mode no</span><br><span class="line">bind <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">logfile <span class="string">&quot;redis_sentine26381.log&quot;</span></span><br><span class="line">sentinel monitor mymaster <span class="number">139.196</span><span class="number">.29</span><span class="number">.107</span> <span class="number">6379</span> <span class="number">2</span></span><br><span class="line">sentinel down-after-milliseconds mymaster <span class="number">30000</span></span><br><span class="line">sentinel parallel-syncs mymaster <span class="number">1</span></span><br><span class="line">sentinel failover-timeout mymaster <span class="number">180000</span></span><br><span class="line"></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-server redis_6379.conf </span></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-server redis_6380.conf </span></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-server redis_6381.conf </span></span><br><span class="line">[root@lhj redis]<span class="comment"># </span></span><br><span class="line">[root@lhj redis]<span class="comment"># </span></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-sentinel sentinel_26379.conf </span></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-sentinel sentinel_26380.conf </span></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-sentinel sentinel_26381.conf </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">-客户端测试</span><br><span class="line">    	<span class="keyword">import</span> redis</span><br><span class="line">        <span class="keyword">from</span> redis.sentinel <span class="keyword">import</span> Sentinel</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 连接哨兵服务器(主机名也可以用域名)</span></span><br><span class="line">        <span class="comment"># 10.0.0.101:26379</span></span><br><span class="line">        sentinel = Sentinel([(<span class="string">&#x27;139.196.158.24&#x27;</span>, <span class="number">26379</span>),</span><br><span class="line">                             (<span class="string">&#x27;139.196.158.24&#x27;</span>, <span class="number">26380</span>),</span><br><span class="line">                             (<span class="string">&#x27;139.196.158.24&#x27;</span>, <span class="number">26381</span>)],</span><br><span class="line">                            socket_timeout=<span class="number">5</span>)</span><br><span class="line">        <span class="comment"># print(sentinel)</span></span><br><span class="line">        <span class="comment"># # 获取主服务器地址</span></span><br><span class="line">        master = sentinel.discover_master(<span class="string">&#x27;mymaster&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(master)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取从服务器地址</span></span><br><span class="line">        slave = sentinel.discover_slaves(<span class="string">&#x27;mymaster&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(slave)</span><br><span class="line"></span><br><span class="line">        <span class="comment">##### 读写分离</span></span><br><span class="line">        <span class="comment"># 获取主服务器进行写入</span></span><br><span class="line">        <span class="comment"># master = sentinel.master_for(&#x27;mymaster&#x27;, socket_timeout=5)</span></span><br><span class="line">        <span class="comment"># w_ret = master.set(&#x27;foo&#x27;, &#x27;bar&#x27;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># slave = sentinel.slave_for(&#x27;mymaster&#x27;, socket_timeout=0.5)</span></span><br><span class="line">        <span class="comment"># r_ret = slave.get(&#x27;foo&#x27;)</span></span><br><span class="line">        <span class="comment"># print(r_ret)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="13-redis集群"><a href="#13-redis集群" class="headerlink" title="13 redis集群"></a>13 redis集群</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实操</span></span><br><span class="line">cd /soft/redis/config</span><br><span class="line">vim redis-<span class="number">7000.</span>conf</span><br><span class="line"><span class="comment"># 写入</span></span><br><span class="line"><span class="comment"># 第一步：启动6个实例</span></span><br><span class="line">port <span class="number">7000</span></span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> /soft/redis/data7000</span><br><span class="line">logfile <span class="string">&quot;7000.log&quot;</span></span><br><span class="line">dbfilename <span class="string">&quot;dump-7000.rdb&quot;</span></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-<span class="number">7000.</span>conf</span><br><span class="line">cluster-require-full-coverage yes </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">#masterauth  集群搭建时，主的密码</span></span><br><span class="line"><span class="string">cluster-enabled yes  # 开启cluster</span></span><br><span class="line"><span class="string">cluster-node-timeout 15000 # 故障转移，超时时间 15s</span></span><br><span class="line"><span class="string">cluster-config-file nodes-$&#123;port&#125;.conf  # 给cluster节点增加一个自己的配置文件</span></span><br><span class="line"><span class="string">cluster-require-full-coverage yes  #只要集群中有一个故障了，整个就不对外提供服务了，这个实际不合理，假设有50个节点，一个节点故障了，所有不提供服务了；，需要设置成no</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 快速生成其他配置</span></span><br><span class="line">[root@lhj config]<span class="comment"># sed &#x27;s/7000/7001/g&#x27; redis-7000.conf &gt; redis-7001.conf</span></span><br><span class="line">[root@lhj config]<span class="comment"># sed &#x27;s/7000/7002/g&#x27; redis-7000.conf &gt; redis-7002.conf</span></span><br><span class="line">[root@lhj config]<span class="comment"># sed &#x27;s/7000/7003/g&#x27; redis-7000.conf &gt; redis-7003.conf</span></span><br><span class="line">[root@lhj config]<span class="comment"># sed &#x27;s/7000/7004/g&#x27; redis-7000.conf &gt; redis-7004.conf</span></span><br><span class="line">[root@lhj config]<span class="comment"># sed &#x27;s/7000/7005/g&#x27; redis-7000.conf &gt; redis-7005.conf</span></span><br><span class="line">[root@lhj config]<span class="comment"># ls</span></span><br><span class="line">redis-<span class="number">7000.</span>conf  redis-<span class="number">7001.</span>conf  redis-<span class="number">7002.</span>conf  redis-<span class="number">7003.</span>conf  redis-<span class="number">7004.</span>conf  redis-<span class="number">7005.</span>conf</span><br><span class="line">[root@lhj config]<span class="comment"># cd ..</span></span><br><span class="line">[root@lhj redis]<span class="comment"># mkdir data&#123;7000..7007&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # 第二部：启动实例</span></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-server ./config/redis-7000.conf </span></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-server ./config/redis-7001.conf </span></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-server ./config/redis-7002.conf </span></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-server ./config/redis-7003.conf </span></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-server ./config/redis-7004.conf </span></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-server ./config/redis-7005.conf </span></span><br><span class="line">[root@lhj redis]<span class="comment"># ps -ef |grep redis</span></span><br><span class="line"></span><br><span class="line">-启动<span class="number">6</span>个实例，自动处理（老的配置集群，比较麻烦，手动做好多东西），集群中有<span class="number">6</span>个节点，每个主节点有一个从节点（主和从都是redis自己选择）</span><br><span class="line"></span><br><span class="line">redis-cli -p <span class="number">7000</span> --cluster create <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7000</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7001</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7002</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7003</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7004</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7005</span> --cluster-replicas <span class="number">1</span></span><br><span class="line">                            </span><br><span class="line"><span class="comment"># 第三步：客户端连接</span></span><br><span class="line">    	redis-cli -c -p <span class="number">7000</span>   <span class="comment"># -c是集群模式，查询或写入的数据如果不在当前节点，会自动跳转查询或写入</span></span><br><span class="line">    	cluster nodes   <span class="comment"># 查看集群节点信息</span></span><br><span class="line">        cluster info                          </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="扩容"><a href="#扩容" class="headerlink" title="扩容"></a>扩容</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1  准备新节点</span></span><br><span class="line">-集群模式</span><br><span class="line">-配置和其他节点统一</span><br><span class="line">-启动后是孤儿节点</span><br><span class="line">[root@lhj config]<span class="comment"># sed &#x27;s/7000/7006/g&#x27; redis-7000.conf &gt; redis-7006.conf</span></span><br><span class="line">[root@lhj config]<span class="comment"># sed &#x27;s/7000/7007/g&#x27; redis-7000.conf &gt; redis-7007.conf</span></span><br><span class="line"></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-server ./config/redis-7006.conf </span></span><br><span class="line">[root@lhj redis]<span class="comment"># redis-server ./config/redis-7007.conf</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-启动两个实例，加入集群，一个作为主，一个作为从</span><br><span class="line">    - 把<span class="number">7006</span>加入到集群中</span><br><span class="line">	redis-cli --cluster add-node  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7006</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7005</span></span><br><span class="line">	-把<span class="number">7007</span>加入到集群并且作为<span class="number">7006</span>的从库</span><br><span class="line">	redis-cli --cluster add-node  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7007</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7005</span> --cluster-slave --cluster-master-<span class="built_in">id</span> 0602ca3e17a1661f05ba34c63bf7317cfd9d6e85</span><br><span class="line">     -迁移槽（指定迁移的大小，指定从哪个节点迁移（<span class="built_in">all</span>）,每个节点迁移一部分）</span><br><span class="line">    	redis-cli --cluster reshard <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7000</span></span><br><span class="line">        <span class="comment">#打印当前集群状态</span></span><br><span class="line">        <span class="comment"># 希望迁移多少个槽：1365</span></span><br><span class="line">        <span class="comment"># 希望那个id是接收的：7006的id</span></span><br><span class="line">        <span class="comment"># 传入source id ：all</span></span><br><span class="line">        <span class="comment"># yes</span></span><br><span class="line">   <span class="comment"># 查看</span></span><br><span class="line">        redis-cli -p <span class="number">7000</span> cluster nodes</span><br><span class="line">        redis-cli -p <span class="number">7000</span> cluster slots</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment">## 其他：</span></span><br><span class="line">-如果想给<span class="number">7000</span>再加一个从节点怎么弄？</span><br><span class="line"><span class="comment"># 启动起7006，meet一下，让7006复制7000</span></span><br><span class="line">redis-cli -p <span class="number">7000</span> cluster meet <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">7006</span></span><br><span class="line">redis-cli -p <span class="number">7006</span> cluster replicate e03fb9a259cd314e9a23e17573d07c477d3242f7</span><br></pre></td></tr></table></figure>

<h3 id="缩容"><a href="#缩容" class="headerlink" title="缩容"></a>缩容</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下线迁槽（把7006的1366个槽迁移到7000上）</span></span><br><span class="line">redis-cli --cluster reshard --cluster-<span class="keyword">from</span> 5e7166befdff35eb8026c5c88991f9b05ee7cf8d --cluster-to 0465e391784a56b188ef93ea7a154ed506915c53 --cluster-slots <span class="number">1366</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7005</span></span><br><span class="line">yes</span><br><span class="line"></span><br><span class="line">redis-cli --cluster reshard --cluster-<span class="keyword">from</span> <span class="number">7006</span>的<span class="built_in">id</span> --cluster-to <span class="number">7001</span>的<span class="built_in">id</span> --cluster-slots <span class="number">1365</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7002</span></span><br><span class="line">yes</span><br><span class="line">redis-cli --cluster reshard --cluster-<span class="keyword">from</span> <span class="number">7006</span>的<span class="built_in">id</span> --cluster-to <span class="number">7002</span>的<span class="built_in">id</span> --cluster-slots <span class="number">1365</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7003</span></span><br><span class="line">yes</span><br><span class="line"><span class="comment"># 忘记节点，关闭节点</span></span><br><span class="line">redis-cli --cluster <span class="keyword">del</span>-node <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7000</span> 要下线的7007<span class="built_in">id</span>  <span class="comment"># 先下从，再下主，因为先下主会触发故障转移</span></span><br><span class="line">redis-cli --cluster <span class="keyword">del</span>-node <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7000</span> 要下线的7006<span class="built_in">id</span> </span><br><span class="line"><span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关掉其中一个主，另一个从立马变成主顶上， 重启停止的主，发现变成了从</span></span><br></pre></td></tr></table></figure>


    </div>

    
    
    
	  
	  
		   <div>
			 <div>
    
        <div style="text-align:center;color: #ccc;font-size:20px;">-------------End-------------</div>
    
</div>
		   </div>
	   

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/luffy/" rel="tag"># luffy</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/09/17/HTML/" rel="prev" title="">
      <i class="fa fa-chevron-left"></i> 
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/12/23/%E7%88%AC%E8%99%AB/" rel="next" title="">
       <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#luffy"><span class="nav-number">1.</span> <span class="nav-text">luffy</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.</span> <span class="nav-text">项目配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%85%8D%E7%BD%AEpip%E6%BA%90"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.配置pip源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="nav-number">1.1.2.</span> <span class="nav-text">2.配置虚拟环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%90%8E%E5%8F%B0%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.3.</span> <span class="nav-text">3.后台配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.4.</span> <span class="nav-text">4.数据库配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%89%8D%E5%8F%B0%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.5.</span> <span class="nav-text">5.前台配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="nav-number">1.2.</span> <span class="nav-text">1 跨域问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%90%8E%E7%AB%AF%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.1 后端解决跨域问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E7%AC%AC%E4%B8%89%E6%96%B9%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F"><span class="nav-number">1.3.</span> <span class="nav-text">1.2 第三方解决跨域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E4%BD%BF%E7%94%A8pip%E5%AE%89%E8%A3%85"><span class="nav-number">1.3.1.</span> <span class="nav-text">1、使用pip安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%B7%BB%E5%8A%A0%E5%88%B0setting%E7%9A%84app%E4%B8%AD"><span class="nav-number">1.3.2.</span> <span class="nav-text">2、添加到setting的app中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E6%B7%BB%E5%8A%A0%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.3.3.</span> <span class="nav-text">3、添加中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81setting%E4%B8%8B%E9%9D%A2%E6%B7%BB%E5%8A%A0%E4%B8%8B%E9%9D%A2%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">1.3.4.</span> <span class="nav-text">4、setting下面添加下面的配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E5%89%8D%E7%AB%AF%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="nav-number">1.4.</span> <span class="nav-text">1.3 前端解决跨域问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6vue-config-js"><span class="nav-number">1.4.1.</span> <span class="nav-text">1 配置文件vue.config.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-axios%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="nav-number">1.4.2.</span> <span class="nav-text">2 axios发送请求</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-git"><span class="nav-number">1.5.</span> <span class="nav-text">2 git</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-git%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-number">1.5.1.</span> <span class="nav-text">2.1 git的工作流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4"><span class="nav-number">1.5.2.</span> <span class="nav-text">2.2 基础命令</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B0%86%E5%B7%B2%E6%9C%89%E7%9A%84%E6%96%87%E4%BB%B6%E5%A4%B9-%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%BAgit%E4%BB%93%E5%BA%93"><span class="nav-number">1.5.2.0.1.</span> <span class="nav-text">将已有的文件夹 - 初始化为git仓库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8%E6%8C%87%E5%AE%9A%E7%9B%AE%E5%BD%95%E4%B8%8B-%E5%88%9D%E5%A7%8B%E5%8C%96git%E4%BB%93%E5%BA%93"><span class="nav-number">1.5.2.0.2.</span> <span class="nav-text">在指定目录下 - 初始化git仓库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8%E4%BB%93%E5%BA%93%E7%9B%AE%E5%BD%95%E7%BB%88%E7%AB%AF%E4%B8%8B-%E8%AE%BE%E7%BD%AE%E5%85%A8%E5%B1%80%E7%94%A8%E6%88%B7"><span class="nav-number">1.5.2.0.3.</span> <span class="nav-text">在仓库目录终端下 - 设置全局用户</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8%E4%BB%93%E5%BA%93%E7%9B%AE%E5%BD%95%E7%BB%88%E7%AB%AF%E4%B8%8B-%E8%AE%BE%E7%BD%AE%E5%B1%80%E9%83%A8%E7%94%A8%E6%88%B7"><span class="nav-number">1.5.2.0.4.</span> <span class="nav-text">在仓库目录终端下 - 设置局部用户</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E4%BB%93%E5%BA%93%E7%8A%B6%E6%80%81"><span class="nav-number">1.5.2.0.5.</span> <span class="nav-text">查看仓库状态</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%92%A4%E9%94%80%E5%B7%A5%E4%BD%9C%E5%8C%BA%E6%93%8D%E4%BD%9C%EF%BC%9A%E6%94%B9%E3%80%81%E5%88%A0%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="nav-number">1.5.2.0.6.</span> <span class="nav-text">撤销工作区操作：改、删（了解）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8C%BA%E5%86%85%E5%AE%B9%E6%8F%90%E4%BA%A4%E5%88%B0%E6%9A%82%E5%AD%98%E5%8C%BA"><span class="nav-number">1.5.2.0.7.</span> <span class="nav-text">工作区内容提交到暂存区</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%92%A4%E9%94%80%E6%9A%82%E5%AD%98%E5%8C%BA%E6%8F%90%E4%BA%A4%EF%BC%9Aadd%E7%9A%84%E9%80%86%E8%BF%90%E7%AE%97%EF%BC%88%E5%BE%88%E5%B0%91%E4%BD%BF%E7%94%A8%EF%BC%89"><span class="nav-number">1.5.2.0.8.</span> <span class="nav-text">撤销暂存区提交：add的逆运算（很少使用）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%90%E4%BA%A4%E6%9A%82%E5%AD%98%E5%8C%BA%E5%86%85%E5%AE%B9%E5%88%B0%E7%89%88%E6%9C%AC%E5%BA%93"><span class="nav-number">1.5.2.0.9.</span> <span class="nav-text">提交暂存区内容到版本库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%92%A4%E9%94%80%E7%89%88%E6%9C%AC%E5%BA%93%E6%8F%90%E4%BA%A4%EF%BC%9Acommit%E7%9A%84%E9%80%86%E8%BF%90%E7%AE%97"><span class="nav-number">1.5.2.0.10.</span> <span class="nav-text">撤销版本库提交：commit的逆运算</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-git%E5%88%86%E6%94%AF"><span class="nav-number">1.5.3.</span> <span class="nav-text">2.3 git分支</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93"><span class="nav-number">1.6.</span> <span class="nav-text">3 远程仓库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E9%87%87%E7%94%A8ssh%E5%8D%8F%E8%AE%AE%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E6%BA%90"><span class="nav-number">1.7.</span> <span class="nav-text">4 采用ssh协议连接远程源</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E5%88%9B%E5%BB%BA%E7%94%B5%E8%84%91%E7%9A%84%E5%85%AC%E9%92%A5%E7%A7%81%E9%92%A5"><span class="nav-number">1.7.1.</span> <span class="nav-text">4.1 创建电脑的公钥私钥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%8D%8F%E5%90%8C%E5%BC%80%E5%8F%91"><span class="nav-number">1.7.2.</span> <span class="nav-text">4.2 协同开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E5%9B%9E%E6%BB%9A"><span class="nav-number">1.7.3.</span> <span class="nav-text">4.3 远程仓库回滚</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-redis"><span class="nav-number">1.8.</span> <span class="nav-text">5 redis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">1.8.1.</span> <span class="nav-text">5.1 基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.8.2.</span> <span class="nav-text">5.2 数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-redis%E6%99%AE%E9%80%9A%E9%93%BE%E6%8E%A5%E5%92%8C%E9%93%BE%E6%8E%A5%E6%B1%A0"><span class="nav-number">1.8.3.</span> <span class="nav-text">5.3 redis普通链接和链接池</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#redis-pool"><span class="nav-number">1.8.3.1.</span> <span class="nav-text">redis_pool</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-redis%E4%B9%8B%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">1.8.4.</span> <span class="nav-text">5.4  redis之字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-redis%E4%B9%8Bhash"><span class="nav-number">1.8.5.</span> <span class="nav-text">5.5 redis之hash</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-redis%E4%B9%8B%E5%88%97%E8%A1%A8"><span class="nav-number">1.8.6.</span> <span class="nav-text">5.6 redis之列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-7-redis%E4%B9%8B%E5%85%B6%E5%AE%83%E6%93%8D%E4%BD%9C"><span class="nav-number">1.8.7.</span> <span class="nav-text">5.7 redis之其它操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#redis"><span class="nav-number">2.</span> <span class="nav-text">redis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80-%E7%AE%80%E4%BB%8B"><span class="nav-number">2.1.</span> <span class="nav-text">一 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C-redis%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="nav-number">2.2.</span> <span class="nav-text">二 redis的安装和使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89-Python%E6%93%8D%E4%BD%9CRedis%E4%B9%8B%E5%AE%89%E8%A3%85%E5%92%8C%E6%94%AF%E6%8C%81%E5%AD%98%E5%82%A8%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.3.</span> <span class="nav-text">三 Python操作Redis之安装和支持存储类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B-Python%E6%93%8D%E4%BD%9CRedis%E4%B9%8B%E6%99%AE%E9%80%9A%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.4.</span> <span class="nav-text">四 Python操作Redis之普通连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B-Python%E6%93%8D%E4%BD%9CRedis%E4%B9%8B%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-number">2.5.</span> <span class="nav-text">四 Python操作Redis之连接池</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94-%E6%93%8D%E4%BD%9C%E4%B9%8BString%E6%93%8D%E4%BD%9C"><span class="nav-number">2.6.</span> <span class="nav-text">五 操作之String操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD-%E6%93%8D%E4%BD%9C%E4%B9%8BHash%E6%93%8D%E4%BD%9C"><span class="nav-number">2.7.</span> <span class="nav-text">六 操作之Hash操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83-%E6%93%8D%E4%BD%9C%E4%B9%8BList%E6%93%8D%E4%BD%9C"><span class="nav-number">2.8.</span> <span class="nav-text">七 操作之List操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB-%E6%93%8D%E4%BD%9C%E4%B9%8BSet%E6%93%8D%E4%BD%9C"><span class="nav-number">2.9.</span> <span class="nav-text">八 操作之Set操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D-%E5%85%B6%E5%AE%83%E6%93%8D%E4%BD%9C"><span class="nav-number">2.10.</span> <span class="nav-text">九 其它操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%B8%80-%E7%AE%A1%E9%81%93"><span class="nav-number">2.11.</span> <span class="nav-text">十一 管道</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%BA%8C-Django%E4%B8%AD%E4%BD%BF%E7%94%A8redis"><span class="nav-number">2.12.</span> <span class="nav-text">十二 Django中使用redis</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#celery"><span class="nav-number">3.</span> <span class="nav-text">celery</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-celery%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">3.1.</span> <span class="nav-text">1 celery基本使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-celery%E5%A4%9A%E4%BB%BB%E5%8A%A1%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.</span> <span class="nav-text">2 celery多任务结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E9%AB%98%E7%BA%A7%E4%BD%BF%E7%94%A8%E4%B9%8B%E5%BB%B6%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="nav-number">3.3.</span> <span class="nav-text">3 高级使用之延时任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E9%AB%98%E7%BA%A7%E4%BD%BF%E7%94%A8%E4%B9%8B%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="nav-number">3.4.</span> <span class="nav-text">4 高级使用之定时任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-django%E4%B8%AD%E4%BD%BF%E7%94%A8celery"><span class="nav-number">3.5.</span> <span class="nav-text">5 django中使用celery</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#view-py"><span class="nav-number">3.5.1.</span> <span class="nav-text">view.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#urls-py"><span class="nav-number">3.5.2.</span> <span class="nav-text">urls.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#user-task-py"><span class="nav-number">3.5.3.</span> <span class="nav-text">user_task.py</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-celery%E5%BA%94%E7%94%A8%E9%A6%96%E9%A1%B5%E8%BD%AE%E6%92%AD%E5%9B%BE%E6%8E%A5%E5%8F%A3%E5%92%8C%E5%AE%9A%E6%97%B6%E6%9B%B4%E6%96%B0"><span class="nav-number">3.6.</span> <span class="nav-text">6 celery应用首页轮播图接口和定时更新</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#home-view-py"><span class="nav-number">3.6.1.</span> <span class="nav-text">home&#x2F;view.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#celery-py"><span class="nav-number">3.6.2.</span> <span class="nav-text">celery.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#home-task-py"><span class="nav-number">3.6.3.</span> <span class="nav-text">home_task.py</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%B8%83%E7%89%9B%E4%BA%91%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%89%98%E7%AE%A1%E8%A7%86%E9%A2%91"><span class="nav-number">3.7.</span> <span class="nav-text">1 七牛云对象存储托管视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF"><span class="nav-number">4.</span> <span class="nav-text">项目上线</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E8%B4%AD%E4%B9%B0%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">4.1.</span> <span class="nav-text">1.购买云服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%B0%86%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AEbuild"><span class="nav-number">4.2.</span> <span class="nav-text">2. 将前端项目build</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%AE%89%E8%A3%85Mysql"><span class="nav-number">4.3.</span> <span class="nav-text">3.安装Mysql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%AE%89%E8%A3%85Redis"><span class="nav-number">4.4.</span> <span class="nav-text">4.安装Redis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%AE%89%E8%A3%85python"><span class="nav-number">4.5.</span> <span class="nav-text">5.安装python</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%AE%89%E8%A3%85nginx"><span class="nav-number">4.6.</span> <span class="nav-text">6.安装nginx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E4%B8%8A%E7%BA%BF"><span class="nav-number">4.7.</span> <span class="nav-text">7.上线</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E5%8F%B0%E9%83%A8%E7%BD%B2"><span class="nav-number">5.</span> <span class="nav-text">后台部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%B8%8A%E7%BA%BF%E5%89%8D%E9%85%8D%E7%BD%AE"><span class="nav-number">5.1.</span> <span class="nav-text">1 上线前配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%AF%BC%E5%87%BA%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83"><span class="nav-number">5.2.</span> <span class="nav-text">2 导出项目环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E9%A1%B9%E7%9B%AE%E6%8F%90%E4%BA%A4%E5%88%B0%E8%BF%9C%E7%A8%8Bgit%E4%BB%93%E5%BA%93"><span class="nav-number">5.3.</span> <span class="nav-text">3 项目提交到远程git仓库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E7%BA%BF%E4%B8%8A%E6%93%8D%E4%BD%9C%EF%BC%88xshell%EF%BC%89"><span class="nav-number">5.4.</span> <span class="nav-text">4 线上操作（xshell）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E9%A1%B9%E7%9B%AE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="nav-number">5.5.</span> <span class="nav-text">5 项目虚拟环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AC%E5%8F%91%E5%8A%A8%E6%80%81%E8%AF%B7%E6%B1%82%EF%BC%88uwsgi-django%E9%A1%B9%E7%9B%AE%EF%BC%89"><span class="nav-number">5.6.</span> <span class="nav-text">7 云服务器转发动态请求（uwsgi+django项目）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E5%90%8E%E5%8F%B0%E6%A0%B7%E5%BC%8F%EF%BC%9Aadmin%E3%80%81rest-framework%E3%80%81xadmin%E7%AD%89%E6%A1%86%E6%9E%B6%E7%9A%84%E9%9D%99%E6%80%81%E6%A0%B7%E5%BC%8F%E4%B9%9F%E9%9C%80%E8%A6%81%E5%A4%84%E7%90%86"><span class="nav-number">5.7.</span> <span class="nav-text">8 后台样式：admin、rest_framework、xadmin等框架的静态样式也需要处理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E7%BA%BF%E4%B8%8A%E9%85%8D%E7%BD%AE"><span class="nav-number">5.7.0.0.1.</span> <span class="nav-text">修改线上配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%81%E7%A7%BB%E9%9D%99%E6%80%81%E6%A0%B7%E5%BC%8F%EF%BC%9A%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E4%B8%8B"><span class="nav-number">5.7.0.0.2.</span> <span class="nav-text">迁移静态样式：项目目录下</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Nginx%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81%E8%B7%AF%E5%BE%84"><span class="nav-number">5.7.0.0.3.</span> <span class="nav-text">Nginx配置静态路径</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="nav-number">5.7.0.0.4.</span> <span class="nav-text">启动服务</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#redis%E9%AB%98%E7%BA%A7"><span class="nav-number">6.</span> <span class="nav-text">redis高级</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-redis%E5%8D%95%E6%9C%BA%E5%AE%89%E8%A3%85"><span class="nav-number">6.1.</span> <span class="nav-text">1 redis单机安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">6.2.</span> <span class="nav-text">2 数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="nav-number">6.2.1.</span> <span class="nav-text">2.1 字符串类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%93%88%E5%B8%8C%E7%B1%BB%E5%9E%8B"><span class="nav-number">6.2.2.</span> <span class="nav-text">2.2 哈希类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%88%97%E8%A1%A8%E7%B1%BB%E5%9E%8B"><span class="nav-number">6.2.3.</span> <span class="nav-text">2.3 列表类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="nav-number">6.2.4.</span> <span class="nav-text">2.4 集合类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="nav-number">6.2.5.</span> <span class="nav-text">2.5 有序集合类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%9E%B6%E6%9E%84"><span class="nav-number">6.3.</span> <span class="nav-text">3 单线程架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%E9%98%BB%E5%A1%9E%E9%9D%9E%E9%98%BB%E5%A1%9E"><span class="nav-number">6.4.</span> <span class="nav-text">4 同步异步阻塞非阻塞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E6%85%A2%E6%9F%A5%E8%AF%A2"><span class="nav-number">6.5.</span> <span class="nav-text">5 慢查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-pipeline%E4%B8%8E%E4%BA%8B%E5%8A%A1"><span class="nav-number">6.6.</span> <span class="nav-text">6 pipeline与事务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"><span class="nav-number">6.7.</span> <span class="nav-text">7 发布订阅</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-Bitmap%E4%BD%8D%E5%9B%BE"><span class="nav-number">6.8.</span> <span class="nav-text">8 Bitmap位图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-HyperLogLog"><span class="nav-number">6.9.</span> <span class="nav-text">9 HyperLogLog</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">6.10.</span> <span class="nav-text">10 持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#rdb"><span class="nav-number">6.10.1.</span> <span class="nav-text">rdb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aof"><span class="nav-number">6.10.2.</span> <span class="nav-text">aof</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rdb%E5%92%8Caof%E7%9A%84%E6%AF%94%E8%BE%83"><span class="nav-number">6.10.3.</span> <span class="nav-text">rdb和aof的比较</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="nav-number">6.11.</span> <span class="nav-text">11 主从复制原理与优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">6.11.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">6.11.2.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-number">6.11.3.</span> <span class="nav-text">常见问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-redis%E5%93%A8%E5%85%B5"><span class="nav-number">6.12.</span> <span class="nav-text">12 redis哨兵</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5"><span class="nav-number">6.12.1.</span> <span class="nav-text">客户端连接</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-redis%E9%9B%86%E7%BE%A4"><span class="nav-number">6.13.</span> <span class="nav-text">13 redis集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%AE%B9"><span class="nav-number">6.13.1.</span> <span class="nav-text">扩容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%A9%E5%AE%B9"><span class="nav-number">6.13.2.</span> <span class="nav-text">缩容</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Admin"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Admin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021-07 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Admin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>







    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 


<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共151.4k字</span>
</div>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
